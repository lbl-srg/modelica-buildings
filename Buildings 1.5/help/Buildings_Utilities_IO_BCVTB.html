<HTML>
<HEAD>
<TITLE>Buildings.Utilities.IO.BCVTB</TITLE>
<META name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META name="description" content="&quot;Package with functions to communicate with the Building Controls Virtual Test Bed&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- --- header ------ -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- --- end header -- -->
</P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE BCVTB<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Utilities.IO.BCVTB"></A><A HREF="Buildings_Utilities_IO.html#Buildings.Utilities.IO"
>Buildings.Utilities.IO</A>.BCVTB</H2>
<B>Package with functions to communicate with the Building Controls Virtual Test Bed</B>
<P></P>
<P></P><H3>Information</H3>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons_VariantsPackage.html#Modelica.Icons.VariantsPackage"
>Modelica.Icons.VariantsPackage</A> (Icon for package containing variants).
<P></P><H3>Package Content</H3>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.BCVTB.UsersGuideS.png" ALT="Buildings.Utilities.IO.BCVTB.UsersGuide" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_BCVTB_UsersGuide.html#Buildings.Utilities.IO.BCVTB.UsersGuide"
>UsersGuide</A>
</TD><TD>User&#39;s Guide</TD></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.BC7a3aa3d7dbf53696rfaceS.png" ALT="Buildings.Utilities.IO.BCVTB.MoistAirInterface" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_BCVTB.html#Buildings.Utilities.IO.BCVTB.MoistAirInterface"
>MoistAirInterface</A>
</TD><TD>Fluid interface that can be coupled to BCVTB for medium that model the air humidity</TD></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.BCVTB.BCVTBS.png" ALT="Buildings.Utilities.IO.BCVTB.BCVTB" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_BCVTB.html#Buildings.Utilities.IO.BCVTB.BCVTB"
>BCVTB</A>
</TD><TD>Block that exchanges data with the Building Controls Virtual Test Bed</TD></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.BCVTB.To_degCS.png" ALT="Buildings.Utilities.IO.BCVTB.To_degC" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_BCVTB.html#Buildings.Utilities.IO.BCVTB.To_degC"
>To_degC</A>
</TD><TD>Converts Kelvin to Celsius</TD></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.BCVTB.From_degCS.png" ALT="Buildings.Utilities.IO.BCVTB.From_degC" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_BCVTB.html#Buildings.Utilities.IO.BCVTB.From_degC"
>From_degC</A>
</TD><TD>Converts Celsius to Kelvin</TD></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.BCVTB.ExamplesS.png" ALT="Buildings.Utilities.IO.BCVTB.Examples" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_BCVTB_Examples.html#Buildings.Utilities.IO.BCVTB.Examples"
>Examples</A>
</TD><TD>Collection of models that illustrate model use and test models</TD></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.BCVTB.BaseClassesS.png" ALT="Buildings.Utilities.IO.BCVTB.BaseClasses" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_BCVTB_BaseClasses.html#Buildings.Utilities.IO.BCVTB.BaseClasses"
>BaseClasses</A>
</TD><TD>Package with base classes for Buildings.Utilities.IO.BCVTB</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE MoistAirInterface<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Utilities.IO.BC7a3aa3d7dbf53696rfaceI.png" ALT="Buildings.Utilities.IO.BCVTB.MoistAirInterface" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Utilities.IO.BCVTB.MoistAirInterface"></A><A HREF="Buildings_Utilities_IO_BCVTB.html#Buildings.Utilities.IO.BCVTB"
>Buildings.Utilities.IO.BCVTB</A>.MoistAirInterface</H2>
<B>Fluid interface that can be coupled to BCVTB for medium that model the air humidity</B><p></P>
<IMG SRC="Buildings.Utilities.IO.BC7a3aa3d7dbf53696rfaceD.png" ALT="Buildings.Utilities.IO.BCVTB.MoistAirInterface">
<P></P><H3>Information</H3>

This model allows interfacing to the 
<a href="http://simulationresearch.lbl.gov/bcvtb">Building Controls Virtual Test Bed</a>
an air-conditioning system
that uses a medium model with water vapor concentration.
<br/>
<p>
The model takes as input signals the temperature and water vapor
concentration and, optionally, a bulk mass flow rate into or
out of the system boundary. The state of the fluid 
that flows out of this model will be at this temperature and
water vapor concentration. The output of this model are the sensible and
latent heat exchanged across the system boundary.
</p>
<p>
When used with the BCVTB, a building
simulation program such as EnergyPlus
may compute the room air temperatures and
room air humidity rate, which is then used as an input
to this model. The sensible and latent heat flow rates may be
sent to EnergyPlus to couple the air-conditioning system to 
the energy balance of the building model.
</p>
<p>
<b>Note:</b> The EnergyPlus building simulation program outputs the
absolute humidity ratio in units of [kg/kg dry air]. Since
<code>Modelica.Media</code> uses [kg/kg total mass of air], this quantity
needs to be converted. The conversion can be done with the model
<A HREF="Buildings_Utilities_Psychrometrics.html#Buildings.Utilities.Psychrometrics.ToTotalAir"
>
Buildings.Utilities.Psychrometrics.ToTotalAir</a>.
<P></P>
Extends from <A HREF="Buildings_Utilities_IO_BCVTB_BaseClasses.html#Buildings.Utilities.IO.BCVTB.BaseClasses.FluidInterface"
>Buildings.Utilities.IO.BCVTB.BaseClasses.FluidInterface</A> (Partial class for fluid interface that can be coupled to BCVTB).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium model within the source</TD></TR>
<TR><TD>Boolean</TD><TD>use_m_flow_in</TD><TD>false</TD><TD>Get the mass flow rate from the input connector</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow</TD><TD>0</TD><TD>Fixed mass flow rate going out of the fluid port [kg/s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate, used for regularization near zero flow [kg/s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Advanced</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_small</TD><TD>1E-4*m_flow_nominal</TD><TD>For bi-directional flow, temperature is regularized in the region |m_flow| &lt; m_flow_small (m_flow_small &gt; 0 required) [kg/s]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>m_flow_in</TD><TD>Prescribed mass flow rate</TD></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>T_in</TD><TD>Prescribed boundary temperature</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPorts_b"
>FluidPorts_b</A></TD><TD>ports[nPorts]</TD><TD>&nbsp;</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>HSen_flow</TD><TD>Sensible enthalpy flow rate, positive if flow into the component [W]</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>HLat_flow</TD><TD>Latent enthalpy flow rate, positive if flow into the component [W]</TD></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>phi</TD><TD>Medium relative humidity</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> MoistAirInterface <font color="darkgreen">
  &quot;Fluid interface that can be coupled to BCVTB for medium that model the air humidity&quot;</font>
  <font color="blue">extends </font><A HREF="Buildings_Utilities_IO_BCVTB_BaseClasses.html#Buildings.Utilities.IO.BCVTB.BaseClasses.FluidInterface"
>Buildings.Utilities.IO.BCVTB.BaseClasses.FluidInterface</A>(bou(
        <font color="blue">final </font>use_X_in=true));

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> HLat_flow(unit=&quot;W&quot;) <font color="darkgreen">
    &quot;Latent enthalpy flow rate, positive if flow into the component&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.SensibleEnthalpyFlowRate"
>Buildings.Fluid.Sensors.SensibleEnthalpyFlowRate</A> senEntFloRat[nPorts](
    <font color="blue">redeclare </font><font color="blue">final </font><font color="blue">package</font> Medium = Medium,
    <font color="blue">each </font><font color="blue">final </font>m_flow_nominal=m_flow_nominal) <font color="darkgreen">&quot;Sensible enthalpy flow rates&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Sum"
>Modelica.Blocks.Math.Sum</A> sumHSen_flow(nin=nPorts) <font color="darkgreen">
    &quot;Sum of sensible enthalpy flow rates&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Feedback"
>Modelica.Blocks.Math.Feedback</A> diff <font color="darkgreen">
    &quot;Difference between total and sensible enthalpy flow rate&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> phi <font color="darkgreen">&quot;Medium relative humidity&quot;</font>;
  <A HREF="Buildings_Utilities_Psychrometrics.html#Buildings.Utilities.Psychrometrics.X_pTphi"
>Buildings.Utilities.Psychrometrics.X_pTphi</A> masFra(use_p_in=false) <font color="darkgreen">
    &quot;Mass fraction&quot;</font>;</textblock>
<font color="blue">equation </font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:nPorts<font color="blue"> loop</font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(senEntFloRat[i].port_a, ports[i]);
  <font color="red">connect</font>(senEntFloRat[i].H_flow, sumHSen_flow.u[i]);</textblock>
  <font color="blue">end for</font>;
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(senEntFloRat.port_b, totEntFloRat.port_a);
  <font color="red">connect</font>(sumHSen_flow.y, HSen_flow);
  <font color="red">connect</font>(sumHTot_flow.y, diff.u1);
  <font color="red">connect</font>(diff.y, HLat_flow);
  <font color="red">connect</font>(diff.u2, sumHSen_flow.y);
  <font color="red">connect</font>(masFra.T, T_in);
  <font color="red">connect</font>(masFra.phi, phi);
  <font color="red">connect</font>(masFra.X, bou.X_in);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>MoistAirInterface;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE BCVTB<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Utilities.IO.BCVTB.BCVTBI.png" ALT="Buildings.Utilities.IO.BCVTB.BCVTB" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Utilities.IO.BCVTB.BCVTB"></A><A HREF="Buildings_Utilities_IO_BCVTB.html#Buildings.Utilities.IO.BCVTB"
>Buildings.Utilities.IO.BCVTB</A>.BCVTB</H2>
<B>Block that exchanges data with the Building Controls Virtual Test Bed</B><p></P>
<IMG SRC="Buildings.Utilities.IO.BCVTB.BCVTBD.png" ALT="Buildings.Utilities.IO.BCVTB.BCVTB">
<P></P><H3>Information</H3>

Block that exchanges data with the 
<a href="http://simulationresearch.lbl.gov/bcvtb">Building Controls Virtual Test Bed</a> (BCVTB).
<p>
At the start of the simulation, this block establishes a socket connection
using the Berkeley Software Distribution socket (BSD socket).
At each sampling interval, data are exchanged between Modelica
and the BCVTB.
When Dymola terminates, a signal is sent to the BCVTB
so that it can terminate gracefully.
</p>
<p>
For each element in the input vector <code>uR[nDblWri]</code>, 
the value of the flag <code>flaDblWri[nDblWri]</code> determines whether
the current value, the average over the sampling interval or the integral
over the sampling interval is sent to the BCVTB. The following three options are allowed:
<table summary="summary" border="1">
<tr>
<td>
flaDblWri[i]
</td>
<td>
Value sent to the BCVTB
</td>
</tr>
<tr>
<td>
0
</td>
<td>
Current value of uR[i]
</td>
</tr>
<tr>
<td>
1
</td>
<td>
Average value of uR[i] over the sampling interval
</td>
</tr>
<tr>
<td>
2
</td>
<td>
Integral of uR[i] over the sampling interval
</td>
</tr>
</table>
<br/>
<p>
For the first call to the BCVTB interface, the value of the parameter <code>uStart[nDblWri]</code>
will be used instead of <code>uR[nDblWri]</code>. This avoids an algebraic loop when determining
the initial conditions. If <code>uR[nDblWri]</code> were to be used, then computing the initial conditions
may require an iterative solution in which the function <code>exchangeWithSocket</code> may be called
multiple times.
Unfortunately, it does not seem possible to use a parameter that would give a user the option to either
select <code>uR[i]</code> or <code>uStart[i]</code> in the first data exchange. The reason is that the symbolic solver does not evaluate
the test that picks <code>uR[i]</code> or <code>uStart[i]</code>, and hence there would be an algebraic loop.
</p>
<p>
If the parameter <code>activateInterface</code> is set to false, then no data is exchanged with the BCVTB.
The output of this block is then equal to the value of the parameter <code>yRFixed[nDblRea]</code>.
This option can be helpful during debugging. Since during model translation, the functions are 
still linked to the C library, the header files and libraries need to be present in the current working 
directory even if <code>activateInterface=false</code>.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.DiscreteBlock"
>Modelica.Blocks.Interfaces.DiscreteBlock</A> (Base class of discrete control blocks).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>samplePeriod</TD><TD>if activateInterface then ti...</TD><TD>Sample period of component [s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>startTime</TD><TD>0</TD><TD>First sample time instant [s]</TD></TR>
<TR><TD>Boolean</TD><TD>activateInterface</TD><TD>true</TD><TD>Set to false to deactivate interface and use instead yFixed as output</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>timeStep</TD><TD>&nbsp;</TD><TD>Time step used for the synchronization [s]</TD></TR>
<TR><TD>String</TD><TD>xmlFileName</TD><TD>&quot;socket.cfg&quot;</TD><TD>Name of the file that is generated by the BCVTB and that contains the socket information</TD></TR>
<TR><TD>Integer</TD><TD>nDblWri</TD><TD>&nbsp;</TD><TD>Number of double values to write to the BCVTB</TD></TR>
<TR><TD>Integer</TD><TD>nDblRea</TD><TD>&nbsp;</TD><TD>Number of double values to be read from the BCVTB</TD></TR>
<TR><TD>Integer</TD><TD>flaDblWri[nDblWri]</TD><TD>zeros(nDblWri)</TD><TD>Flag for double values (0: use current value, 1: use average over interval, 2: use integral over interval)</TD></TR>
<TR><TD>Real</TD><TD>uStart[nDblWri]</TD><TD>&nbsp;</TD><TD>Initial input signal, used during first data transfer with BCVTB</TD></TR>
<TR><TD>Real</TD><TD>yRFixed[nDblRea]</TD><TD>zeros(nDblRea)</TD><TD>Fixed output, used if activateInterface=false</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>uR[nDblWri]</TD><TD>Real inputs to be sent to the BCVTB</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>yR[nDblRea]</TD><TD>Real outputs received from the BCVTB</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> BCVTB <font color="darkgreen">
  &quot;Block that exchanges data with the Building Controls Virtual Test Bed&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.DiscreteBlock"
>Modelica.Blocks.Interfaces.DiscreteBlock</A>(<font color="blue">final </font>startTime=0,
  <font color="blue">final </font>samplePeriod = <font color="blue">if </font>activateInterface<font color="blue"> then </font>timeStep<font color="blue"> else </font>Modelica.Constants.inf);
  <font color="blue">parameter </font>Boolean activateInterface = true <font color="darkgreen">
    &quot;Set to false to deactivate interface and use instead yFixed as output&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> timeStep <font color="darkgreen">
    &quot;Time step used for the synchronization&quot;</font>;
  <font color="blue">parameter </font>String xmlFileName = &quot;socket.cfg&quot; <font color="darkgreen">
    &quot;Name of the file that is generated by the BCVTB and that contains the socket information&quot;</font>;
  <font color="blue">parameter </font>Integer nDblWri(min=0) <font color="darkgreen">
    &quot;Number of double values to write to the BCVTB&quot;</font>;
  <font color="blue">parameter </font>Integer nDblRea(min=0) <font color="darkgreen">
    &quot;Number of double values to be read from the BCVTB&quot;</font>;
  <font color="blue">parameter </font>Integer flaDblWri[nDblWri] =<font color="red"> zeros</font>(nDblWri) <font color="darkgreen">
    &quot;Flag for double values (0: use current value, 1: use average over interval, 2: use integral over interval)&quot;</font>;
  <font color="blue">parameter </font>Real uStart[nDblWri] <font color="darkgreen">
    &quot;Initial input signal, used during first data transfer with BCVTB&quot;</font>;
  <font color="blue">parameter </font>Real yRFixed[nDblRea] =<font color="red"> zeros</font>(nDblRea) <font color="darkgreen">
    &quot;Fixed output, used if activateInterface=false&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> uR[nDblWri] <font color="darkgreen">
    &quot;Real inputs to be sent to the BCVTB&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> yR[nDblRea] <font color="darkgreen">
    &quot;Real outputs received from the BCVTB&quot;</font>;</textblock>

 Integer flaRea <font color="darkgreen">&quot;Flag received from BCVTB&quot;</font>;
 <A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> simTimRea <font color="darkgreen">
    &quot;Current simulation time received from the BCVTB&quot;</font>;
 Integer retVal <font color="darkgreen">&quot;Return value from the BSD socket data exchange&quot;</font>;
<font color="blue">protected </font>
  <font color="blue">parameter </font>Integer socketFD(fixed=false) <font color="darkgreen">
    &quot;Socket file descripter, or a negative value if an error occured&quot;</font>;
  <font color="blue">parameter </font>Real _uStart[nDblWri](fixed=false) <font color="darkgreen">
    &quot;Initial input signal, used during first data transfer with BCVTB&quot;</font>;
  <font color="blue">constant </font>Integer flaWri=0;
  Real uRInt[nDblWri] <font color="darkgreen">&quot;Value of integral&quot;</font>;
  Real uRIntPre[nDblWri] <font color="darkgreen">&quot;Value of integral at previous sampling instance&quot;</font>;
<font color="blue">public </font>
  Real uRWri[nDblWri] <font color="darkgreen">&quot;Value to be sent to the interface&quot;</font>;
<font color="blue">initial </font><font color="blue">algorithm </font>
  socketFD :=<font color="blue">if </font>activateInterface<font color="blue"> then </font>
      <font color="red">Buildings.Utilities.IO.BCVTB.BaseClasses.establishClientSocket</font>(xmlFileName=xmlFileName)<font color="blue"> else </font>
      0;
  <font color="darkgreen">  // check for valid socketFD</font>
  <font color="red">   assert</font>(socketFD &gt;= 0, &quot;Socket file descripter for BCVTB must be positive.\n&quot; +
                         &quot;   A negative value indicates that no connection\n&quot; +
                         &quot;   could be established. Check file &#39;utilSocket.log&#39;.\n&quot; +
                         &quot;   Received: socketFD = &quot; +<font color="red"> String</font>(socketFD));
   flaRea   := 0;
   uRInt    :=<font color="red"> zeros</font>(nDblWri);
   uRIntPre :=<font color="red"> zeros</font>(nDblWri);
   <font color="blue">for </font>i<font color="blue"> in </font>1:nDblWri<font color="blue"> loop</font>
    <font color="red"> assert</font>(flaDblWri[i]&gt;=0<font color="blue"> and </font>flaDblWri[i]&lt;=2,
        &quot;Parameter flaDblWri out of range for &quot; +<font color="red"> String</font>(i) + &quot;-th component.&quot;);
     <font color="blue">if </font>(flaDblWri[i] == 0)<font color="blue"> then</font>
        _uStart[i] := uStart[i];<font color="darkgreen">               // Current value.</font>
     <font color="blue">elseif </font>(flaDblWri[i] == 1)<font color="blue"> then</font>
        _uStart[i] := uStart[i];<font color="darkgreen">                // Average over interval</font>
     <font color="blue">else</font>
        _uStart[i] := uStart[i]*samplePeriod;<font color="darkgreen">  // Integral over the sampling interval</font>
      <font color="darkgreen">                                         // This is multiplied with samplePeriod because if</font>
      <font color="darkgreen">                                         // u is power, then uRWri needs to be energy.</font>

     <font color="blue">end if</font>;
   <font color="blue">end for</font>;
  <font color="darkgreen"> // Exchange initial values</font>
    <font color="blue">if </font>activateInterface<font color="blue"> then</font>
      (flaRea, simTimRea, yR, retVal) :=
        <font color="red">Buildings.Utilities.IO.BCVTB.BaseClasses.exchangeReals</font>(
        socketFD=socketFD,
        flaWri=flaWri,
        simTimWri=time,
        dblValWri=_uStart,
        nDblWri=<font color="red">size</font>(uRWri, 1),
        nDblRea=<font color="red">size</font>(yR, 1));
    <font color="blue">else</font>
      flaRea := 0;
      simTimRea := time;
      yR := yRFixed;
      retVal := 0;
      <font color="blue">end if</font>;

<font color="blue">equation </font>
   <font color="blue">for </font>i<font color="blue"> in </font>1:nDblWri<font color="blue"> loop</font>
    <font color="red">  der</font>(uRInt[i]) = <font color="blue">if </font>(flaDblWri[i] &gt; 0)<font color="blue"> then </font>uR[i]<font color="blue"> else </font>0;
   <font color="blue">end for</font>;
<font color="blue">algorithm </font>
  <font color="blue">when </font>{sampleTrigger}<font color="blue"> then</font>
    <font color="red">assert</font>(flaRea == 0, &quot;BCVTB interface attempts to exchange data after Ptolemy reached its final time.\n&quot; +
                        &quot;   Aborting simulation. Check final time in Modelica and in Ptolemy.\n&quot; +
                        &quot;   Received: flaRea = &quot; +<font color="red"> String</font>(flaRea));
    <font color="darkgreen"> // Compute value that will be sent to the BCVTB interface</font>
     <font color="blue">for </font>i<font color="blue"> in </font>1:nDblWri<font color="blue"> loop</font>
       <font color="blue">if </font>(flaDblWri[i] == 0)<font color="blue"> then</font>
         uRWri[i] :=<font color="red">pre</font>(uR[i]);<font color="darkgreen">  // Send the current value.</font>
        <font color="darkgreen">                         // Without the pre(), Dymola 7.2 crashes during translation of Examples.MoistAir</font>
       <font color="blue">else</font>
         uRWri[i] :=uRInt[i] - uRIntPre[i];<font color="darkgreen"> // Integral over the sampling interval</font>
         <font color="blue">if </font>(flaDblWri[i] == 1)<font color="blue"> then</font>
            uRWri[i] := uRWri[i]/samplePeriod;<font color="darkgreen">   // Average value over the sampling interval</font>
         <font color="blue">end if</font>;
       <font color="blue">end if</font>;
      <font color="blue">end for</font>;

    <font color="darkgreen">// Exchange data</font>
    <font color="blue">if </font>activateInterface<font color="blue"> then</font>
      (flaRea, simTimRea, yR, retVal) :=
        <font color="red">Buildings.Utilities.IO.BCVTB.BaseClasses.exchangeReals</font>(
        socketFD=socketFD,
        flaWri=flaWri,
        simTimWri=time,
        dblValWri=uRWri,
        nDblWri=<font color="red">size</font>(uRWri, 1),
        nDblRea=<font color="red">size</font>(yR, 1));
    <font color="blue">else</font>
      flaRea := 0;
      simTimRea := time;
      yR := yRFixed;
      retVal := 0;
      <font color="blue">end if</font>;
    <font color="darkgreen">// Check for valid return flags</font>
    <font color="red">assert</font>(flaRea &gt;= 0, &quot;BCVTB sent a negative flag to Modelica during data transfer.\n&quot; +
                        &quot;   Aborting simulation. Check file &#39;utilSocket.log&#39;.\n&quot; +
                        &quot;   Received: flaRea = &quot; +<font color="red"> String</font>(flaRea));
    <font color="red">assert</font>(retVal &gt;= 0, &quot;Obtained negative return value during data transfer with BCVTB.\n&quot; +
                        &quot;   Aborting simulation. Check file &#39;utilSocket.log&#39;.\n&quot; +
                        &quot;   Received: retVal = &quot; +<font color="red"> String</font>(retVal));

    <font color="darkgreen">// Store current value of integral</font>
  uRIntPre:=uRInt;
  <font color="blue">end when</font>;
  <font color="darkgreen"> // Close socket connnection</font>
   <font color="blue">when </font><font color="red">terminal</font>()<font color="blue"> then</font>
     <font color="blue">if </font>activateInterface<font color="blue"> then</font>
      <font color="red">  Buildings.Utilities.IO.BCVTB.BaseClasses.closeClientSocket</font>(
                                                          socketFD);
     <font color="blue">end if</font>;
   <font color="blue">end when</font>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>BCVTB;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE To_degC<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Utilities.IO.BCVTB.To_degCI.png" ALT="Buildings.Utilities.IO.BCVTB.To_degC" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Utilities.IO.BCVTB.To_degC"></A><A HREF="Buildings_Utilities_IO_BCVTB.html#Buildings.Utilities.IO.BCVTB"
>Buildings.Utilities.IO.BCVTB</A>.To_degC</H2>
<B>Converts Kelvin to Celsius</B><p></P>
<IMG SRC="Buildings.Utilities.IO.BCVTB.To_degCD.png" ALT="Buildings.Utilities.IO.BCVTB.To_degC">
<P></P><H3>Information</H3>

<p>
Converts the input from degree Celsius to Kelvin.
Note that inside Modelica, it is strongly recommended to use
Kelvin. This block is provided for convenience since the BCVTB
interface may couple Modelica to programs that use Celsius 
as the unit for temperature.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BlockIcon"
>Modelica.Blocks.Interfaces.BlockIcon</A> (Basic graphical layout of input/output block).
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>Kelvin</TD><TD>Temperature in Kelvin [K]</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>Celsius</TD><TD>Temperature in Celsius [degC]</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> To_degC <font color="darkgreen">&quot;Converts Kelvin to Celsius&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BlockIcon"
>Modelica.Blocks.Interfaces.BlockIcon</A>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> Kelvin(<font color="blue">final </font>quantity=&quot;ThermodynamicTemperature&quot;,
                                              <font color="blue">final </font>unit = &quot;K&quot;, displayUnit = &quot;degC&quot;, min=0) <font color="darkgreen">
    &quot;Temperature in Kelvin&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> Celsius(<font color="blue">final </font>quantity=&quot;ThermodynamicTemperature&quot;,
                                                <font color="blue">final </font>unit = &quot;degC&quot;, displayUnit = &quot;degC&quot;, min=-273.15) <font color="darkgreen">
    &quot;Temperature in Celsius&quot;</font>;</textblock>
<font color="blue">equation </font>
  Kelvin =<font color="red"> Modelica.SIunits.Conversions.from_degC</font>(Celsius);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>To_degC;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE From_degC<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Utilities.IO.BCVTB.From_degCI.png" ALT="Buildings.Utilities.IO.BCVTB.From_degC" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Utilities.IO.BCVTB.From_degC"></A><A HREF="Buildings_Utilities_IO_BCVTB.html#Buildings.Utilities.IO.BCVTB"
>Buildings.Utilities.IO.BCVTB</A>.From_degC</H2>
<B>Converts Celsius to Kelvin</B><p></P>
<IMG SRC="Buildings.Utilities.IO.BCVTB.From_degCD.png" ALT="Buildings.Utilities.IO.BCVTB.From_degC">
<P></P><H3>Information</H3>

<p>
Converts the input from Kelvin to degree Celsius.
Note that inside Modelica, by convention, all models use
Kelvin. This block is provided for convenience since the BCVTB
interface may couple Modelica to programs that use Celsius 
as the unit for temperature.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BlockIcon"
>Modelica.Blocks.Interfaces.BlockIcon</A> (Basic graphical layout of input/output block).
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>Celsius</TD><TD>Temperature in Celsius [degC]</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>Kelvin</TD><TD>Temperature in Kelvin [K]</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> From_degC <font color="darkgreen">&quot;Converts Celsius to Kelvin&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BlockIcon"
>Modelica.Blocks.Interfaces.BlockIcon</A>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> Celsius(<font color="blue">final </font>quantity=&quot;ThermodynamicTemperature&quot;,
                                               <font color="blue">final </font>unit = &quot;degC&quot;, displayUnit = &quot;degC&quot;, min=-273.15) <font color="darkgreen">
    &quot;Temperature in Celsius&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> Kelvin(<font color="blue">final </font>quantity=&quot;ThermodynamicTemperature&quot;,
                                               <font color="blue">final </font>unit = &quot;K&quot;, displayUnit = &quot;degC&quot;, min=0) <font color="darkgreen">
    &quot;Temperature in Kelvin&quot;</font>;</textblock>
<font color="blue">equation </font>
  Celsius =<font color="red"> Modelica.SIunits.Conversions.to_degC</font>(Kelvin);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>From_degC;
</PRE>
<HR>
<address><a href="http://www.3ds.com/">Automatically generated</a> Fri Dec 13 11:39:41 2013.
</address></BODY>
</HTML>
