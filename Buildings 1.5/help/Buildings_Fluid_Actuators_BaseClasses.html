<HTML>
<HEAD>
<TITLE>Buildings.Fluid.Actuators.BaseClasses</TITLE>
<META name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META name="description" content="&quot;Package with base classes for Buildings.Fluid.Actuators&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- --- header ------ -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- --- end header -- -->
</P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE BaseClasses<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Fluid.Actuators.BaseClasses"></A><A HREF="Buildings_Fluid_Actuators.html#Buildings.Fluid.Actuators"
>Buildings.Fluid.Actuators</A>.BaseClasses</H2>
<B>Package with base classes for Buildings.Fluid.Actuators</B>
<P></P>
<P></P><H3>Information</H3>

<p>
This package contains base classes that are used to construct the models in
<A HREF="Buildings_Fluid_Actuators.html#Buildings.Fluid.Actuators"
>Buildings.Fluid.Actuators</a>.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons_BasesPackage.html#Modelica.Icons.BasesPackage"
>Modelica.Icons.BasesPackage</A> (Icon for packages containing base classes).
<P></P><H3>Package Content</H3>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Actuators05b8ecb1449abd53ignalS.png" ALT="Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal"
>ActuatorSignal</A>
</TD><TD>Partial model that implements the filtered opening for valves and dampers</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Actuators2c08592b56e2d47fntialS.png" ALT="Buildings.Fluid.Actuators.BaseClasses.PartialDamperExponential" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.PartialDamperExponential"
>PartialDamperExponential</A>
</TD><TD>Partial model for air dampers with exponential opening characteristics</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Actuators8b7314e2935a9e36ValveS.png" ALT="Buildings.Fluid.Actuators.BaseClasses.PartialThreeWayValve" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.PartialThreeWayValve"
>PartialThreeWayValve</A>
</TD><TD>Partial three way valve</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Actuators8f28c1b0799bc0dcValveS.png" ALT="Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve"
>PartialTwoWayValve</A>
</TD><TD>Partial model for a two way valve</TD></TR>
<TR><TD><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ValveParameters"
>ValveParameters</A>
</TD><TD>Model with parameters for valves</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Actuatorsc90dad90afeece15ntageS.png" ALT="Buildings.Fluid.Actuators.BaseClasses.der_equalPercentage" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.der_equalPercentage"
>der_equalPercentage</A>
</TD><TD>Derivative of valve opening characteristics for equal percentage valve</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Actuatorsc90dad90afeece15ntageS.png" ALT="Buildings.Fluid.Actuators.BaseClasses.equalPercentage" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.equalPercentage"
>equalPercentage</A>
</TD><TD>Valve opening characteristics for equal percentage valve</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Actuatorsc90dad90afeece15ntageS.png" ALT="Buildings.Fluid.Actuators.BaseClasses.exponentialDamper" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.exponentialDamper"
>exponentialDamper</A>
</TD><TD>Damper opening characteristics for an exponential damper</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Actuators8d59ca857b6ac398mplesS.png" ALT="Buildings.Fluid.Actuators.BaseClasses.Examples" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Actuators_BaseClasses_Examples.html#Buildings.Fluid.Actuators.BaseClasses.Examples"
>Examples</A>
</TD><TD>Collection of models that illustrate model use and test models</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE ActuatorSignal<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Actuators05b8ecb1449abd53ignalI.png" ALT="Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal"></A><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses"
>Buildings.Fluid.Actuators.BaseClasses</A>.ActuatorSignal</H2>
<B>Partial model that implements the filtered opening for valves and dampers</B><p></P>
<IMG SRC="Buildings.Fluid.Actuators05b8ecb1449abd53ignalD.png" ALT="Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal">
<P></P><H3>Information</H3>

<p>
This model implements the filter that is used to approximate the travel
time of the actuator.
Models that extend this model use the signal 
<code>y_actual</code> to obtain the
current position of the actuator.
</p>
<p>
See 
<A HREF="Buildings_Fluid_Actuators_UsersGuide.html#Buildings.Fluid.Actuators.UsersGuide"
>
Buildings.Fluid.Actuators.UsersGuide</a>
for a description of the filter.
</p>
<P></P>

<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Filtered opening</TD></TR>
<TR><TD>Boolean</TD><TD>filteredOpening</TD><TD>true</TD><TD>= true, if opening is filtered with a 2nd order CriticalDamping filter</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>riseTime</TD><TD>120</TD><TD>Rise time of the filter (time to reach 99.6 % of an opening step) [s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Blocks_Types.html#Modelica.Blocks.Types.Init"
>Init</A></TD><TD>init</TD><TD>Modelica.Blocks.Types.Init.I...</TD><TD>Type of initialization (no init/steady state/initial state/initial output)</TD></TR>
<TR><TD>Real</TD><TD>y_start</TD><TD>1</TD><TD>Initial value of output</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>y</TD><TD>Actuator position (0: closed, 1: open)</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y_actual</TD><TD>Actual valve position</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> ActuatorSignal <font color="darkgreen">
  &quot;Partial model that implements the filtered opening for valves and dampers&quot;</font>

  <font color="blue">parameter </font>Boolean filteredOpening=true <font color="darkgreen">
    &quot;= true, if opening is filtered with a 2nd order CriticalDamping filter&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> riseTime=120 <font color="darkgreen">
    &quot;Rise time of the filter (time to reach 99.6 % of an opening step)&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Blocks_Types.html#Modelica.Blocks.Types.Init"
>Modelica.Blocks.Types.Init</A> init=Modelica.Blocks.Types.Init.InitialOutput <font color="darkgreen">
    &quot;Type of initialization (no init/steady state/initial state/initial output)&quot;</font>;
  <font color="blue">parameter </font>Real y_start=1 <font color="darkgreen">&quot;Initial value of output&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> y(min=0, max=1) <font color="darkgreen">
    &quot;Actuator position (0: closed, 1: open)&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> y_actual <font color="darkgreen">&quot;Actual valve position&quot;</font>;</textblock>

  <font color="darkgreen">// Classes used to implement the filtered opening</font>
<textblock type="annotcomp" expanded="false"><font color="blue">protected </font>
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> y_filtered <font color="blue">if </font>filteredOpening <font color="darkgreen">
    &quot;Filtered valve position in the range 0..1&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Continuous.html#Modelica.Blocks.Continuous.Filter"
>Modelica.Blocks.Continuous.Filter</A> filter(
     order=2,
     f_cut=5/(2*Modelica.Constants.pi*riseTime),
     <font color="blue">final </font>init=init,
     <font color="blue">final </font>y_start=y_start,
     <font color="blue">final </font>analogFilter=Modelica.Blocks.Types.AnalogFilter.CriticalDamping,
     <font color="blue">final </font>filterType=Modelica.Blocks.Types.FilterType.LowPass,
     x(<font color="blue">each </font>stateSelect=StateSelect.always)) <font color="blue">if </font>
        filteredOpening <font color="darkgreen">
    &quot;Second order filter to approximate valve opening time, and to improve numerics&quot;</font>;</textblock>

<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false"> <font color="red">connect</font>(filter.y, y_filtered);</textblock>
  <font color="blue">if </font>filteredOpening<font color="blue"> then</font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(y, filter.u);
  <font color="red">connect</font>(filter.y, y_actual);</textblock>
  <font color="blue">else</font>
<textblock type="annotconnect" expanded="false">    <font color="red">connect</font>(y, y_actual);</textblock>
  <font color="blue">end if</font>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>ActuatorSignal;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE PartialDamperExponential<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Actuators2c08592b56e2d47fntialI.png" ALT="Buildings.Fluid.Actuators.BaseClasses.PartialDamperExponential" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Actuators.BaseClasses.PartialDamperExponential"></A><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses"
>Buildings.Fluid.Actuators.BaseClasses</A>.PartialDamperExponential</H2>
<B>Partial model for air dampers with exponential opening characteristics</B><p></P>
<IMG SRC="Buildings.Fluid.Actuators2c08592b56e2d47fntialD.png" ALT="Buildings.Fluid.Actuators.BaseClasses.PartialDamperExponential">
<P></P><H3>Information</H3>

<p>
Partial model for air dampers with exponential opening characteristics. 
This is the base model for air dampers and variable air volume flow boxes.
The model implements the functions that relate the opening signal, 
the pressure drop and the mass flow rate.
The model also defines parameters that are used by different air damper
models.
</p>
<p>
For a description of the opening characteristics and typical parameter values, see the damper model
<A HREF="Buildings_Fluid_Actuators_Dampers.html#Buildings.Fluid.Actuators.Dampers.Exponential"
>
Exponential</a>.
</p>
<P></P>
Extends from <A HREF="Buildings_Fluid_BaseClasses.html#Buildings.Fluid.BaseClasses.PartialResistance"
>Buildings.Fluid.BaseClasses.PartialResistance</A> (Partial model for a hydraulic resistance), <A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal"
>Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal</A> (Partial model that implements the filtered opening for valves and dampers).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_turbulent</TD><TD>if use_deltaM then deltaM*m_...</TD><TD>Turbulent flow if |m_flow| &gt;= m_flow_turbulent [kg/s]</TD></TR>
<TR><TD>Boolean</TD><TD>use_deltaM</TD><TD>true</TD><TD>Set to true to use deltaM for turbulent transition, else ReC is used</TD></TR>
<TR><TD>Real</TD><TD>deltaM</TD><TD>0.3</TD><TD>Fraction of nominal mass flow rate where transition to turbulent occurs</TD></TR>
<TR><TD>Boolean</TD><TD>use_v_nominal</TD><TD>true</TD><TD>Set to true to use face velocity to compute area</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Velocity</A></TD><TD>v_nominal</TD><TD>1</TD><TD>Nominal face velocity [m/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</A></TD><TD>A</TD><TD>m_flow_nominal/rho_default/v...</TD><TD>Face area [m2]</TD></TR>
<TR><TD>Boolean</TD><TD>roundDuct</TD><TD>false</TD><TD>Set to true for round duct, false for square cross section</TD></TR>
<TR><TD>Real</TD><TD>ReC</TD><TD>4000</TD><TD>Reynolds number where transition to turbulent starts</TD></TR>
<TR><TD>Real</TD><TD>kFixed</TD><TD>&nbsp;</TD><TD>Flow coefficient of fixed resistance that may be in series with damper, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2).</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dp_nominal</TD><TD>&nbsp;</TD><TD>Pressure drop at nominal mass flow rate [Pa]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Initialization</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow.start</TD><TD>0</TD><TD>Mass flow rate from port_a to port_b (m_flow &gt; 0 is design flow direction) [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dp.start</TD><TD>0</TD><TD>Pressure difference between port_a and port_b [Pa]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Assumptions</B></TD></TR>
<TR><TD>Boolean</TD><TD>allowFlowReversal</TD><TD>system.allowFlowReversal</TD><TD>= true to allow flow reversal, false restricts to design direction (port_a -&gt; port_b)</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Advanced</B></TD></TR>
<TR><TD>Boolean</TD><TD>homotopyInitialization</TD><TD>true</TD><TD>= true, use homotopy method</TD></TR>
<TR><TD>Boolean</TD><TD>from_dp</TD><TD>false</TD><TD>= true, use m_flow = f(dp) else dp = f(m_flow)</TD></TR>
<TR><TD>Boolean</TD><TD>linearized</TD><TD>false</TD><TD>= true, use linear relation between m_flow and dp for any flow rate</TD></TR>
<TR><TD>Boolean</TD><TD>use_constant_density</TD><TD>true</TD><TD>Set to true to use constant density for flow friction</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Diagnostics</TD></TR>
<TR><TD>Boolean</TD><TD>show_T</TD><TD>false</TD><TD>= true, if actual temperature at port is computed</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Filtered opening</TD></TR>
<TR><TD>Boolean</TD><TD>filteredOpening</TD><TD>true</TD><TD>= true, if opening is filtered with a 2nd order CriticalDamping filter</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>riseTime</TD><TD>120</TD><TD>Rise time of the filter (time to reach 99.6 % of an opening step) [s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Blocks_Types.html#Modelica.Blocks.Types.Init"
>Init</A></TD><TD>init</TD><TD>Modelica.Blocks.Types.Init.I...</TD><TD>Type of initialization (no init/steady state/initial state/initial output)</TD></TR>
<TR><TD>Real</TD><TD>y_start</TD><TD>1</TD><TD>Initial value of output</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Damper coefficients</B></TD></TR>
<TR><TD>Real</TD><TD>a</TD><TD>-1.51</TD><TD>Coefficient a for damper characteristics</TD></TR>
<TR><TD>Real</TD><TD>b</TD><TD>0.105*90</TD><TD>Coefficient b for damper characteristics</TD></TR>
<TR><TD>Real</TD><TD>yL</TD><TD>15/90</TD><TD>Lower value for damper curve</TD></TR>
<TR><TD>Real</TD><TD>yU</TD><TD>55/90</TD><TD>Upper value for damper curve</TD></TR>
<TR><TD>Real</TD><TD>k0</TD><TD>1E6</TD><TD>Flow coefficient for y=0, k0 = pressure drop divided by dynamic pressure</TD></TR>
<TR><TD>Real</TD><TD>k1</TD><TD>0.45</TD><TD>Flow coefficient for y=1, k1 = pressure drop divided by dynamic pressure</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_a</TD><TD>Fluid connector a (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>port_b</TD><TD>Fluid connector b (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>y</TD><TD>Actuator position (0: closed, 1: open)</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y_actual</TD><TD>Actual valve position</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">partial </font><font color="blue">model</font> PartialDamperExponential <font color="darkgreen">
  &quot;Partial model for air dampers with exponential opening characteristics&quot;</font>
   <font color="blue">extends </font><A HREF="Buildings_Fluid_BaseClasses.html#Buildings.Fluid.BaseClasses.PartialResistance"
>Buildings.Fluid.BaseClasses.PartialResistance</A>(
      m_flow_turbulent=<font color="blue">if </font>use_deltaM<font color="blue"> then </font>deltaM * m_flow_nominal<font color="blue"> else </font>
      eta_default*ReC*<font color="red">sqrt</font>(area)*facRouDuc);
   <font color="blue">extends </font><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal"
>Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal</A>;
 <font color="blue">parameter </font>Boolean use_deltaM = true <font color="darkgreen">
    &quot;Set to true to use deltaM for turbulent transition, else ReC is used&quot;</font>;
 <font color="blue">parameter </font>Real deltaM = 0.3 <font color="darkgreen">
    &quot;Fraction of nominal mass flow rate where transition to turbulent occurs&quot;</font>;
 <font color="blue">parameter </font>Boolean use_v_nominal = true <font color="darkgreen">
    &quot;Set to true to use face velocity to compute area&quot;</font>;
 <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Modelica.SIunits.Velocity</A> v_nominal=1 <font color="darkgreen">&quot;Nominal face velocity&quot;</font>;
 <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Modelica.SIunits.Area</A> A=m_flow_nominal/rho_default/v_nominal <font color="darkgreen">
    &quot;Face area&quot;</font>;
 <font color="blue">parameter </font>Boolean roundDuct = false <font color="darkgreen">
    &quot;Set to true for round duct, false for square cross section&quot;</font>;
 <font color="blue">parameter </font>Real ReC=4000 <font color="darkgreen">&quot;Reynolds number where transition to turbulent starts&quot;</font>;
 <font color="blue">parameter </font>Real a(unit=&quot;&quot;)=-1.51 <font color="darkgreen">&quot;Coefficient a for damper characteristics&quot;</font>;
 <font color="blue">parameter </font>Real b(unit=&quot;&quot;)=0.105*90 <font color="darkgreen">&quot;Coefficient b for damper characteristics&quot;</font>;
 <font color="blue">parameter </font>Real yL = 15/90 <font color="darkgreen">&quot;Lower value for damper curve&quot;</font>;
 <font color="blue">parameter </font>Real yU = 55/90 <font color="darkgreen">&quot;Upper value for damper curve&quot;</font>;
 <font color="blue">parameter </font>Real k0(min=0) = 1E6 <font color="darkgreen">
    &quot;Flow coefficient for y=0, k0 = pressure drop divided by dynamic pressure&quot;</font>;
 <font color="blue">parameter </font>Real k1(min=0) = 0.45 <font color="darkgreen">
    &quot;Flow coefficient for y=1, k1 = pressure drop divided by dynamic pressure&quot;</font>;
 <font color="blue">parameter </font>Boolean use_constant_density=true <font color="darkgreen">
    &quot;Set to true to use constant density for flow friction&quot;</font>;
 <A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Density"
>Medium.Density</A> rho <font color="darkgreen">&quot;Medium density&quot;</font>;
 <font color="blue">parameter </font>Real kFixed(unit=&quot;&quot;) <font color="darkgreen">
    &quot;Flow coefficient of fixed resistance that may be in series with damper, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2).&quot;</font>;
 Real kDam(unit=&quot;&quot;) <font color="darkgreen">
    &quot;Flow coefficient of damper, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2)&quot;</font>;
 Real k(unit=&quot;&quot;) <font color="darkgreen">
    &quot;Flow coefficient of damper plus fixed resistance, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2)&quot;</font>;
<font color="blue">protected </font>
 <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Density"
>Medium.Density</A> rho_default=<font color="red">Medium.density</font>(sta_default) <font color="darkgreen">
    &quot;Density, used to compute fluid volume&quot;</font>;
 <font color="blue">parameter </font>Real[3] cL=
    {(<font color="red">Modelica.Math.log</font>(k0) - b - a)/yL^2,
      (-b*yL - 2*<font color="red">Modelica.Math.log</font>(k0) + 2*b + 2*a)/yL,
      <font color="red">Modelica.Math.log</font>(k0)} <font color="darkgreen">&quot;Polynomial coefficients for curve fit for y &lt; yl&quot;</font>;
 <font color="blue">parameter </font>Real[3] cU=
    {(<font color="red">Modelica.Math.log</font>(k1) - a)/(yU^2 - 2*yU + 1),
    (-b*yU^2 - 2*<font color="red">Modelica.Math.log</font>(k1)*yU - (-2*b - 2*a)*yU - b)/(yU^2 - 2*yU + 1),
    (<font color="red">Modelica.Math.log</font>(k1)*yU^2 + b*yU^2 + (-2*b - 2*a)*yU + b + a)/(yU^2 - 2*yU + 1)} <font color="darkgreen">
    &quot;Polynomial coefficients for curve fit for y &gt; yu&quot;</font>;
 <font color="blue">parameter </font>Real facRouDuc= <font color="blue">if </font>roundDuct<font color="blue"> then </font><font color="red">sqrt</font>(Modelica.Constants.pi)/2<font color="blue"> else </font>1;
 <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Modelica.SIunits.Area</A> area=
    <font color="blue">if </font>use_v_nominal<font color="blue"> then </font>m_flow_nominal/rho_default/v_nominal<font color="blue"> else </font>A <font color="darkgreen">
    &quot;Face velocity used in the computation&quot;</font>;
<font color="blue">initial </font><font color="blue">equation </font>
  <font color="red">assert</font>(k0 &gt; k1, &quot;k0 must be bigger than k1.&quot;);
  <font color="red">assert</font>(m_flow_turbulent &gt; 0, &quot;m_flow_turbulent must be bigger than zero.&quot;);
<font color="blue">equation </font>
  rho = <font color="blue">if </font>use_constant_density<font color="blue"> then </font>
         rho_default<font color="blue"> else </font>
         <font color="red">Medium.density</font>(<font color="red">Medium.setState_phX</font>(port_a.p,<font color="red"> inStream</font>(port_a.h_outflow),<font color="red"> inStream</font>(port_a.Xi_outflow)));
  <font color="darkgreen">// flow coefficient, k=m_flow/sqrt(dp)</font>
  kDam=<font color="red">sqrt</font>(2*rho)*area/<font color="red">Buildings.Fluid.Actuators.BaseClasses.exponentialDamper</font>(
    y=y_actual,
    a=a,
    b=b,
    cL=cL,
    cU=cU,
    yL=yL,
    yU=yU);
  k = <font color="blue">if </font>(kFixed&gt;Modelica.Constants.eps)<font color="blue"> then </font><font color="red">sqrt</font>(1/(1/kFixed^2 + 1/kDam^2))<font color="blue"> else </font>kDam;
  <font color="darkgreen">// Pressure drop calculation</font>
  <font color="blue">if </font>linearized<font color="blue"> then</font>
    m_flow*m_flow_nominal_pos = k^2*dp;
  <font color="blue">else</font>
    <font color="blue">if </font>homotopyInitialization<font color="blue"> then</font>
      <font color="blue">if </font>from_dp<font color="blue"> then</font>
        m_flow=<font color="red">homotopy</font>(
           actual=<font color="red">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_dp</font>(
                  dp=dp, k=k,
                  m_flow_turbulent=m_flow_turbulent),
           simplified=m_flow_nominal_pos*dp/dp_nominal_pos);
      <font color="blue">else</font>
        dp=<font color="red">homotopy</font>(
           actual=<font color="red">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_m_flow</font>(
                  m_flow=m_flow, k=k,
                  m_flow_turbulent=m_flow_turbulent),
           simplified=dp_nominal_pos*m_flow/m_flow_nominal_pos);
       <font color="blue">end if</font>;<font color="darkgreen">  // from_dp</font>
    <font color="blue">else</font><font color="darkgreen"> // do not use homotopy</font>
      <font color="blue">if </font>from_dp<font color="blue"> then</font>
        m_flow=<font color="red">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_dp</font>(
                 dp=dp, k=k, m_flow_turbulent=m_flow_turbulent);
      <font color="blue">else</font>
        dp=<font color="red">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_m_flow</font>(
                 m_flow=m_flow, k=k, m_flow_turbulent=m_flow_turbulent);
      <font color="blue">end if</font>;<font color="darkgreen">  // from_dp</font>
    <font color="blue">end if</font>;<font color="darkgreen"> // homotopyInitialization</font>
  <font color="blue">end if</font>;<font color="darkgreen"> // linearized</font>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>PartialDamperExponential;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE PartialThreeWayValve<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Actuators8b7314e2935a9e36ValveI.png" ALT="Buildings.Fluid.Actuators.BaseClasses.PartialThreeWayValve" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Actuators.BaseClasses.PartialThreeWayValve"></A><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses"
>Buildings.Fluid.Actuators.BaseClasses</A>.PartialThreeWayValve</H2>
<B>Partial three way valve</B><p></P>
<IMG SRC="Buildings.Fluid.Actuators8b7314e2935a9e36ValveD.png" ALT="Buildings.Fluid.Actuators.BaseClasses.PartialThreeWayValve">
<P></P><H3>Information</H3>

<p>
Partial model of a three way valve. This is the base model for valves
with different opening characteristics, such as linear, equal percentage
or quick opening. The three way valve model consists of a mixer where 
valves are placed in two of the flow legs. The third flow leg
has no friction. 
The flow coefficient <code>Kv</code> for flow from <code>port_1 -> port_2</code> is
a parameter. 
The flow coefficient for the bypass flow from <code>port_3 -> port_2</code>
is computed as
</p>
<pre>
         Kv(port_3 -> port_2)
  fraK = ----------------------
         Kv(port_1 -> port_2)
</pre> 
<p>
where <code>0 &lt; fraK &le; 1</code> is a parameter with a default value
of <code>fraK=0.7</code>.
</p>
<p>
Since this model uses two way valves to construct a three way valve, see 
<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve"
>
Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve</a> 
for details regarding the valve implementation.
</p>
<P></P>
Extends from <A HREF="Buildings_Fluid_BaseClasses.html#Buildings.Fluid.BaseClasses.PartialThreeWayResistance"
>Buildings.Fluid.BaseClasses.PartialThreeWayResistance</A> (Flow splitter with partial resistance model at each port), <A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal"
>Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal</A> (Partial model that implements the filtered opening for valves and dampers), <A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ValveParameters"
>Buildings.Fluid.Actuators.BaseClasses.ValveParameters</A> (Model with parameters for valves).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD>Real</TD><TD>fraK</TD><TD>0.7</TD><TD>Fraction Kv(port_3-&gt;port_2)/Kv(port_1-&gt;port_2)</TD></TR>
<TR><TD>Real</TD><TD>l[2]</TD><TD>{0,0}</TD><TD>Valve leakage, l=Kv(y=0)/Kv(y=1)</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Flow Coefficient</TD></TR>
<TR><TD><A HREF="Buildings_Fluid_Types.html#Buildings.Fluid.Types.CvTypes"
>CvTypes</A></TD><TD>CvData</TD><TD>Buildings.Fluid.Types.CvType...</TD><TD>Selection of flow coefficient</TD></TR>
<TR><TD>Real</TD><TD>Kv</TD><TD>&nbsp;</TD><TD>Kv (metric) flow coefficient [m3/h/(bar)^(1/2)]</TD></TR>
<TR><TD>Real</TD><TD>Cv</TD><TD>&nbsp;</TD><TD>Cv (US) flow coefficient [USG/min/(psi)^(1/2)]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</A></TD><TD>Av</TD><TD>&nbsp;</TD><TD>Av (metric) flow coefficient [m2]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Pressure-flow linearization</TD></TR>
<TR><TD>Real</TD><TD>deltaM</TD><TD>0.02</TD><TD>Fraction of nominal flow rate where linearization starts, if y=1</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dpValve_nominal</TD><TD>&nbsp;</TD><TD>Nominal pressure drop of fully open valve, used if CvData=Buildings.Fluid.Types.CvTypes.OpPoint [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dpFixed_nominal[2]</TD><TD>{0,0}</TD><TD>Nominal pressure drop of pipes and other equipment in flow legs at port_1 and port_3 [Pa]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Equations</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>energyDynamics</TD><TD>Modelica.Fluid.Types.Dynamic...</TD><TD>Formulation of energy balance</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>massDynamics</TD><TD>energyDynamics</TD><TD>Formulation of mass balance</TD></TR>
<TR><TD>Boolean</TD><TD>dynamicBalance</TD><TD>true</TD><TD>Set to true to use a dynamic balance, which often leads to smaller systems of equations</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mDyn_flow_nominal</TD><TD>m_flow_nominal</TD><TD>Nominal mass flow rate for dynamic momentum and energy balance [kg/s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>tau</TD><TD>10</TD><TD>Time constant at nominal flow for dynamic energy and momentum balance [s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Filtered opening</TD></TR>
<TR><TD>Boolean</TD><TD>filteredOpening</TD><TD>true</TD><TD>= true, if opening is filtered with a 2nd order CriticalDamping filter</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>riseTime</TD><TD>120</TD><TD>Rise time of the filter (time to reach 99.6 % of an opening step) [s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Blocks_Types.html#Modelica.Blocks.Types.Init"
>Init</A></TD><TD>init</TD><TD>Modelica.Blocks.Types.Init.I...</TD><TD>Type of initialization (no init/steady state/initial state/initial output)</TD></TR>
<TR><TD>Real</TD><TD>y_start</TD><TD>1</TD><TD>Initial value of output</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Initialization</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>AbsolutePressure</A></TD><TD>p_start</TD><TD>Medium.p_default</TD><TD>Start value of pressure [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_start</TD><TD>Medium.T_default</TD><TD>Start value of temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>MassFraction</A></TD><TD>X_start[Medium.nX]</TD><TD>Medium.X_default</TD><TD>Start value of mass fractions m_i/m [kg/kg]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_start[Medium.nC]</TD><TD>fill(0, Medium.nC)</TD><TD>Start value of trace substances</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_nominal[Medium.nC]</TD><TD>fill(1E-2, Medium.nC)</TD><TD>Nominal value of trace substances. (Set to typical order of magnitude.)</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Advanced</B></TD></TR>
<TR><TD>Boolean</TD><TD>from_dp</TD><TD>true</TD><TD>= true, use m_flow = f(dp) else dp = f(m_flow)</TD></TR>
<TR><TD>Boolean</TD><TD>homotopyInitialization</TD><TD>true</TD><TD>= true, use homotopy method</TD></TR>
<TR><TD>Boolean</TD><TD>linearized[2]</TD><TD>{false,false}</TD><TD>= true, use linear relation between m_flow and dp for any flow rate</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Density</A></TD><TD>rhoStd</TD><TD>Medium.density_pTX(101325, 2...</TD><TD>Inlet density for which valve coefficients are defined [kg/m3]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_1</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>port_2</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_3</TD><TD>&nbsp;</TD></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>y</TD><TD>Actuator position (0: closed, 1: open)</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y_actual</TD><TD>Actual valve position</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">partial </font><font color="blue">model</font> PartialThreeWayValve <font color="darkgreen">&quot;Partial three way valve&quot;</font>
  <font color="blue">extends </font><A HREF="Buildings_Fluid_BaseClasses.html#Buildings.Fluid.BaseClasses.PartialThreeWayResistance"
>Buildings.Fluid.BaseClasses.PartialThreeWayResistance</A>(
      <font color="blue">final </font>mDyn_flow_nominal = m_flow_nominal,
        <font color="blue">redeclare </font><font color="blue">replaceable </font><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve"
>Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve</A>
            res1 <font color="blue">constrainedby </font>
      Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve(
               deltaM=deltaM,
               dp(start=dpValve_nominal/2),
               from_dp=from_dp,
               <font color="blue">redeclare </font><font color="blue">final </font><font color="blue">package</font> Medium = Medium,
               <font color="blue">final </font>l=l[1],
               <font color="blue">final </font>linearized=linearized[1],
               <font color="blue">final </font>homotopyInitialization=homotopyInitialization,
               <font color="blue">final </font>CvData=Buildings.Fluid.Types.CvTypes.OpPoint,
               <font color="blue">final </font>m_flow_nominal=m_flow_nominal,
               <font color="blue">final </font>dpValve_nominal=dpValve_nominal,
               <font color="blue">final </font>dpFixed_nominal=dpFixed_nominal[1],
               <font color="blue">final </font>filteredOpening=false),
        <font color="blue">redeclare </font><A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.LosslessPipe"
>FixedResistances.LosslessPipe</A> res2(
          <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium, m_flow_nominal=m_flow_nominal),
        <font color="blue">redeclare </font><font color="blue">replaceable </font><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve"
>Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve</A>
            res3 <font color="blue">constrainedby </font>
      Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve(
               deltaM=deltaM,
               dp(start=dpValve_nominal/2),
               from_dp=from_dp,
               <font color="blue">redeclare </font><font color="blue">final </font><font color="blue">package</font> Medium = Medium,
               <font color="blue">final </font>l=l[2],
               <font color="blue">final </font>linearized=linearized[2],
               <font color="blue">final </font>homotopyInitialization=homotopyInitialization,
               <font color="blue">final </font>CvData=Buildings.Fluid.Types.CvTypes.OpPoint,
               <font color="blue">final </font>m_flow_nominal=m_flow_nominal,
               <font color="blue">final </font>dpValve_nominal=dpValve_nominal/fraK^2,
               <font color="blue">final </font>dpFixed_nominal=dpFixed_nominal[2],
               <font color="blue">final </font>filteredOpening=false));
    <font color="blue">extends </font><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal"
>Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal</A>;
    <font color="blue">extends </font><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ValveParameters"
>Buildings.Fluid.Actuators.BaseClasses.ValveParameters</A>(
      rhoStd=<font color="red">Medium.density_pTX</font>(101325, 273.15+4, Medium.X_default));
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Modelica.SIunits.Pressure</A> dpFixed_nominal[2](<font color="blue">each </font>displayUnit=&quot;Pa&quot;,
                                                         <font color="blue">each </font>min=0) = {0, 0} <font color="darkgreen">
    &quot;Nominal pressure drop of pipes and other equipment in flow legs at port_1 and port_3&quot;</font>;

  <font color="blue">parameter </font>Real fraK(min=0, max=1) = 0.7 <font color="darkgreen">
    &quot;Fraction Kv(port_3-&gt;port_2)/Kv(port_1-&gt;port_2)&quot;</font>;
  <font color="blue">parameter </font>Real[2] l(<font color="blue">each </font>min=0, <font color="blue">each </font>max=1) = {0, 0} <font color="darkgreen">
    &quot;Valve leakage, l=Kv(y=0)/Kv(y=1)&quot;</font>;
  <font color="blue">parameter </font>Real deltaM = 0.02 <font color="darkgreen">
    &quot;Fraction of nominal flow rate where linearization starts, if y=1&quot;</font>;

  <font color="blue">parameter </font>Boolean[2] linearized = {false, false} <font color="darkgreen">
    &quot;= true, use linear relation between m_flow and dp for any flow rate&quot;</font>;

<textblock type="annotcomp" expanded="false"><font color="blue">protected </font>
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Feedback"
>Modelica.Blocks.Math.Feedback</A> inv <font color="darkgreen">&quot;Inversion of control signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> uni(<font color="blue">final </font>k=1) <font color="darkgreen">
    &quot;Outputs one for bypass valve&quot;</font>;</textblock>
<font color="blue">equation </font>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(uni.y, inv.u1);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>PartialThreeWayValve;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE PartialTwoWayValve<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Actuators8f28c1b0799bc0dcValveI.png" ALT="Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve"></A><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses"
>Buildings.Fluid.Actuators.BaseClasses</A>.PartialTwoWayValve</H2>
<B>Partial model for a two way valve</B><p></P>
<IMG SRC="Buildings.Fluid.Actuators8f28c1b0799bc0dcValveD.png" ALT="Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve">
<P></P><H3>Information</H3>

<p>
Partial model for a two way valve. This is the base model for valves
with different opening characteristics, such as linear, equal percentage
or quick opening.
</p>
<h4>Modelling options</h4>
<p>
The following options have been adapted from the valve implementation 
in <A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid"
>
Modelica.Fluid</a> 
and are described in 
<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ValveParameters"
>
Buildings.Fluid.Actuators.BaseClasses.ValveParameters</a>.
</p>
<p>
In contrast to the model in <A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid"
>
Modelica.Fluid</a>, this model uses the parameter <code>Kv_SI</code>,
which is the flow coefficient in SI units, i.e., 
it is the ratio between mass flow rate in <code>kg/s</code> and square root 
of pressure drop in <code>Pa</code>.
</p>
<p>
To prevent the derivative <code>d/dP (m_flow)</code> to be infinite near
the origin, this model linearizes the pressure drop versus flow relation
ship. The region in which it is linearized is parameterized by 
</p>
<pre>
  m_turbulent_flow = deltaM * m_flow_nominal
</pre>
<p>
Because the parameterization contains <code>Kv_SI</code>, the values for
<code>deltaM</code> and <code>dp_nominal</code> need not be changed if the valve size
changes.
</p>
<h4>Implementation</h4>
<p>
The two way valve models are implemented using this partial model, as opposed to using
different functions for the valve opening characteristics, because
each valve opening characteristics has different parameters.
</p>
<P></P>
Extends from <A HREF="Buildings_Fluid_BaseClasses.html#Buildings.Fluid.BaseClasses.PartialResistance"
>Buildings.Fluid.BaseClasses.PartialResistance</A> (Partial model for a hydraulic resistance), <A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ValveParameters"
>Buildings.Fluid.Actuators.BaseClasses.ValveParameters</A> (Model with parameters for valves), <A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal"
>Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal</A> (Partial model that implements the filtered opening for valves and dampers).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_turbulent</TD><TD>deltaM*abs(m_flow_nominal)</TD><TD>Turbulent flow if |m_flow| &gt;= m_flow_turbulent [kg/s]</TD></TR>
<TR><TD>Real</TD><TD>l</TD><TD>0.0001</TD><TD>Valve leakage, l=Kv(y=0)/Kv(y=1)</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dp_nominal</TD><TD>dpValve_nominal + dpFixed_no...</TD><TD>Pressure drop at nominal mass flow rate [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dpValve_nominal</TD><TD>&nbsp;</TD><TD>Nominal pressure drop of fully open valve, used if CvData=Buildings.Fluid.Types.CvTypes.OpPoint [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dpFixed_nominal</TD><TD>0</TD><TD>Pressure drop of pipe and other resistances that are in series [Pa]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Initialization</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow.start</TD><TD>0</TD><TD>Mass flow rate from port_a to port_b (m_flow &gt; 0 is design flow direction) [kg/s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Flow Coefficient</TD></TR>
<TR><TD><A HREF="Buildings_Fluid_Types.html#Buildings.Fluid.Types.CvTypes"
>CvTypes</A></TD><TD>CvData</TD><TD>Buildings.Fluid.Types.CvType...</TD><TD>Selection of flow coefficient</TD></TR>
<TR><TD>Real</TD><TD>Kv</TD><TD>&nbsp;</TD><TD>Kv (metric) flow coefficient [m3/h/(bar)^(1/2)]</TD></TR>
<TR><TD>Real</TD><TD>Cv</TD><TD>&nbsp;</TD><TD>Cv (US) flow coefficient [USG/min/(psi)^(1/2)]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</A></TD><TD>Av</TD><TD>&nbsp;</TD><TD>Av (metric) flow coefficient [m2]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Pressure-flow linearization</TD></TR>
<TR><TD>Real</TD><TD>deltaM</TD><TD>0.02</TD><TD>Fraction of nominal flow rate where linearization starts, if y=1</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Assumptions</B></TD></TR>
<TR><TD>Boolean</TD><TD>allowFlowReversal</TD><TD>system.allowFlowReversal</TD><TD>= true to allow flow reversal, false restricts to design direction (port_a -&gt; port_b)</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Advanced</B></TD></TR>
<TR><TD>Boolean</TD><TD>homotopyInitialization</TD><TD>true</TD><TD>= true, use homotopy method</TD></TR>
<TR><TD>Boolean</TD><TD>from_dp</TD><TD>false</TD><TD>= true, use m_flow = f(dp) else dp = f(m_flow)</TD></TR>
<TR><TD>Boolean</TD><TD>linearized</TD><TD>false</TD><TD>= true, use linear relation between m_flow and dp for any flow rate</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Diagnostics</TD></TR>
<TR><TD>Boolean</TD><TD>show_T</TD><TD>false</TD><TD>= true, if actual temperature at port is computed</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Density</A></TD><TD>rhoStd</TD><TD>Medium.density_pTX(101325, 2...</TD><TD>Inlet density for which valve coefficients are defined [kg/m3]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Filtered opening</TD></TR>
<TR><TD>Boolean</TD><TD>filteredOpening</TD><TD>true</TD><TD>= true, if opening is filtered with a 2nd order CriticalDamping filter</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>riseTime</TD><TD>120</TD><TD>Rise time of the filter (time to reach 99.6 % of an opening step) [s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Blocks_Types.html#Modelica.Blocks.Types.Init"
>Init</A></TD><TD>init</TD><TD>Modelica.Blocks.Types.Init.I...</TD><TD>Type of initialization (no init/steady state/initial state/initial output)</TD></TR>
<TR><TD>Real</TD><TD>y_start</TD><TD>1</TD><TD>Initial value of output</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_a</TD><TD>Fluid connector a (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>port_b</TD><TD>Fluid connector b (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>y</TD><TD>Actuator position (0: closed, 1: open)</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y_actual</TD><TD>Actual valve position</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">partial </font><font color="blue">model</font> PartialTwoWayValve <font color="darkgreen">&quot;Partial model for a two way valve&quot;</font>

  <font color="blue">extends </font><A HREF="Buildings_Fluid_BaseClasses.html#Buildings.Fluid.BaseClasses.PartialResistance"
>Buildings.Fluid.BaseClasses.PartialResistance</A>(
       <font color="blue">final </font>dp_nominal=dpValve_nominal + dpFixed_nominal,
       dp(nominal=6000),
       <font color="blue">final </font>m_flow_turbulent = deltaM *<font color="red"> abs</font>(m_flow_nominal));

  <font color="blue">extends </font><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ValveParameters"
>Buildings.Fluid.Actuators.BaseClasses.ValveParameters</A>(
      rhoStd=<font color="red">Medium.density_pTX</font>(101325, 273.15+4, Medium.X_default));

  <font color="blue">extends </font><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal"
>Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal</A>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Modelica.SIunits.Pressure</A> dpFixed_nominal(displayUnit=&quot;Pa&quot;, min=0) = 0 <font color="darkgreen">
    &quot;Pressure drop of pipe and other resistances that are in series&quot;</font>;
  <font color="blue">parameter </font>Real l(min=1e-10, max=1) = 0.0001 <font color="darkgreen">
    &quot;Valve leakage, l=Kv(y=0)/Kv(y=1)&quot;</font>;
  Real phi <font color="darkgreen">&quot;Ratio actual to nominal mass flow rate of valve, phi=Kv(y)/Kv(y=1)&quot;</font>;
<font color="blue">protected </font>
 <font color="blue">parameter </font>Real kFixed(unit=&quot;&quot;) = <font color="blue">if </font>dpFixed_nominal &gt; Modelica.Constants.small<font color="blue">
    then </font>m_flow_nominal /<font color="red"> sqrt</font>(dpFixed_nominal)<font color="blue"> else </font>0 <font color="darkgreen">
    &quot;Flow coefficient of fixed resistance that may be in series with valve, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2).&quot;</font>;
 Real kVal(unit=&quot;&quot;, min=Modelica.Constants.small) <font color="darkgreen">
    &quot;Flow coefficient of valve, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2).&quot;</font>;
 Real k(unit=&quot;&quot;, min=Modelica.Constants.small) <font color="darkgreen">
    &quot;Flow coefficient of valve and pipe in series, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2).&quot;</font>;
<font color="blue">initial </font><font color="blue">equation </font>
  <font color="darkgreen">// Since the flow model Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_m_flow computes</font>
  <font color="darkgreen">// 1/k^2, the parameter l must not be zero.</font>
  <font color="red">assert</font>(l &gt; 0, &quot;Valve leakage parameter l must be bigger than zero.&quot;);
  <font color="red">assert</font>(dpFixed_nominal &gt; -Modelica.Constants.small, &quot;Require dpFixed_nominal &gt;= 0. Received dpFixed_nominal = &quot;
        +<font color="red"> String</font>(dpFixed_nominal) + &quot; Pa.&quot;);
<font color="blue">equation </font>
 kVal = phi*Kv_SI;
 k = <font color="blue">if </font>(dpFixed_nominal &gt; Modelica.Constants.eps)<font color="blue"> then </font><font color="red">sqrt</font>(1/(1/kFixed^2 + 1/kVal^2))<font color="blue"> else </font>kVal;

 <font color="blue">if </font>linearized<font color="blue"> then</font>
   <font color="darkgreen">// This implementation yields m_flow_nominal = phi*kv_SI * sqrt(dp_nominal)</font>
   <font color="darkgreen">// if m_flow = m_flow_nominal and dp = dp_nominal</font>
   m_flow*m_flow_nominal_pos = k^2 * dp;
 <font color="blue">else</font>
   <font color="blue">if </font>homotopyInitialization<font color="blue"> then</font>
     <font color="blue">if </font>from_dp<font color="blue"> then</font>
         m_flow=<font color="red">homotopy</font>(actual=<font color="red">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_dp</font>(dp=dp, k=k,
                                m_flow_turbulent=m_flow_turbulent),
                                simplified=m_flow_nominal_pos*dp/dp_nominal_pos);
      <font color="blue">else</font>
         dp=<font color="red">homotopy</font>(actual=<font color="red">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_m_flow</font>(m_flow=m_flow, k=k,
                                m_flow_turbulent=m_flow_turbulent),
                                simplified=dp_nominal_pos*m_flow/m_flow_nominal_pos);
     <font color="blue">end if</font>;
   <font color="blue">else</font><font color="darkgreen"> // do not use homotopy</font>
     <font color="blue">if </font>from_dp<font color="blue"> then</font>
       m_flow=<font color="red">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_dp</font>(dp=dp, k=k,
                                m_flow_turbulent=m_flow_turbulent);
      <font color="blue">else</font>
        dp=<font color="red">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_m_flow</font>(m_flow=m_flow, k=k,
                                m_flow_turbulent=m_flow_turbulent);
      <font color="blue">end if</font>;
    <font color="blue">end if</font>;<font color="darkgreen"> // homotopyInitialization</font>
 <font color="blue">end if</font>;<font color="darkgreen"> // linearized</font>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>PartialTwoWayValve;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE ValveParameters<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Fluid.Actuators.BaseClasses.ValveParameters"></A><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses"
>Buildings.Fluid.Actuators.BaseClasses</A>.ValveParameters</H2>
<B>Model with parameters for valves</B><p></P>
<P></P><H3>Information</H3>

<p>
Model that computes the flow coefficients of valves. This base class allows the following modeling options,
which have been adapted from the valve implementation 
in <A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid"
>
Modelica.Fluid</a>
to specify the valve flow coefficient in fully open conditions:
</p>
<ul>
<li><code>CvData = Buildings.Fluid.Types.CvTypes.Av</code>: the flow coefficient is given by the metric <code>Av</code> coefficient (m^2).
<li><code>CvData = Buildings.Fluid.Types.CvTypes.Kv</code>: the flow coefficient is given by the metric <code>Kv</code> coefficient (m^3/h).
<li><code>CvData = Buildings.Fluid.Types.CvTypes.Cv</code>: the flow coefficient is given by the US <code>Cv</code> coefficient (USG/min).
<li><code>CvData = Buildings.Fluid.Types.CvTypes.OpPoint</code>: the flow is computed from the nominal operating point specified by <code>dp_nominal</code> and <code>m_flow_nominal</code>.
</ul>
<p>
The treatment of parameters <code>Kv</code> and <code>Cv</code> is
explained in detail in the 
<A HREF="../../msl/3.2/help/Modelica_Fluid_UsersGuide_ComponentDefinition.html#Modelica.Fluid.UsersGuide.ComponentDefinition.ValveCharacteristics"
>Users Guide</a>.
</p>
<p>
In contrast to the model in <A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid"
>
Modelica.Fluid</a>, this model uses the protected parameter <code>Kv_SI</code>,
which is the flow coefficient in SI units, i.e., 
it is the ratio between mass flow rate in <code>kg/s</code> and square root 
of pressure drop in <code>Pa</code>.
The value of <code>Kv_SI</code> is computed based on the parameters
<code>Av</code>,
<code>Kv</code>,
<code>Cv</code>, or, if 
<code>CvData = Buildings.Fluid.Types.CvTypes.OpPoint</code>, based on
<code>m_flow_nominal</code> and <code>dpValve_nominal</code>.
Conversely, if 
<code>CvData &lt;&gt; Buildings.Fluid.Types.CvTypes.OpPoint</code>, then 
<code>dpValve_nominal</code> is computed based on
<code>Av</code>,
<code>Kv</code>, or
<code>Cv</code>, and the nominal mass flow rate <code>m_flow_nominal</code>.
Therefore, if
<code>CvData &lt;&gt; Buildings.Fluid.Types.CvTypes.OpPoint</code>,
then specifying a value for <code>dpValve_nominal</code> is a syntax error.
</p>
<P></P>

<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Flow Coefficient</TD></TR>
<TR><TD><A HREF="Buildings_Fluid_Types.html#Buildings.Fluid.Types.CvTypes"
>CvTypes</A></TD><TD>CvData</TD><TD>Buildings.Fluid.Types.CvType...</TD><TD>Selection of flow coefficient</TD></TR>
<TR><TD>Real</TD><TD>Kv</TD><TD>&nbsp;</TD><TD>Kv (metric) flow coefficient [m3/h/(bar)^(1/2)]</TD></TR>
<TR><TD>Real</TD><TD>Cv</TD><TD>&nbsp;</TD><TD>Cv (US) flow coefficient [USG/min/(psi)^(1/2)]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</A></TD><TD>Av</TD><TD>&nbsp;</TD><TD>Av (metric) flow coefficient [m2]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Pressure-flow linearization</TD></TR>
<TR><TD>Real</TD><TD>deltaM</TD><TD>0.02</TD><TD>Fraction of nominal flow rate where linearization starts, if y=1</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dpValve_nominal</TD><TD>&nbsp;</TD><TD>Nominal pressure drop of fully open valve, used if CvData=Buildings.Fluid.Types.CvTypes.OpPoint [Pa]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Advanced</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Density</A></TD><TD>rhoStd</TD><TD>&nbsp;</TD><TD>Inlet density for which valve coefficients are defined [kg/m3]</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">partial </font><font color="blue">model</font> ValveParameters <font color="darkgreen">&quot;Model with parameters for valves&quot;</font>

  <font color="blue">parameter </font><A HREF="Buildings_Fluid_Types.html#Buildings.Fluid.Types.CvTypes"
>Buildings.Fluid.Types.CvTypes</A> CvData=Buildings.Fluid.Types.CvTypes.OpPoint <font color="darkgreen">
    &quot;Selection of flow coefficient&quot;</font>;
  <font color="blue">parameter </font>Real Kv(
    fixed= <font color="blue">if </font>CvData==Buildings.Fluid.Types.CvTypes.Kv<font color="blue"> then </font>true<font color="blue"> else </font>false) <font color="darkgreen">
    &quot;Kv (metric) flow coefficient [m3/h/(bar)^(1/2)]&quot;</font>;
  <font color="blue">parameter </font>Real Cv(
    fixed= <font color="blue">if </font>CvData==Buildings.Fluid.Types.CvTypes.Cv<font color="blue"> then </font>true<font color="blue"> else </font>false) <font color="darkgreen">
    &quot;Cv (US) flow coefficient [USG/min/(psi)^(1/2)]&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Modelica.SIunits.Area</A> Av(
    fixed= <font color="blue">if </font>CvData==Buildings.Fluid.Types.CvTypes.Av<font color="blue"> then </font>true<font color="blue"> else </font>false) <font color="darkgreen">
    &quot;Av (metric) flow coefficient&quot;</font>;

  <font color="blue">parameter </font>Real deltaM = 0.02 <font color="darkgreen">
    &quot;Fraction of nominal flow rate where linearization starts, if y=1&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> m_flow_nominal <font color="darkgreen">
    &quot;Nominal mass flow rate&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Modelica.SIunits.Pressure</A> dpValve_nominal(displayUnit=&quot;Pa&quot;,
                                                      min=Modelica.Constants.small,
                                                      fixed= <font color="blue">if </font>CvData==Buildings.Fluid.Types.CvTypes.OpPoint<font color="blue"> then </font>true<font color="blue"> else </font>false) <font color="darkgreen">
    &quot;Nominal pressure drop of fully open valve, used if CvData=Buildings.Fluid.Types.CvTypes.OpPoint&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Modelica.SIunits.Density</A> rhoStd <font color="darkgreen">
    &quot;Inlet density for which valve coefficients are defined&quot;</font>;

<font color="blue">protected </font>
  <font color="blue">parameter </font>Real Kv_SI(
    min=0,
    fixed= false) <font color="darkgreen">
    &quot;Flow coefficient for fully open valve in SI units, Kv=m_flow/sqrt(dp) [kg/s/(Pa)^(1/2)]&quot;</font>;
<font color="blue">initial </font><font color="blue">algorithm </font>
  <font color="blue">if </font> CvData == Buildings.Fluid.Types.CvTypes.OpPoint<font color="blue"> then</font>
    Kv_SI :=           m_flow_nominal/<font color="red">sqrt</font>(dpValve_nominal);
    Kv    :=           Kv_SI/(rhoStd/3600/<font color="red">sqrt</font>(1E5));
    Cv    :=           Kv_SI/(rhoStd*0.0631/1000/<font color="red">sqrt</font>(6895));
    Av    :=           Kv_SI/<font color="red">sqrt</font>(rhoStd);
  <font color="blue">elseif </font>CvData == Buildings.Fluid.Types.CvTypes.Kv<font color="blue"> then</font>
    Kv_SI :=           Kv*rhoStd/3600/<font color="red">sqrt</font>(1E5) <font color="darkgreen">
      &quot;Unit conversion m3/(h*sqrt(bar)) to kg/(s*sqrt(Pa))&quot;</font>;
    Cv    :=           Kv_SI/(rhoStd*0.0631/1000/<font color="red">sqrt</font>(6895));
    Av    :=           Kv_SI/<font color="red">sqrt</font>(rhoStd);
    dpValve_nominal := (m_flow_nominal/Kv_SI)^2;
  <font color="blue">elseif </font>CvData == Buildings.Fluid.Types.CvTypes.Cv<font color="blue"> then</font>
    Kv_SI :=           Cv*rhoStd*0.0631/1000/<font color="red">sqrt</font>(6895) <font color="darkgreen">
      &quot;Unit conversion USG/(min*sqrt(psi)) to kg/(s*sqrt(Pa))&quot;</font>;
    Kv    :=           Kv_SI/(rhoStd/3600/<font color="red">sqrt</font>(1E5));
    Av    :=           Kv_SI/<font color="red">sqrt</font>(rhoStd);
    dpValve_nominal := (m_flow_nominal/Kv_SI)^2;
  <font color="blue">else</font>
    <font color="red">assert</font>(CvData == Buildings.Fluid.Types.CvTypes.Av, &quot;Invalid value for CvData.
Obtained CvData = &quot; +<font color="red"> String</font>(CvData) + &quot;.&quot;);
    Kv_SI :=           Av*<font color="red">sqrt</font>(rhoStd);
    Kv    :=           Kv_SI/(rhoStd/3600/<font color="red">sqrt</font>(1E5));
    Cv    :=           Kv_SI/(rhoStd*0.0631/1000/<font color="red">sqrt</font>(6895));
    dpValve_nominal := (m_flow_nominal/Kv_SI)^2;
  <font color="blue">end if</font>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>ValveParameters;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE der_equalPercentage<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Fluid.Actuators.BaseClasses.der_equalPercentage"></A><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses"
>Buildings.Fluid.Actuators.BaseClasses</A>.der_equalPercentage</H2>
<B>Derivative of valve opening characteristics for equal percentage valve</B><p></P>
<P></P><H3>Information</H3>

<p>
This function computes the derivative of the opening characteristics of an equal percentage valve.
</p><p>
The function is the derivative of  
<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.equalPercentage"
>
TwoWayValveEqualPercentage</a>.
</p>
<P></P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>y</TD><TD>&nbsp;</TD><TD>Valve opening signal, y=1 is fully open</TD></TR>
<TR><TD>Real</TD><TD>R</TD><TD>&nbsp;</TD><TD>Rangeability, R=50...100 typically</TD></TR>
<TR><TD>Real</TD><TD>l</TD><TD>&nbsp;</TD><TD>Valve leakage, l=Kv(y=0)/Kv(y=1)</TD></TR>
<TR><TD>Real</TD><TD>delta</TD><TD>&nbsp;</TD><TD>Range of significant deviation from equal percentage law</TD></TR>
<TR><TD>Real</TD><TD>der_y</TD><TD>&nbsp;</TD><TD>Derivative of valve opening signal</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>der_phi</TD><TD>Derivative of ratio actual to nominal mass flow rate, dphi/dy</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> der_equalPercentage <font color="darkgreen">
  &quot;Derivative of valve opening characteristics for equal percentage valve&quot;</font>

  <font color="blue">input </font>Real y <font color="darkgreen">&quot;Valve opening signal, y=1 is fully open&quot;</font>;
  <font color="blue">input </font>Real R <font color="darkgreen">&quot;Rangeability, R=50...100 typically&quot;</font>;
  <font color="blue">input </font>Real l(min=0, max=1) <font color="darkgreen">&quot;Valve leakage, l=Kv(y=0)/Kv(y=1)&quot;</font>;
  <font color="blue">input </font>Real delta <font color="darkgreen">&quot;Range of significant deviation from equal percentage law&quot;</font>;
  <font color="blue">input </font>Real der_y <font color="darkgreen">&quot;Derivative of valve opening signal&quot;</font>;
  <font color="blue">output </font>Real der_phi <font color="darkgreen">
    &quot;Derivative of ratio actual to nominal mass flow rate, dphi/dy&quot;</font>;
<font color="blue">protected </font>
   Real a <font color="darkgreen">&quot;Polynomial coefficient&quot;</font>;
   Real b <font color="darkgreen">&quot;Polynomial coefficient&quot;</font>;
   Real c <font color="darkgreen">&quot;Polynomial coefficient&quot;</font>;
   Real logR <font color="darkgreen">&quot;=log(R)&quot;</font>;
   Real z <font color="darkgreen">&quot;Auxiliary variable&quot;</font>;
   Real q <font color="darkgreen">&quot;Auxiliary variable&quot;</font>;
   Real p <font color="darkgreen">&quot;Auxiliary variable&quot;</font>;
<font color="blue">algorithm </font>
  <font color="blue">if </font>y &lt; delta/2<font color="blue"> then</font>
    der_phi := (R^(delta-1) - l) / delta * der_y;
  <font color="blue">else</font>
    <font color="blue">if </font>(y &gt; (3/2 * delta))<font color="blue"> then</font>
      der_phi := R^(y-1)*<font color="red">Modelica.Math.log</font>(R) * der_y;
    <font color="blue">else</font>
      logR :=<font color="red"> Modelica.Math.log</font>(R);
      z := (3*delta/2);
      q := delta*R^z*logR;
      p := R^z;
      a := (q - 2*p + 2*R^delta)/(delta^3*R);
      b := (-5*q + 12*p - 13*R^delta + l*R)/(2*delta^2*R);
      c := (7*q - 18*p + 24*R^delta - 6*l*R)/(4*delta*R);
      der_phi  := (c + y * ( 2*b + 3*a*y)) * der_y;
    <font color="blue">end if</font>;
  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>der_equalPercentage;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE equalPercentage<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Fluid.Actuators.BaseClasses.equalPercentage"></A><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses"
>Buildings.Fluid.Actuators.BaseClasses</A>.equalPercentage</H2>
<B>Valve opening characteristics for equal percentage valve</B><p></P>
<P></P><H3>Information</H3>

<p>
This function computes the opening characteristics of an equal percentage valve.
</p><p>
The function is used by the model 
<a href="modelica://Buildings.Fluid.Actuators.TwoWayValveEqualPercentage">
TwoWayValveEqualPercentage</a>.
</p><p>
For <code>y &lt; delta/2</code>, the valve characteristics is linear. For <code> y &gt; 3*delta/2</code>
the valve characteristics is equal percentage. In between, a cubic spline is used to ensure
that the valve characteristics is once continuously differentiable with respect to <code>y</code>.
</p>
<P></P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>y</TD><TD>&nbsp;</TD><TD>Valve opening signal, y=1 is fully open</TD></TR>
<TR><TD>Real</TD><TD>R</TD><TD>&nbsp;</TD><TD>Rangeability, R=50...100 typically</TD></TR>
<TR><TD>Real</TD><TD>l</TD><TD>&nbsp;</TD><TD>Valve leakage, l=Kv(y=0)/Kv(y=1)</TD></TR>
<TR><TD>Real</TD><TD>delta</TD><TD>&nbsp;</TD><TD>Range of significant deviation from equal percentage law</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>phi</TD><TD>Ratio actual to nominal mass flow rate, phi=Cv(y)/Cv(y=1)</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> equalPercentage <font color="darkgreen">
  &quot;Valve opening characteristics for equal percentage valve&quot;</font>
  annotation(derivative=<A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses.der_equalPercentage"
>der_equalPercentage</A>);

  <font color="blue">input </font>Real y <font color="darkgreen">&quot;Valve opening signal, y=1 is fully open&quot;</font>;
  <font color="blue">input </font>Real R <font color="darkgreen">&quot;Rangeability, R=50...100 typically&quot;</font>;
  <font color="blue">input </font>Real l(min=0, max=1) <font color="darkgreen">&quot;Valve leakage, l=Kv(y=0)/Kv(y=1)&quot;</font>;
  <font color="blue">input </font>Real delta <font color="darkgreen">&quot;Range of significant deviation from equal percentage law&quot;</font>;
  <font color="blue">output </font>Real phi <font color="darkgreen">&quot;Ratio actual to nominal mass flow rate, phi=Cv(y)/Cv(y=1)&quot;</font>;
<font color="blue">protected </font>
   Real a <font color="darkgreen">&quot;Polynomial coefficient&quot;</font>;
   Real b <font color="darkgreen">&quot;Polynomial coefficient&quot;</font>;
   Real c <font color="darkgreen">&quot;Polynomial coefficient&quot;</font>;
   Real d <font color="darkgreen">&quot;Polynomial coefficient&quot;</font>;
   Real logR <font color="darkgreen">&quot;=log(R)&quot;</font>;
   Real z <font color="darkgreen">&quot;Auxiliary variable&quot;</font>;
   Real q <font color="darkgreen">&quot;Auxiliary variable&quot;</font>;
   Real p <font color="darkgreen">&quot;Auxiliary variable&quot;</font>;
<font color="blue">algorithm </font>
  <font color="blue">if </font>y &lt; delta/2<font color="blue"> then</font>
    phi := l + y * (R^(delta-1) - l) / delta;
  <font color="blue">else</font>
    <font color="blue">if </font>(y &gt; (3/2 * delta))<font color="blue"> then</font>
      phi := R^(y-1);
    <font color="blue">else</font>
      logR :=<font color="red"> Modelica.Math.log</font>(R);
      z := (3*delta/2);
      q := delta*R^z*logR;
      p := R^z;
      a := (q - 2*p + 2*R^delta)/(delta^3*R);
      b := (-5*q + 12*p - 13*R^delta + l*R)/(2*delta^2*R);
      c := (7*q - 18*p + 24*R^delta - 6*l*R)/(4*delta*R);
      d := (-3*q + 8*p - 9*R^delta + 9*l*R)/(8*R);
      phi  := d + y * ( c + y * ( b + y * a));
    <font color="blue">end if</font>;
  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>equalPercentage;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE exponentialDamper<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Fluid.Actuators.BaseClasses.exponentialDamper"></A><A HREF="Buildings_Fluid_Actuators_BaseClasses.html#Buildings.Fluid.Actuators.BaseClasses"
>Buildings.Fluid.Actuators.BaseClasses</A>.exponentialDamper</H2>
<B>Damper opening characteristics for an exponential damper</B><p></P>
<P></P><H3>Information</H3>

<p>
This function computes the opening characteristics of an exponential damper.
</p><p>
The function is used by the model 
<A HREF="Buildings_Fluid_Actuators_Dampers.html#Buildings.Fluid.Actuators.Dampers.Exponential"
>
Dampers.Exponential</a>.
</p><p>
For <code>yL &lt; y &lt; yU</code>, the damper characteristics is 
</p>
<p align="center" style="font-style:italic;">
  k = exp(a+b (1-y)).
</p>
<p>
Outside this range, the damper characteristic is defined by a quadratic polynomial.
</p>
<p>
Note that this implementation returns <code>sqrt(k)</code> instead of <code>k</code>.
This is done for numerical reason since otherwise <code>k</code> may be an iteration
variable, which may cause a lot of warnings and slower convergence if the solver
attempts <code>k &lt; 0</code> during the iterative solution procedure.
</p>
<P></P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>y</TD><TD>&nbsp;</TD><TD>Control signal, y=0 is closed, y=1 is open</TD></TR>
<TR><TD>Real</TD><TD>a</TD><TD>&nbsp;</TD><TD>Coefficient a for damper characteristics</TD></TR>
<TR><TD>Real</TD><TD>b</TD><TD>&nbsp;</TD><TD>Coefficient b for damper characteristics</TD></TR>
<TR><TD>Real</TD><TD>cL[3]</TD><TD>&nbsp;</TD><TD>Polynomial coefficients for curve fit for y &lt; yl</TD></TR>
<TR><TD>Real</TD><TD>cU[3]</TD><TD>&nbsp;</TD><TD>Polynomial coefficients for curve fit for y &gt; yu</TD></TR>
<TR><TD>Real</TD><TD>yL</TD><TD>&nbsp;</TD><TD>Lower value for damper curve</TD></TR>
<TR><TD>Real</TD><TD>yU</TD><TD>&nbsp;</TD><TD>Upper value for damper curve</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>kThetaSqRt</TD><TD>Flow coefficient, kThetaSqRT = =sqrt(kTheta) = sqrt(pressure drop/dynamic pressure)</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> exponentialDamper <font color="darkgreen">
  &quot;Damper opening characteristics for an exponential damper&quot;</font>
  <font color="blue">input </font>Real y(min=0, max=1, unit=&quot;&quot;) <font color="darkgreen">
    &quot;Control signal, y=0 is closed, y=1 is open&quot;</font>;
  <font color="blue">input </font>Real a(unit=&quot;&quot;) <font color="darkgreen">&quot;Coefficient a for damper characteristics&quot;</font>;
  <font color="blue">input </font>Real b(unit=&quot;&quot;) <font color="darkgreen">&quot;Coefficient b for damper characteristics&quot;</font>;
  <font color="blue">input </font>Real[3] cL <font color="darkgreen">&quot;Polynomial coefficients for curve fit for y &lt; yl&quot;</font>;
  <font color="blue">input </font>Real[3] cU <font color="darkgreen">&quot;Polynomial coefficients for curve fit for y &gt; yu&quot;</font>;
  <font color="blue">input </font>Real yL <font color="darkgreen">&quot;Lower value for damper curve&quot;</font>;
  <font color="blue">input </font>Real yU <font color="darkgreen">&quot;Upper value for damper curve&quot;</font>;
  <font color="blue">output </font>Real kThetaSqRt(min=0) <font color="darkgreen">
    &quot;Flow coefficient, kThetaSqRT = =sqrt(kTheta) = sqrt(pressure drop/dynamic pressure)&quot;</font>;
<font color="blue">protected </font>
  Real yC(min=0, max=1, unit=&quot;&quot;) <font color="darkgreen">
    &quot;y constrained to 0 &lt;= y &lt;= 1 to avoid numerical problems&quot;</font>;
<font color="blue">algorithm </font>
  <font color="blue">if </font>y &lt; yL<font color="blue"> then</font>
    yC :=<font color="red">max</font>(0, y);
    kThetaSqRt :=<font color="red"> sqrt</font>(<font color="red">Modelica.Math.exp</font>(cL[3] + yC * (cL[2] + yC * cL[1])));
  <font color="blue">else</font>
    <font color="blue">if </font>(y &gt; yU)<font color="blue"> then</font>
      yC :=<font color="red"> min</font>(1, y);
      kThetaSqRt :=<font color="red"> sqrt</font>(<font color="red">Modelica.Math.exp</font>(cU[3] + yC * (cU[2] + yC * cU[1])));
    <font color="blue">else</font>
      kThetaSqRt :=<font color="red"> sqrt</font>(<font color="red">Modelica.Math.exp</font>(a+b*(1-y))) <font color="darkgreen">&quot;y=0 is closed&quot;</font>;
    <font color="blue">end if</font>;
  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>exponentialDamper;
</PRE>
<HR>
<address><a href="http://www.3ds.com/">Automatically generated</a> Wed Feb 12 08:15:07 2014.
</address></BODY>
</HTML>
