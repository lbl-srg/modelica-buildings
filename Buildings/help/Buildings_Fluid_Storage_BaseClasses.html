<HTML>
<HEAD>
<TITLE>Buildings.Fluid.Storage.BaseClasses</TITLE>
<META name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META name="description" content="&quot;Package with base classes for Buildings.Fluid.Storage&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- --- header ------ -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- --- end header -- -->
</P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE BaseClasses<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Fluid.Storage.BaseClasses"></A><A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage"
>Buildings.Fluid.Storage</A>.BaseClasses</H2>
<B>Package with base classes for Buildings.Fluid.Storage</B>
<P></P>
<P></P><H3>Information</H3>

<p>
This package contains base classes that are used to construct the models in
<A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage"
>Buildings.Fluid.Storage</a>.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons_BasesPackage.html#Modelica.Icons.BasesPackage"
>Modelica.Icons.BasesPackage</A> (Icon for packages containing base classes).
<P></P><H3>Package Content</H3>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.Ba59ec09b42b7c4dbyancyS.png" ALT="Buildings.Fluid.Storage.BaseClasses.Buoyancy" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.Buoyancy"
>Buoyancy</A>
</TD><TD>Model to add buoyancy if there is a temperature inversion in the tank</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.B081e0484b44bf295angerS.png" ALT="Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger"
>IndirectTankHeatExchanger</A>
</TD><TD>Heat exchanger typically submerged in a fluid with a second fluid circulating through it</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.Bd25479539900e37fifierS.png" ALT="Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier"
>ThirdOrderStratifier</A>
</TD><TD>Model to reduce the numerical dissipation in a tank</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.B98092f341fff4c2amplesS.png" ALT="Buildings.Fluid.Storage.BaseClasses.Examples" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage_BaseClasses_Examples.html#Buildings.Fluid.Storage.BaseClasses.Examples"
>Examples</A>
</TD><TD>Examples for BaseClasses models</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Buoyancy<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Storage.Ba59ec09b42b7c4dbyancyI.png" ALT="Buildings.Fluid.Storage.BaseClasses.Buoyancy" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Storage.BaseClasses.Buoyancy"></A><A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses"
>Buildings.Fluid.Storage.BaseClasses</A>.Buoyancy</H2>
<B>Model to add buoyancy if there is a temperature inversion in the tank</B><p></P>
<IMG SRC="Buildings.Fluid.Storage.Ba59ec09b42b7c4dbyancyD.png" ALT="Buildings.Fluid.Storage.BaseClasses.Buoyancy">
<P></P><H3>Information</H3>

<p>
This model outputs a heat flow rate that can be added to fluid volumes
in order to emulate buoyancy during a temperature inversion.
For simplicity, this model does not compute a buoyancy induced mass flow rate,
but rather a heat flow that has the same magnitude as the enthalpy flow
associated with the buoyancy induced mass flow rate.
</p>
<P></P>
Extends from <A HREF="Buildings_BaseClasses.html#Buildings.BaseClasses.BaseIcon"
>Buildings.BaseClasses.BaseIcon</A> (Base icon).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD>Modelica.Media.Interfaces.Pa...</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V</TD><TD>&nbsp;</TD><TD>Volume [m3]</TD></TR>
<TR><TD>Integer</TD><TD>nSeg</TD><TD>2</TD><TD>Number of volume segments</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>tau</TD><TD>&nbsp;</TD><TD>Time constant for mixing [s]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heatPort[nSeg]</TD><TD>Heat input into the volumes</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> Buoyancy <font color="darkgreen">
  &quot;Model to add buoyancy if there is a temperature inversion in the tank&quot;</font>
  <font color="blue">extends </font><A HREF="Buildings_BaseClasses.html#Buildings.BaseClasses.BaseIcon"
>Buildings.BaseClasses.BaseIcon</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> Medium =
    <A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>Modelica.Media.Interfaces.PartialMedium</A> <font color="darkgreen">&quot;Medium model&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> V <font color="darkgreen">&quot;Volume&quot;</font>;
  <font color="blue">parameter </font>Integer nSeg(min=2) = 2 <font color="darkgreen">&quot;Number of volume segments&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> tau(min=0) <font color="darkgreen">&quot;Time constant for mixing&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</A>[nSeg] heatPort <font color="darkgreen">
    &quot;Heat input into the volumes&quot;</font>;</textblock>

  <A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A>[nSeg-1] Q_flow <font color="darkgreen">
    &quot;Heat flow rate from segment i+1 to i&quot;</font>;
<font color="blue">protected </font>
   <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ThermodynamicState"
>Medium.ThermodynamicState</A> sta_default =<font color="red"> Medium.setState_pTX</font>(T=Medium.T_default,
         p=Medium.p_default, X=Medium.X_default[1:Medium.nXi]);
   <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Modelica.SIunits.Density</A> rho_default=<font color="red">Medium.density</font>(sta_default) <font color="darkgreen">
    &quot;Density, used to compute fluid mass&quot;</font>;
   <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.SpecificHeatCapacity"
>Modelica.SIunits.SpecificHeatCapacity</A> cp_default=<font color="red">Medium.specificHeatCapacityCp</font>(sta_default) <font color="darkgreen">
    &quot;Specific heat capacity&quot;</font>;
   <font color="blue">parameter </font>Real k(unit=&quot;W/K&quot;) = V*rho_default*cp_default/tau/nSeg <font color="darkgreen">
    &quot;Proportionality constant, since we use dT instead of dH&quot;</font>;
   <A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.TemperatureDifference"
>Modelica.SIunits.TemperatureDifference</A> dT[nSeg-1] <font color="darkgreen">
    &quot;Temperature difference between adjoining volumes&quot;</font>;
<font color="blue">equation </font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:nSeg-1<font color="blue"> loop</font>
    dT[i] = heatPort[i+1].T-heatPort[i].T;
    Q_flow[i] = k*<font color="red">noEvent</font>(<font color="red">smooth</font>(1, <font color="blue">if </font>dT[i]&gt;0<font color="blue"> then </font>dT[i]^2<font color="blue"> else </font>0));
  <font color="blue">end for</font>;

  heatPort[1].Q_flow = -Q_flow[1];
  <font color="blue">for </font>i<font color="blue"> in </font>2:nSeg-1<font color="blue"> loop</font>
       heatPort[i].Q_flow = -Q_flow[i]+Q_flow[i-1];
  <font color="blue">end for</font>;
  heatPort[nSeg].Q_flow = Q_flow[nSeg-1];
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>Buoyancy;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE IndirectTankHeatExchanger<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Storage.B081e0484b44bf295angerI.png" ALT="Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger"></A><A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses"
>Buildings.Fluid.Storage.BaseClasses</A>.IndirectTankHeatExchanger</H2>
<B>Heat exchanger typically submerged in a fluid with a second fluid circulating through it</B><p></P>
<IMG SRC="Buildings.Fluid.Storage.B081e0484b44bf295angerD.png" ALT="Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger">
<P></P><H3>Information</H3>

          <p>
          This model is a heat exchanger with a moving fluid on one side and a stagnant fluid on the other.
          It is intended for use when a heat exchanger is submerged in a stagnant fluid.
          For example, the heat exchanger in a storage tank which is part of a solar thermal system.
          </p>
          <p>
          This component models the fluid in the heat exchanger, convection between the fluid and 
          the heat exchanger, and convection from the heat exchanger to the surrounding fluid.
          </p>
          <p>
          The model is based on <A HREF="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.HACoilInside"
>
          Buildings.Fluid.HeatExchangers.BaseClasses.HACoilInside</a> and
          <A HREF="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.HANaturalCylinder"
>
          Buildings.Fluid.HeatExchangers.BaseClasses.HANaturalCylinder</a>.
          </p>
          <p>
          The fluid ports are intended to be connected to a circulated heat transfer fluid 
          while the heat port is intended to be connected to a stagnant fluid.
          </p>          
          <P></P>
Extends from <A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.TwoPortFlowResistanceParameters"
>Buildings.Fluid.Interfaces.TwoPortFlowResistanceParameters</A> (Parameters for flow resistance for models with two ports), <A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.LumpedVolumeDeclarations"
>Buildings.Fluid.Interfaces.LumpedVolumeDeclarations</A> (Declarations for lumped volumes), <A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.PartialTwoPortInterface"
>Buildings.Fluid.Interfaces.PartialTwoPortInterface</A> (Partial model transporting fluid between two ports without storing mass or energy).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumHex</TD><TD>Modelica.Media.Interfaces.Pa...</TD><TD>Heat transfer fluid flowing through the heat exchanger</TD></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD>Integer</TD><TD>nSeg</TD><TD>&nbsp;</TD><TD>Number of segments in the heat exchanger</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatCapacity"
>HeatCapacity</A></TD><TD>CHex</TD><TD>&nbsp;</TD><TD>Capacitance of the heat exchanger [J/K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>volHexFlu</TD><TD>&nbsp;</TD><TD>Volume of heat transfer fluid in the heat exchanger [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Diameter"
>Diameter</A></TD><TD>dExtHex</TD><TD>&nbsp;</TD><TD>Exterior diameter of the heat exchanger pipe [m]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dp_nominal</TD><TD>&nbsp;</TD><TD>Pressure [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>Q_flow_nominal</TD><TD>&nbsp;</TD><TD>Heat transfer at nominal conditions [W]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TTan_nominal</TD><TD>&nbsp;</TD><TD>Temperature of fluid inside the tank at UA_nominal [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>THex_nominal</TD><TD>&nbsp;</TD><TD>Temperature of fluid inside the heat exchanger at UA_nominal [K]</TD></TR>
<TR><TD>Real</TD><TD>r_nominal</TD><TD>0.5</TD><TD>Ratio between coil inside and outside convective heat transfer</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Initialization</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow.start</TD><TD>0</TD><TD>Mass flow rate from port_a to port_b (m_flow &gt; 0 is design flow direction) [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dp.start</TD><TD>0</TD><TD>Pressure difference between port_a and port_b [Pa]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Flow resistance</B></TD></TR>
<TR><TD>Boolean</TD><TD>computeFlowResistance</TD><TD>true</TD><TD>=true, compute flow resistance. Set to false to assume no friction</TD></TR>
<TR><TD>Boolean</TD><TD>from_dp</TD><TD>false</TD><TD>= true, use m_flow = f(dp) else dp = f(m_flow)</TD></TR>
<TR><TD>Boolean</TD><TD>linearizeFlowResistance</TD><TD>false</TD><TD>= true, use linear relation between m_flow and dp for any flow rate</TD></TR>
<TR><TD>Real</TD><TD>deltaM</TD><TD>0.1</TD><TD>Fraction of nominal flow rate where flow transitions to laminar</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Equations</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>energyDynamics</TD><TD>Modelica.Fluid.Types.Dynamic...</TD><TD>Formulation of energy balance</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>massDynamics</TD><TD>energyDynamics</TD><TD>Formulation of mass balance</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Initialization</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>AbsolutePressure</A></TD><TD>p_start</TD><TD>Medium.p_default</TD><TD>Start value of pressure [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_start</TD><TD>Medium.T_default</TD><TD>Start value of temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>MassFraction</A></TD><TD>X_start[Medium.nX]</TD><TD>Medium.X_default</TD><TD>Start value of mass fractions m_i/m [kg/kg]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_start[Medium.nC]</TD><TD>fill(0, Medium.nC)</TD><TD>Start value of trace substances</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_nominal[Medium.nC]</TD><TD>fill(1E-2, Medium.nC)</TD><TD>Nominal value of trace substances. (Set to typical order of magnitude.)</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Assumptions</B></TD></TR>
<TR><TD>Boolean</TD><TD>allowFlowReversal</TD><TD>system.allowFlowReversal</TD><TD>= true to allow flow reversal, false restricts to design direction (port_a -&gt; port_b)</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Advanced</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_small</TD><TD>1E-4*abs(m_flow_nominal)</TD><TD>Small mass flow rate for regularization of zero flow [kg/s]</TD></TR>
<TR><TD>Boolean</TD><TD>homotopyInitialization</TD><TD>true</TD><TD>= true, use homotopy method</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Diagnostics</TD></TR>
<TR><TD>Boolean</TD><TD>show_T</TD><TD>false</TD><TD>= true, if actual temperature at port is computed</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumHex</TD><TD>Heat transfer fluid flowing through the heat exchanger</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_a</TD><TD>Fluid connector a (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>port_b</TD><TD>Fluid connector b (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>port[nSeg]</TD><TD>Heat port connected to water inside the tank</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> IndirectTankHeatExchanger <font color="darkgreen">
  &quot;Heat exchanger typically submerged in a fluid with a second fluid circulating through it&quot;</font>

  <font color="blue">replaceable </font><font color="blue">package</font> MediumHex = <A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>Modelica.Media.Interfaces.PartialMedium</A> <font color="darkgreen">
    &quot;Heat transfer fluid flowing through the heat exchanger&quot;</font>;

  <font color="blue">extends </font><A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.TwoPortFlowResistanceParameters"
>Buildings.Fluid.Interfaces.TwoPortFlowResistanceParameters</A>;
  <font color="blue">extends </font><A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.LumpedVolumeDeclarations"
>Buildings.Fluid.Interfaces.LumpedVolumeDeclarations</A>;
  <font color="blue">extends </font><A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.PartialTwoPortInterface"
>Buildings.Fluid.Interfaces.PartialTwoPortInterface</A>(
    showDesignFlowDirection=false,
    <font color="blue">final </font>show_T=false);

  <font color="blue">parameter </font>Integer nSeg(min=2) <font color="darkgreen">&quot;Number of segments in the heat exchanger&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatCapacity"
>Modelica.SIunits.HeatCapacity</A> CHex <font color="darkgreen">
    &quot;Capacitance of the heat exchanger&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> volHexFlu <font color="darkgreen">
    &quot;Volume of heat transfer fluid in the heat exchanger&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> Q_flow_nominal <font color="darkgreen">
    &quot;Heat transfer at nominal conditions&quot;</font>;

  <font color="blue">final </font><font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.ThermalConductance"
>Modelica.SIunits.ThermalConductance</A> UA_nominal=
    <font color="red">abs</font>(Q_flow_nominal/(THex_nominal-TTan_nominal)) <font color="darkgreen">
    &quot;Nominal UA value for the heat exchanger&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TTan_nominal <font color="darkgreen">
    &quot;Temperature of fluid inside the tank at UA_nominal&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> THex_nominal <font color="darkgreen">
    &quot;Temperature of fluid inside the heat exchanger at UA_nominal&quot;</font>;
  <font color="blue">parameter </font>Real r_nominal(min=0, max=1)=0.5 <font color="darkgreen">
    &quot;Ratio between coil inside and outside convective heat transfer&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Diameter"
>Modelica.SIunits.Diameter</A> dExtHex <font color="darkgreen">
    &quot;Exterior diameter of the heat exchanger pipe&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Modelica.Fluid.Types.Dynamics</A> energyDynamics=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial <font color="darkgreen">
    &quot;Formulation of energy balance&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Modelica.Fluid.Types.Dynamics</A> massDynamics=energyDynamics <font color="darkgreen">
    &quot;Formulation of mass balance&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</A> port[nSeg] <font color="darkgreen">
    &quot;Heat port connected to water inside the tank&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.FixedResistanceDpM"
>FixedResistances.FixedResistanceDpM</A> res(
    <font color="blue">redeclare </font><font color="blue">final </font><font color="blue">package</font> Medium = Medium,
    <font color="blue">final </font>dp_nominal=dp_nominal,
    <font color="blue">final </font>m_flow_nominal=m_flow_nominal,
    <font color="blue">final </font>allowFlowReversal=allowFlowReversal,
    <font color="blue">final </font>homotopyInitialization=homotopyInitialization,
    <font color="blue">final </font>show_T=show_T,
    <font color="blue">final </font>from_dp=from_dp,
    <font color="blue">final </font>linearized=linearizeFlowResistance) <font color="darkgreen">
    &quot;Calculates the flow resistance and pressure drop through the heat exchanger&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>MixingVolumes.MixingVolume</A> vol[nSeg](<font color="blue">each </font>nPorts=2,
    <font color="blue">each </font>m_flow_nominal=m_flow_nominal,
    <font color="blue">redeclare </font><font color="blue">each </font><font color="blue">package</font> Medium = <A HREF="Buildings_Fluid_Storage_BaseClasses_MediumHex.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger.MediumHex"
>MediumHex</A>,
    <font color="blue">each </font>V=volHexFlu/nSeg,
    <font color="blue">each </font>energyDynamics=energyDynamics,
    <font color="blue">each </font>massDynamics=massDynamics,
    <font color="blue">each </font>p_start=p_start,
    <font color="blue">each </font>T_start=T_start,
    <font color="blue">each </font>X_start=X_start,
    <font color="blue">each </font>C_start=C_start,
    <font color="blue">each </font>C_nominal=C_nominal) <font color="darkgreen">&quot;Heat exchanger fluid&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</A> Cap[nSeg](<font color="blue">each </font>C=CHex/
        nSeg, T(<font color="blue">each </font>start=T_start)) <font color="blue">if </font>
       <font color="blue">not </font>(energyDynamics == Modelica.Fluid.Types.Dynamics.SteadyState) <font color="darkgreen">
    &quot;Thermal mass of the heat exchanger&quot;</font>;
<font color="blue">protected </font>
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.MassFlowRate"
>Sensors.MassFlowRate</A> senMasFlo(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Fluid_Storage_BaseClasses_MediumHex.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger.MediumHex"
>MediumHex</A>) <font color="darkgreen">
    &quot;Mass flow rate of the heat transfer fluid&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.Convection"
>Modelica.Thermal.HeatTransfer.Components.Convection</A> htfToHex[nSeg] <font color="darkgreen">
    &quot;Convection coefficient between the heat transfer fluid and heat exchanger&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.Convection"
>Modelica.Thermal.HeatTransfer.Components.Convection</A> HexToTan[nSeg] <font color="darkgreen">
    &quot;Convection coefficient between the heat exchanger and the surrounding medium&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A>
                                     temSenHex[nSeg] <font color="darkgreen">
    &quot;Temperature of the heat transfer fluid&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> temSenWat[nSeg] <font color="darkgreen">
    &quot;Temperature sensor of the fluid surrounding the heat exchanger&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Routing.html#Modelica.Blocks.Routing.Replicator"
>Modelica.Blocks.Routing.Replicator</A> rep(nout=nSeg) <font color="darkgreen">
    &quot;Replicates senMasFlo signal from 1 seg to nSeg&quot;</font>;
  <A HREF="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.HACoilInside"
>HeatExchangers.BaseClasses.HACoilInside</A> hAPipIns[nSeg](
    <font color="blue">each </font>m_flow_nominal=m_flow_nominal,
    <font color="blue">each </font>hA_nominal=UA_nominal/nSeg*(r_nominal + 1)/r_nominal,
    <font color="blue">each </font>T_nominal=THex_nominal) <font color="darkgreen">
    &quot;Computation of convection coefficients inside the coil&quot;</font>;
  <A HREF="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.HANaturalCylinder"
>HeatExchangers.BaseClasses.HANaturalCylinder</A> hANatCyl[nSeg](
    <font color="blue">redeclare </font><font color="blue">each </font><font color="blue">final </font><font color="blue">package</font> Medium = Medium,
    <font color="blue">each </font><font color="blue">final </font>ChaLen=dExtHex,
    <font color="blue">each </font><font color="blue">final </font>hA_nominal=UA_nominal/nSeg*(1 + r_nominal),
    <font color="blue">each </font><font color="blue">final </font>TFlu_nominal=TTan_nominal,
    <font color="blue">each </font><font color="blue">final </font>TSur_nominal=TTan_nominal-(r_nominal/(1+r_nominal))*(TTan_nominal-THex_nominal)) <font color="darkgreen">
    &quot;Calculates an hA value for each side of the heat exchanger&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> temSenSur[nSeg] <font color="darkgreen">
    &quot;Temperature at the external surface of the heat exchanger&quot;</font>;</textblock>

<font color="blue">equation </font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:(nSeg - 1)<font color="blue"> loop</font>
    <font color="red">connect</font>(vol[i].ports[2], vol[i + 1].ports[1]);
  <font color="blue">end for</font>;

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(rep.u,senMasFlo. m_flow);
  <font color="red">connect</font>(port,HexToTan. fluid);
  <font color="red">connect</font>(vol[1].ports[1],senMasFlo. port_b);
  <font color="red">connect</font>(Cap.port,HexToTan. solid);
  <font color="red">connect</font>(vol.heatPort,htfToHex. fluid);
  <font color="red">connect</font>(htfToHex.solid,HexToTan. solid);
  <font color="red">connect</font>(temSenHex.T, hAPipIns.T);
  <font color="red">connect</font>(hAPipIns.hA, htfToHex.Gc);
  <font color="red">connect</font>(HexToTan.solid,temSenSur. port);
  <font color="red">connect</font>(temSenWat.port, port);
  <font color="red">connect</font>(temSenSur.T, hANatCyl.TSur);
  <font color="red">connect</font>(hANatCyl.TFlu, temSenWat.T);
  <font color="red">connect</font>(port_a, senMasFlo.port_a);
  <font color="red">connect</font>(vol[nSeg].ports[2], res.port_a);
  <font color="red">connect</font>(res.port_b, port_b);
  <font color="red">connect</font>(temSenHex.port, vol.heatPort);
  <font color="red">connect</font>(rep.y, hAPipIns.m_flow);
  <font color="red">connect</font>(hANatCyl.hA,HexToTan. Gc);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>IndirectTankHeatExchanger;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE ThirdOrderStratifier<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Storage.Bd25479539900e37fifierI.png" ALT="Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier"></A><A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses"
>Buildings.Fluid.Storage.BaseClasses</A>.ThirdOrderStratifier</H2>
<B>Model to reduce the numerical dissipation in a tank</B><p></P>
<IMG SRC="Buildings.Fluid.Storage.Bd25479539900e37fifierD.png" ALT="Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier">
<P></P><H3>Information</H3>

<p>
This model reduces the numerical dissipation that is introduced
by the standard first-order upwind discretization scheme which is 
created when connecting fluid volumes in series.
</p>
<p>
The model is used in conjunction with 
<a href="modelica://Modelica.Fluid.Storage.Stratified">
Modelica.Fluid.Storage.Stratified</a>.
It computes a heat flux that needs to be added to each volume of <a href="modelica://Modelica.Fluid.Storage.Stratified">
Modelica.Fluid.Storage.Stratified</a> in order to give the results that a third-order upwind discretization scheme (QUICK) would give.
</p>
<p>
The QUICK method can cause oscillations in the tank temperatures since the high order method introduces numerical dispersion.
There are two ways to reduce the oscillations:</p>
<ul>
<li>
To use an under-relaxation coefficient <code>alpha</code> when adding the heat flux into the volume.
</li>
<li>
To use the first-order upwind for <code>hOut[2]</code> and <code>hOut[nSeg]</code>. Note: Using it requires <code>nSeg>=4</code>.
</li>
</ul>
<p>
Both approaches are implemented in the model.
</p>
<p>
The model is used by
<A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.StratifiedEnhanced"
>
Buildings.Fluid.Storage.StratifiedEnhanced</a>.
</p>
<h4>Limitations</h4>
<p>
The model requires at least 4 fluid segments. Hence, set <code>nSeg</code> to 4 or higher.
</p>
<P></P>
Extends from <A HREF="Buildings_BaseClasses.html#Buildings.BaseClasses.BaseIcon"
>Buildings.BaseClasses.BaseIcon</A> (Base icon).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD>Modelica.Media.Interfaces.Pa...</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_small</TD><TD>&nbsp;</TD><TD>Small mass flow rate for regularization of zero flow [kg/s]</TD></TR>
<TR><TD>Integer</TD><TD>nSeg</TD><TD>&nbsp;</TD><TD>Number of volume segments</TD></TR>
<TR><TD>Real</TD><TD>alpha</TD><TD>0.5</TD><TD>Under-relaxation coefficient (1: QUICK; 0: 1st order upwind)</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heatPort[nSeg]</TD><TD>Heat input into the volumes</TD></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>m_flow</TD><TD>Mass flow rate from port a to port b</TD></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>H_flow[nSeg + 1]</TD><TD>Enthalpy flow between the volumes</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>fluidPort[nSeg + 2]</TD><TD>Fluid port, needed to get pressure, temperature and species concentration</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> ThirdOrderStratifier <font color="darkgreen">
  &quot;Model to reduce the numerical dissipation in a tank&quot;</font>
  <font color="blue">extends </font><A HREF="Buildings_BaseClasses.html#Buildings.BaseClasses.BaseIcon"
>Buildings.BaseClasses.BaseIcon</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> Medium = <A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>Modelica.Media.Interfaces.PartialMedium</A> <font color="darkgreen">
    &quot;Medium model&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> m_flow_small(min=0) <font color="darkgreen">
    &quot;Small mass flow rate for regularization of zero flow&quot;</font>;
  <font color="blue">parameter </font>Integer nSeg(min=4) <font color="darkgreen">&quot;Number of volume segments&quot;</font>;

  <font color="blue">parameter </font>Real alpha(
    min=0,
    max=1) = 0.5 <font color="darkgreen">&quot;Under-relaxation coefficient (1: QUICK; 0: 1st order upwind)&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</A>[nSeg] heatPort <font color="darkgreen">
    &quot;Heat input into the volumes&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> m_flow <font color="darkgreen">
    &quot;Mass flow rate from port a to port b&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A>[nSeg + 1] H_flow <font color="darkgreen">
    &quot;Enthalpy flow between the volumes&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>Modelica.Fluid.Interfaces.FluidPort_a</A>[nSeg + 2] fluidPort(<font color="blue">redeclare </font><font color="blue">each </font><font color="blue">
      package</font> Medium = Medium) <font color="darkgreen">
    &quot;Fluid port, needed to get pressure, temperature and species concentration&quot;</font>;</textblock>

<font color="blue">protected </font>
  <A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.SpecificEnthalpy"
>Modelica.SIunits.SpecificEnthalpy</A>[nSeg + 1] hOut <font color="darkgreen">
    &quot;Extended vector with new outlet enthalpies to reduce numerical dissipation (at the boundary between two volumes)&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.SpecificEnthalpy"
>Modelica.SIunits.SpecificEnthalpy</A>[nSeg + 2] h <font color="darkgreen">
    &quot;Extended vector with port enthalpies, needed to simplify loop&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> Q_flow[nSeg] <font color="darkgreen">
    &quot;Heat exchange computed using upwind third order discretization scheme&quot;</font>;
  <font color="darkgreen">//    Modelica.SIunits.HeatFlowRate Q_flow_upWind</font>
  <font color="darkgreen">//     &quot;Heat exchange computed using upwind third order discretization scheme&quot;; //Used to test the energy conservation</font>
  Real sig <font color="darkgreen">
    &quot;Sign used to implement the third order upwind scheme without triggering a state event&quot;</font>;
  Real comSig <font color="darkgreen">
    &quot;Sign used to implement the third order upwind scheme without triggering a state event&quot;</font>;

<font color="blue">equation </font>
  <font color="red">assert</font>(nSeg &gt;= 4, &quot;
Number of segments of the enhanced stratified tank should be no less than 4 (nSeg&gt;=4).&quot;);

  <font color="darkgreen">// assign zero flow conditions at port</font>
  fluidPort[:].m_flow =<font color="red"> zeros</font>(nSeg + 2);
  fluidPort[:].h_outflow =<font color="red"> zeros</font>(nSeg + 2);
  fluidPort[:].Xi_outflow =<font color="red"> zeros</font>(nSeg + 2, Medium.nXi);
  fluidPort[:].C_outflow =<font color="red"> zeros</font>(nSeg + 2, Medium.nC);

  <font color="darkgreen">// assign extended enthalpy vectors</font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:nSeg + 2<font color="blue"> loop</font>
    h[i] =<font color="red"> inStream</font>(fluidPort[i].h_outflow);
  <font color="blue">end for</font>;

  <font color="darkgreen">// Value that transitions between 0 and 1 as the flow reverses.</font>
  sig =<font color="red"> Modelica.Fluid.Utilities.regStep</font>(
    m_flow,
    1,
    0,
    m_flow_small);
  <font color="darkgreen">           // at surface between port_a and vol1</font>

  comSig = 1 - sig;

  <font color="darkgreen">// at surface between port_a and vol1</font>
  hOut[1] = sig*h[1] + comSig*h[2];
  <font color="darkgreen">// at surface between vol[nSeg] and port_b</font>
  hOut[nSeg + 1] = sig*h[nSeg + 1] + comSig*h[nSeg + 2];

  <font color="darkgreen">// Pros: These two equations can further reduce the temperature overshoot by using the upwind</font>
  <font color="darkgreen">// Cons: The minimum of nSeg hase to be 4 instead of 2.</font>
  hOut[2] = sig*h[2] + comSig*h[3];
  <font color="darkgreen">// at surface between vol1 and vol2</font>
  hOut[nSeg] = sig*h[nSeg] + comSig*h[nSeg + 1];
  <font color="darkgreen">// at surface between vol[nSeg-1] and vol[nSeg]</font>

  <font color="blue">for </font>i<font color="blue"> in </font>3:nSeg - 1<font color="blue"> loop</font>
    <font color="darkgreen">// at surface between vol[i-1] and vol[i]</font>
    <font color="darkgreen">// QUICK method</font>
    hOut[i] = 0.5*(h[i] + h[i + 1]) - comSig*0.125*(h[i + 2] + h[i] - 2*h[i + 1])
       - sig*0.125*(h[i - 1] + h[i + 1] - 2*h[i]);
    <font color="darkgreen">//     hOut[i] = 0.5*(h[i]+h[i+1]); // Central difference method</font>
  <font color="blue">end for</font>;

  <font color="blue">for </font>i<font color="blue"> in </font>1:nSeg<font color="blue"> loop</font>
    <font color="darkgreen">// difference between QUICK and UPWIND; index of H_flow is same as hOut</font>
    Q_flow[i] = m_flow*(hOut[i + 1] - hOut[i]) - (H_flow[i + 1] - H_flow[i]);
  <font color="blue">end for</font>;

  <font color="darkgreen">//   Q_flow_upWind = sum(Q_flow[i] for i in 1:nSeg); //Used to test the energy conservation</font>

  <font color="blue">for </font>i<font color="blue"> in </font>1:nSeg<font color="blue"> loop</font>
    <font color="darkgreen">// Add the difference back to the volume as heat flow. An under-relaxation is needed to reduce</font>
    <font color="darkgreen">// oscillations caused by high order method</font>
    heatPort[i].Q_flow = Q_flow[i]*alpha;
  <font color="blue">end for</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>ThirdOrderStratifier;
</PRE>
<HR>
<address><a href="http://www.3ds.com/">Automatically generated</a> Fri Dec 13 11:35:56 2013.
</address></BODY>
</HTML>
