

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>5. Development &#8212; Buildings Library User Guide</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap_custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom-sphinx.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/lbl-icon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Help" href="help.html" />
    <link rel="prev" title="4. Pre- and Post-Processing" href="prePostProcessing.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container-fluid">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><img src="_static/lbl-logo.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://simulationresearch.lbl.gov/modelica">Home</a></li>
                <li><a href="index.html">User Guide</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingStarted.html">1. Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gettingStarted.html#literature-for-users">1.1. Literature for Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingStarted.html#literature-for-developers">1.2. Literature for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingStarted.html#software-requirements">1.3. Software Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingStarted.html#running-the-first-simulations">1.4. Running the First Simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingStarted.html#references">1.5. References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bestPractice.html">2. Best Practice</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bestPractice.html#organization-of-packages">2.1. Organization of packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="bestPractice.html#building-large-system-models">2.2. Building large system models</a></li>
<li class="toctree-l2"><a class="reference internal" href="bestPractice.html#propagating-parameters-and-media-packages">2.3. Propagating parameters and media packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="bestPractice.html#thermo-fluid-systems">2.4. Thermo-fluid systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="bestPractice.html#start-values-of-iteration-variables">2.5. Start values of iteration variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="bestPractice.html#avoiding-events">2.6. Avoiding events</a></li>
<li class="toctree-l2"><a class="reference internal" href="bestPractice.html#controls">2.7. Controls</a></li>
<li class="toctree-l2"><a class="reference internal" href="bestPractice.html#examples-for-how-to-debug-and-correct-slow-simulations">2.8. Examples for how to debug and correct slow simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="bestPractice.html#numerical-solvers">2.9. Numerical solvers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workArounds.html">3. Work-Arounds</a><ul>
<li class="toctree-l2"><a class="reference internal" href="workArounds.html#avoiding-step-changes">3.1. Avoiding step changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="workArounds.html#breaking-algebraic-loops">3.2. Breaking algebraic loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="workArounds.html#reducing-nonlinear-equations-of-serially-connected-flow-resistances">3.3. Reducing nonlinear equations of serially connected flow resistances</a></li>
<li class="toctree-l2"><a class="reference internal" href="workArounds.html#prescribed-mass-flow-rate">3.4. Prescribed mass flow rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="workArounds.html#avoiding-overspecified-initialization-problems">3.5. Avoiding overspecified initialization problems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prePostProcessing.html">4. Pre- and Post-Processing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#contributing">5.1. Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#guidelines-for-contributions">5.2. Guidelines for contributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-class">5.3. Adding a new class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validation">5.4. Validation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="help.html">6. Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">7. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">8. Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="disclaimer.html">9. Disclaimers</a></li>
<li class="toctree-l1"><a class="reference internal" href="legal.html">10. Copyright and License</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">5. Development</a><ul>
<li><a class="reference internal" href="#contributing">5.1. Contributing</a></li>
<li><a class="reference internal" href="#guidelines-for-contributions">5.2. Guidelines for contributions</a></li>
<li><a class="reference internal" href="#adding-a-new-class">5.3. Adding a new class</a><ul>
<li><a class="reference internal" href="#thermofluid-flow-device">5.3.1. Thermofluid flow device</a></li>
<li><a class="reference internal" href="#pressure-drop">5.3.2. Pressure drop</a></li>
<li><a class="reference internal" href="#control-sequences-using-the-control-description-language">5.3.3. Control Sequences using the Control Description Language</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validation">5.4. Validation</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="prePostProcessing.html" title="Previous Chapter: 4. Pre- and Post-Processing"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 4. Pre- and P...</span>
    </a>
  </li>
  <li>
    <a href="help.html" title="Next Chapter: 6. Help"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">6. Help &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

<!--
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
-->
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="development">
<span id="id1"></span><h1>5. Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h1>
<p>This section describes the development of the <cite>Buildings</cite> library.
The development of the library is conducted at <a class="reference external" href="https://github.com/lbl-srg/modelica-buildings">https://github.com/lbl-srg/modelica-buildings</a></p>
<div class="section" id="contributing">
<h2>5.1. Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p>Contributions of new models and suggestions for how to improve the library are
welcome.
Contributions are ideally made by first opening an issue at <a class="reference external" href="https://github.com/lbl-srg/modelica-buildings">https://github.com/lbl-srg/modelica-buildings</a>
and by providing a pull request with the new code.</p>
</div>
<div class="section" id="guidelines-for-contributions">
<span id="sec-dev-gui-con"></span><h2>5.2. Guidelines for contributions<a class="headerlink" href="#guidelines-for-contributions" title="Permalink to this headline">¶</a></h2>
<p>Models that are contributed need to adhere to the following guidelines, as this is needed to integrate them in the library, make them accessible to users and further maintain them:</p>
<blockquote>
<div><ul class="simple">
<li><p>They should be of general interest to other users and well documented and tested.</p></li>
<li><p>They need to follow the coding conventions described in</p>
<ul>
<li><p>the <a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_UsersGuide.html#Buildings.UsersGuide.Conventions">Buildings library user guide</a>,</p></li>
<li><p>the <a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/msl/3.2/help/Modelica_UsersGuide_Conventions.html#Modelica.UsersGuide.Conventions">Modelica Standard Library user guide</a>, and</p></li>
<li><p>the <a class="reference external" href="https://github.com/lbl-srg/modelica-buildings/wiki/Style-Guide">Buildings library style guide</a>.</p></li>
</ul>
</li>
<li><p>They need to be made available under the <a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_UsersGuide.html#Buildings.UsersGuide.License">Modelica Buildings Library license</a>.</p></li>
<li><p>For models of thermofluid flow components, they need to be based on the base classes in
<a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_Interfaces.html">Buildings.Fluid.Interfaces</a>,
which are described in the <a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_Interfaces_UsersGuide.html#Buildings.Fluid.Interfaces.UsersGuide">user guide</a> of this package.
Otherwise, it becomes difficult to ensure that the implementation is numerically robust.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="adding-a-new-class">
<h2>5.3. Adding a new class<a class="headerlink" href="#adding-a-new-class" title="Permalink to this headline">¶</a></h2>
<p>Adding a new class, such as a model or a function, is usually easiest by extending, or copying and modifying, an existing class.
In many cases, the similar component already exists.
In this situation, it is recommended to copy and modify a similar component.
If both components share a significant amount of similar code, then a base class should be introduced that implements the common code.
See for example <a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_Sensors_BaseClasses.html#Buildings.Fluid.Sensors.BaseClasses.PartialAbsoluteSensor">Buildings.Fluid.Sensors.BaseClasses.PartialAbsoluteSensor</a> which is shared by all sensors with one fluid port in the package
<a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors">Buildings.Fluid.Sensors</a>.</p>
<p>The next sections give guidance that is specific to the implementation of thermofluid flow devices, pressure drop models and control sequences.</p>
<div class="section" id="thermofluid-flow-device">
<h3>5.3.1. Thermofluid flow device<a class="headerlink" href="#thermofluid-flow-device" title="Permalink to this headline">¶</a></h3>
<p>To add a component of a thermofluid flow device, the package
<a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_Interfaces.html">Buildings.Fluid.Interface</a>  contains basic classes that can be extended.
See <a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_Interfaces_UsersGuide.html#Buildings.Fluid.Interfaces.UsersGuide">Buildings.Fluid.Interface.UsersGuide</a> for a description of these classes.
Alternatively, simple models such as the models below may be used as a starting point for implementing new models for thermofluid flow devices:</p>
<dl class="simple">
<dt><a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_HeatExchangers.html#Buildings.Fluid.HeatExchangers.HeaterCooler_u">Buildings.Fluid.HeatExchangers.HeaterCooler_u</a></dt><dd><p>For a device that adds heat to a fluid stream.</p>
</dd>
<dt><a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_Humidifiers.html#Buildings.Fluid.Humidifiers.Humidifier_u">Buildings.Fluid.Humidifiers.Humidifier_u</a></dt><dd><p>For a device that adds humidity to a fluid stream.</p>
</dd>
<dt><a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_Chillers.html#Buildings.Fluid.Chillers.Carnot_y">Buildings.Fluid.Chillers.Carnot_y</a></dt><dd><p>For a device that exchanges heat between two fluid streams.</p>
</dd>
<dt><a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_MassExchangers.html#Buildings.Fluid.MassExchangers.ConstantEffectiveness">Buildings.Fluid.MassExchangers.ConstantEffectiveness</a></dt><dd><p>For a device that exchanges heat and humidity between two fluid streams.</p>
</dd>
</dl>
<div class="figure align-default" id="id2">
<span id="fig-merkel"></span><a class="reference internal image-reference" href="_images/Merkel.png"><img alt="_images/Merkel.png" src="_images/Merkel.png" style="width: 546.7px; height: 369.90000000000003px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.1 </span><span class="caption-text">Schematic diagram of the cooling tower model based on the Merkel theory.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>If models involve complex calculations, then these models are generally easiest to understand
for users if these calculations are in a separate block that then interfaces to the fluid flow model
using the above basic class. An example is the model <cite>Buildings.Fluid.HeatExchangers.CoolingTowers.Merkel</cite>
that will be released with Buildings 6.0.0.
<a class="reference internal" href="#fig-merkel"><span class="std std-numref">Fig. 5.1</span></a> shows the schematic diagram of the model. The block <cite>per</cite> in the figure implements the
thermodynamic calculations. The model shows that the cooling tower performance only depends on
the control signal <cite>y</cite>, the air inlet temperature <cite>TAir</cite>, the water inlet temperature <cite>TWatIn</cite> and the
water mass flow rate <cite>mWat_flow</cite>.</p>
</div>
<div class="section" id="pressure-drop">
<h3>5.3.2. Pressure drop<a class="headerlink" href="#pressure-drop" title="Permalink to this headline">¶</a></h3>
<p>When implementing equations for pressure drop, it is recommended
to expand the base class
<a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_BaseClasses.html#Buildings.Fluid.BaseClasses.PartialResistance">Buildings.Fluid.BaseClasses.PartialResistance</a>.
Models should allow computing the flow resistance as a quadratic function
with regularization near zero as implemented in
<a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_BaseClasses_FlowModels.html#Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_dp">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_dp</a> and in
<a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_BaseClasses_FlowModels.html#Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_m_flow">Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_m_flow</a>.
The governing equation is</p>
<div class="math notranslate nohighlight">
\[k = \frac{\dot m}{\sqrt{\Delta p}}\]</div>
<p>with regularization near zero to avoid that the limit
<span class="math notranslate nohighlight">\({d \dot m}/{d \Delta p}\)</span> tends to infinity as <span class="math notranslate nohighlight">\(\dot m \to 0\)</span>,
as this can cause Newton-based solvers to stall.
For fixed flow resistances, <span class="math notranslate nohighlight">\(k\)</span> is typically computed based on nominal
conditions such as <span class="math notranslate nohighlight">\(k = \dot m_0/\sqrt{\Delta p_0}\)</span>,
where <span class="math notranslate nohighlight">\(\dot m_0\)</span> is equal to the parameter <code class="docutils literal notranslate"><span class="pre">m_flow_nominal</span></code> and
<span class="math notranslate nohighlight">\(\Delta p_0\)</span> is equal to the parameter <code class="docutils literal notranslate"><span class="pre">dp_nominal.</span></code></p>
<p>All pressure drop models should also provide a parameter that allows replacing
the equation by a linear model of the form</p>
<div class="math notranslate nohighlight">
\[\dot m \, \dot m_0 = \bar k^2 \, \Delta p\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Equations for pressure drop are implemented as a function of mass flow rate
and not volume flow rate. For some models, this allows decoupling
the mass flow balance from the energy balance.
Otherwise, computing the mass flow distribution would require knowledge
of the density, which may depend on temperature, and temperature is only
known after solving the energy balance.</p>
</div>
<p>When implementing the pressure drop model, also provide means to</p>
<ol class="arabic simple">
<li><p>use homotopy, which should be used by default, and</p></li>
<li><p>disable the pressure-drop model.</p></li>
</ol>
<p>Disabling the pressure-drop model allows, for example, a user to
set in a series connection of a heating coil and a cooling coil
the pressure drop of the heating coil to zero, and
to lump the pressure drop of the heating coil into the pressure drop model
of the cooling coil.
This often reduces the size of the system of nonlinear equations.</p>
</div>
<div class="section" id="control-sequences-using-the-control-description-language">
<h3>5.3.3. Control Sequences using the Control Description Language<a class="headerlink" href="#control-sequences-using-the-control-description-language" title="Permalink to this headline">¶</a></h3>
<p>To implement reusable control sequences, such as done within
the <a class="reference external" href="https://obc.lbl.gov">OpenBuildingControl</a> project, the
sequences need to comply with the
<a class="reference external" href="https://obc.lbl.gov/specification/cdl.html">specification of the Control Description Language</a>.</p>
<p>The following rules need to be followed, in addition to the guidelines described in <a class="reference internal" href="#sec-dev-gui-con"><span class="std std-numref">Section 5.2</span></a>.</p>
<ol class="arabic">
<li><p>The naming of parameters, inputs, outputs and instances must follow the naming
conventions in
<a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_UsersGuide.html#Buildings.UsersGuide.Conventions">Buildings.UsersGuide.Conventions</a>.</p></li>
<li><p>Each block must have an <code class="docutils literal notranslate"><span class="pre">info</span></code> section that explains its functionality.
In this <code class="docutils literal notranslate"><span class="pre">info</span></code> section, names of <code class="docutils literal notranslate"><span class="pre">parameters</span></code>, <code class="docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs</span></code>
need to be referenced using the html <code class="docutils literal notranslate"><span class="pre">&lt;code&gt;...&lt;/code&gt;</span></code> element.
In the <code class="docutils literal notranslate"><span class="pre">info</span></code> section, units need to be provided in SI units, or in dual units. For SI units,
use Kelvin for temperature <em>differences</em> and degree Celsius for actual temperatures.</p></li>
<li><p>Parameters that can be grouped together, such as parameters relating to temperature setpoints
or to the configuration of the trim and respond logic, should be grouped together with the
<code class="docutils literal notranslate"><span class="pre">Dialog(group=STRING))</span></code> annotation. See for example
<a class="reference external" href="https://github.com/lbl-srg/modelica-buildings/blob/94d5919dbe1b2f2e317e7b69800f3b3ad07be930/Buildings/Controls/OBC/ASHRAE/G36_PR1/TerminalUnits/Controller.mo">G36_PR1.TerminalUnits.Controller</a>.
Do not use <code class="docutils literal notranslate"><span class="pre">Dialog(tab=STRING))</span></code>, unless the parameter is declared with a default value
and this parameter and its value is of no interest to typical users.</p></li>
<li><p>Each block must have a <code class="docutils literal notranslate"><span class="pre">defaultComponentName</span></code> annotation.</p></li>
<li><p>To aid readability, the formatting of the Modelica source code file must be consistent with other
implemented blocks, e.g., use two spaces for indentation (no tabulators),
assign each parameter value on a new line, list first all parameters, then all inputs, all
outputs, and finally all instances of other blocks.
See for example
<a class="reference external" href="https://github.com/lbl-srg/modelica-buildings/blob/94d5919dbe1b2f2e317e7b69800f3b3ad07be930/Buildings/Controls/OBC/ASHRAE/G36_PR1/AHUs/SingleZone/VAV/SetPoints/ExhaustDamper.mo">G36_PR1.AHUs.SingleZone.VAV.SetPoints.ExhaustDamper</a>.</p></li>
<li><p>For parameters, where generally valid values can be provided, provide them
as default values.</p></li>
<li><p>For PI controllers, normalize the inputs for setpoint and measured value so
that the control error is of the order of one.
As control errors for temperature tracking are usually in the order of one,
these need not be normalized. But for pressure differentials, which can be
thousands of Pascal, normalization aids in providing reasonable control gains
and it aids in tuning.</p></li>
<li><p>Never use an inequality comparison without a hysteresis or a time delay if the variable that is used in the inequality test
is computed using an iterative solver, or is obtained from a measurement and hence can contain measurement noise.
An exception is a sampled value because the output of a sampler remains constant until the next sampling instant.
See <a class="reference internal" href="bestPractice.html#sec-bes-pra-con"><span class="std std-numref">Section 2.7</span></a>.</p></li>
<li><p>CDL uses the following units, which also need to be used in controllers, including
their parameters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 9%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Physical Quantity</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Temperature</p></td>
<td><p>K</p></td>
<td><p>Use <cite>displayUnit=degC</cite></p></td>
</tr>
<tr class="row-odd"><td><p>Temperature difference</p></td>
<td><p>K</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Volume flow rate</p></td>
<td><p>m3/s</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Mass flow rate</p></td>
<td><p>kg/s</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Pressure</p></td>
<td><p>Pa</p></td>
<td><p>Use <cite>displayUnit=bar</cite></p></td>
</tr>
<tr class="row-odd"><td><p>Pressure differential</p></td>
<td><p>Pa</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Relative humidity</p></td>
<td><p>1</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Range of control signal</p></td>
<td><p>1</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>Hence, for example, a controller that takes as an input a temperature and a temperature difference
and produces as an output a damper position signal, use a declaration such as shown in the code snippet below
in which graphical annotations are omitted.</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="n">Buildings</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">OBC</span><span class="o">.</span><span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">TZon</span><span class="p">(</span>
  <span class="kr">final</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;K&quot;</span><span class="p">,</span>
  <span class="n">displayUnit</span><span class="o">=</span><span class="s2">&quot;degC&quot;</span><span class="p">)</span> <span class="s2">&quot;Measured zone air temperature&quot;</span><span class="p">;</span>

<span class="n">Buildings</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">OBC</span><span class="o">.</span><span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealInput</span> <span class="n">dTSup</span><span class="p">(</span>
  <span class="kr">final</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;K&quot;</span><span class="p">)</span> <span class="s2">&quot;Temperature difference supply air minus exhaust air&quot;</span><span class="p">;</span>

<span class="n">Buildings</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">OBC</span><span class="o">.</span><span class="n">CDL</span><span class="o">.</span><span class="n">Interfaces</span><span class="o">.</span><span class="n">RealOutput</span> <span class="n">yDam</span><span class="p">(</span>
  <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
  <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
  <span class="kr">final</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">)</span> <span class="s2">&quot;Exhaust damper position&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Here, units are declared as <code class="docutils literal notranslate"><span class="pre">final</span></code> to avoid users to be able to change them, as
a change in unit may cause the control logic to be incorrect.</p>
<p>Conversion of these units to non-SI units can be done programmatically by tools that
process CDL.</p>
</li>
<li><p>If the block diagram does not fit into the drawing pane, enlarge the drawing pane rather
than making the blocks smaller.</p></li>
<li><p>For simple, small controllers, provide a unit test in a <code class="docutils literal notranslate"><span class="pre">Validation</span></code> or <code class="docutils literal notranslate"><span class="pre">Examples</span></code> package
that is in the hierarchy one level below the implemented controller.
See <a class="reference internal" href="#sec-val"><span class="std std-numref">Section 5.4</span></a> for unit test implementation.
Because some control logic errors may only be noticed
when used in a closed loop test,
for equipment and system controllers, provide also closed loop examples that test the sequence
for all modes of operation. If the closed loop examples include HVAC models, then put them
outside of the <code class="docutils literal notranslate"><span class="pre">Buildings.Controls.OBC</span></code> package.
Make sure sequences are tested for all modes of operation, and as applicable, for winter, shoulder
and summer days.</p></li>
</ol>
</div>
</div>
<div class="section" id="validation">
<span id="sec-val"></span><h2>5.4. Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h2>
<p>All models that are implemented need to be validated for all
realistic operating modes.
These validations need to be part of the
<a class="reference external" href="https://github.com/lbl-srg/modelica-buildings/wiki/Unit-Tests">unit tests</a>.</p>
<p>Add a couple of sentences that explain to others the intent of the unit test.
For example, an air handler unit controller test could describe
“This model verifies that as the cooling load of the room increases, the controller
first increases the mass flow rate setpoint and then reduces the supply temperature setpoint.”</p>
<p>For simple models, the validation can be against analytic solutions.
This is for example done in
<a class="reference external" href="https://simulationresearch.lbl.gov/modelica/releases/latest/help/Buildings_Fluid_FixedResistances_Examples.html#Buildings.Fluid.FixedResistances.Examples.PressureDrop">Buildings.Fluid.FixedResistances.PressureDrop</a>
which uses a regression tests that checks the correct relation between mass flow rate and pressure drop.
For complex thermofluid flow devices, a comparative model validation needs to be done, for example
by comparing the result of the Modelica model against the results from EnergyPlus.
An example is
<cite>Buildings.Fluid.HeatExchangers.CoolingTowers.Validation.MerkelEnergyPlus</cite>.
For such validations, the following files also need to be added to the repository:</p>
<blockquote>
<div><ul>
<li><p>The EnergyPlus input data file. Please make sure it only requires a weather data file that already exists in the Buildings library.</p></li>
<li><p>A bash script called <cite>run.sh</cite> that</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>runs the EnergyPlus model on Linux, and</p></li>
<li><p>invokes a Python script that converts the EnergyPlus output file (see next item).</p></li>
</ol>
</div></blockquote>
<p>This file will automatically be
executed as part of the continuous integration testing.</p>
</li>
<li><p>A Python script that converts the EnergyPlus output file to the data file that can
be read by the Modelica data reader.</p></li>
</ul>
</div></blockquote>
<p>See for example <cite>Buildings/Resources/Data/Fluid/HeatExchangers/CoolingTowers/Validation</cite> for an implementation.</p>
</div>
</div>


    </div>
      
  </div>
</div>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2012-2020, The Regents of the University of California (through Lawrence Berkeley National Laboratory).<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.<br/>
    </p>
  </div>
</footer>

  </body>
</html>