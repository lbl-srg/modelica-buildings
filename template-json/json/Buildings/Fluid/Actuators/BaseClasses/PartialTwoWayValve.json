{
  "within": "Buildings.Fluid.Actuators.BaseClasses",
  "class_definition": [
    {
      "class_prefixes": "partial model",
      "class_specifier": {
        "long_class_specifier": {
          "identifier": "PartialTwoWayValve",
          "description_string": "Partial model for a two way valve",
          "composition": {
            "element_list": [
              {
                "extends_clause": {
                  "name": "Buildings.Fluid.BaseClasses.PartialResistance",
                  "class_modification": [
                    {
                      "element_modification_or_replaceable": {
                        "final": true,
                        "element_modification": {
                          "name": "dp_nominal",
                          "modification": {
                            "equal": true,
                            "expression": {
                              "simple_expression": "dpValve_nominal +dpFixed_nominal"
                            }
                          }
                        }
                      }
                    },
                    {
                      "element_modification_or_replaceable": {
                        "element_modification": {
                          "name": "dp",
                          "modification": {
                            "class_modification": [
                              {
                                "element_modification_or_replaceable": {
                                  "element_modification": {
                                    "name": "nominal",
                                    "modification": {
                                      "equal": true,
                                      "expression": {
                                        "simple_expression": "6000"
                                      }
                                    }
                                  }
                                }
                              }
                            ]
                          }
                        }
                      }
                    },
                    {
                      "element_modification_or_replaceable": {
                        "final": true,
                        "element_modification": {
                          "name": "m_flow_turbulent",
                          "modification": {
                            "equal": true,
                            "expression": {
                              "simple_expression": "deltaM*abs(m_flow_nominal)"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              },
              {
                "extends_clause": {
                  "name": "Buildings.Fluid.Actuators.BaseClasses.ValveParameters",
                  "class_modification": [
                    {
                      "element_modification_or_replaceable": {
                        "element_modification": {
                          "name": "rhoStd",
                          "modification": {
                            "equal": true,
                            "expression": {
                              "simple_expression": {
                                "function_call": {
                                  "name": "Medium.density_pTX",
                                  "arguments": [
                                    {
                                      "name": "101325"
                                    },
                                    {
                                      "name": "273.15 +4,Medium.X_default"
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              },
              {
                "extends_clause": {
                  "name": "Buildings.Fluid.Actuators.BaseClasses.ActuatorSignal"
                }
              },
              {
                "component_clause": {
                  "type_prefix": "parameter",
                  "type_specifier": "Modelica.Units.SI.PressureDifference",
                  "component_list": [
                    {
                      "declaration": {
                        "identifier": "dpFixed_nominal",
                        "modification": {
                          "class_modification": [
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "displayUnit",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "\"Pa\""
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "min",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "0"
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "equal": true,
                          "expression": {
                            "simple_expression": "0"
                          }
                        }
                      },
                      "description": {
                        "description_string": "Pressure drop of pipe and other resistances that are in series",
                        "annotation": [
                          {
                            "element_modification_or_replaceable": {
                              "element_modification": {
                                "name": "Dialog",
                                "modification": {
                                  "class_modification": [
                                    {
                                      "element_modification_or_replaceable": {
                                        "element_modification": {
                                          "name": "group",
                                          "modification": {
                                            "equal": true,
                                            "expression": {
                                              "simple_expression": "\"Nominal condition\""
                                            }
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              },
              {
                "component_clause": {
                  "type_prefix": "parameter",
                  "type_specifier": "Real",
                  "component_list": [
                    {
                      "declaration": {
                        "identifier": "l",
                        "modification": {
                          "class_modification": [
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "min",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "1e-10"
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "max",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "1"
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "equal": true,
                          "expression": {
                            "simple_expression": "0.0001"
                          }
                        }
                      },
                      "description": {
                        "description_string": "Valve leakage, l=Kv(y=0)/Kv(y=1)"
                      }
                    }
                  ]
                }
              },
              {
                "component_clause": {
                  "type_prefix": "input",
                  "type_specifier": "Real",
                  "component_list": [
                    {
                      "declaration": {
                        "identifier": "phi"
                      },
                      "description": {
                        "description_string": "Ratio actual to nominal mass flow rate of valve, phi=Kv(y)/Kv(y=1)"
                      }
                    }
                  ]
                }
              },
              {
                "component_clause": {
                  "type_prefix": "parameter",
                  "type_specifier": "Real",
                  "component_list": [
                    {
                      "declaration": {
                        "identifier": "kFixed",
                        "modification": {
                          "class_modification": [
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "unit",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "\"\""
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "min",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "0"
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "equal": true,
                          "expression": {
                            "if_expression": {
                              "if_elseif": [
                                {
                                  "condition": {
                                    "simple_expression": {
                                      "logical_expression": {
                                        "logical_or": [
                                          {
                                            "logical_and": [
                                              {
                                                "arithmetic_expressions": [
                                                  {
                                                    "name": "dpFixed_nominal"
                                                  },
                                                  {
                                                    "name": "Modelica.Constants.eps"
                                                  }
                                                ],
                                                "relation_operator": ">"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "then": {
                                    "simple_expression": "m_flow_nominal/sqrt(dpFixed_nominal)"
                                  }
                                }
                              ],
                              "else_expression": {
                                "simple_expression": "0"
                              }
                            }
                          }
                        }
                      },
                      "description": {
                        "description_string": "Flow coefficient of fixed resistance that may be in series with valve, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2)."
                      }
                    }
                  ]
                }
              },
              {
                "component_clause": {
                  "type_specifier": "Real",
                  "component_list": [
                    {
                      "declaration": {
                        "identifier": "kVal",
                        "modification": {
                          "class_modification": [
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "unit",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "\"\""
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "min",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "Modelica.Constants.small"
                                    }
                                  }
                                }
                              }
                            }
                          ]
                        }
                      },
                      "description": {
                        "description_string": "Flow coefficient of valve, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2)."
                      }
                    }
                  ]
                }
              },
              {
                "component_clause": {
                  "type_specifier": "Real",
                  "component_list": [
                    {
                      "declaration": {
                        "identifier": "k",
                        "modification": {
                          "class_modification": [
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "unit",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "\"\""
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "element_modification_or_replaceable": {
                                "element_modification": {
                                  "name": "min",
                                  "modification": {
                                    "equal": true,
                                    "expression": {
                                      "simple_expression": "Modelica.Constants.small"
                                    }
                                  }
                                }
                              }
                            }
                          ]
                        }
                      },
                      "description": {
                        "description_string": "Flow coefficient of valve and pipe in series, k=m_flow/sqrt(dp), with unit=(kg.m)^(1/2)."
                      }
                    }
                  ]
                }
              }
            ],
            "element_sections": [
              {
                "equation_section": {
                  "initial": true,
                  "equation": [
                    {
                      "function_call_equation": {
                        "function_name": "assert",
                        "function_call_args": {
                          "function_argument": {
                            "expression": {
                              "simple_expression": {
                                "logical_expression": {
                                  "logical_or": [
                                    {
                                      "logical_and": [
                                        {
                                          "arithmetic_expressions": [
                                            {
                                              "name": "dpFixed_nominal"
                                            },
                                            {
                                              "name": "-Modelica.Constants.eps"
                                            }
                                          ],
                                          "relation_operator": ">"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          "function_arguments": {
                            "function_argument": {
                              "expression": {
                                "simple_expression": "\"In \" +getInstanceName() +\": Model requires dpFixed_nominal >= 0 but received dpFixed_nominal = \" +String(dpFixed_nominal) +\" Pa.\""
                              }
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            ],
            "annotation": [
              {
                "element_modification_or_replaceable": {
                  "element_modification": {
                    "name": "Icon",
                    "modification": {
                      "class_modification": [
                        {
                          "element_modification_or_replaceable": {
                            "element_modification": {
                              "coordinateSystem": {
                                "extent": [
                                  {
                                    "x": -100,
                                    "y": -100
                                  },
                                  {
                                    "x": 100,
                                    "y": 100
                                  }
                                ],
                                "preserveAspectRatio": "true"
                              }
                            }
                          }
                        },
                        {
                          "element_modification_or_replaceable": {
                            "element_modification": {
                              "graphics": [
                                {
                                  "name": "Rectangle",
                                  "attribute": {
                                    "extent": [
                                      {
                                        "x": -60,
                                        "y": 40
                                      },
                                      {
                                        "x": 60,
                                        "y": -40
                                      }
                                    ],
                                    "fillColor": {
                                      "r": 255,
                                      "g": 255,
                                      "b": 255
                                    },
                                    "pattern": "LinePattern.None",
                                    "fillPattern": "FillPattern.Solid"
                                  }
                                },
                                {
                                  "name": "Polygon",
                                  "attribute": {
                                    "points": [
                                      {
                                        "x": 0,
                                        "y": 0
                                      },
                                      {
                                        "x": -76,
                                        "y": 60
                                      },
                                      {
                                        "x": -76,
                                        "y": -60
                                      },
                                      {
                                        "x": 0,
                                        "y": 0
                                      }
                                    ],
                                    "lineColor": {
                                      "r": 0,
                                      "g": 0,
                                      "b": 0
                                    },
                                    "fillColor": {
                                      "r": 0,
                                      "g": 0,
                                      "b": null
                                    },
                                    "fillPattern": "FillPattern.Solid"
                                  }
                                },
                                {
                                  "name": "Polygon",
                                  "attribute": {
                                    "points": [
                                      {
                                        "x": 0,
                                        "y": 0
                                      },
                                      {
                                        "x": 76,
                                        "y": 60
                                      },
                                      {
                                        "x": 76,
                                        "y": -60
                                      },
                                      {
                                        "x": 0,
                                        "y": 0
                                      }
                                    ],
                                    "lineColor": {
                                      "r": 0,
                                      "g": 0,
                                      "b": 0
                                    },
                                    "fillColor": {
                                      "r": 255,
                                      "g": 255,
                                      "b": 255
                                    },
                                    "fillPattern": "FillPattern.Solid"
                                  }
                                },
                                {
                                  "name": "Line",
                                  "attribute": {
                                    "points": [
                                      {
                                        "x": -30,
                                        "y": 40
                                      },
                                      {
                                        "x": 30,
                                        "y": 40
                                      }
                                    ],
                                    "visible": "use_strokeTime"
                                  }
                                },
                                {
                                  "name": "Line",
                                  "attribute": {
                                    "points": [
                                      {
                                        "x": 0,
                                        "y": 40
                                      },
                                      {
                                        "x": 0,
                                        "y": 0
                                      }
                                    ]
                                  }
                                },
                                {
                                  "name": "Line",
                                  "attribute": {
                                    "points": [
                                      {
                                        "x": 0,
                                        "y": 100
                                      },
                                      {
                                        "x": 0,
                                        "y": 40
                                      }
                                    ],
                                    "visible": "not use_strokeTime"
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              },
              {
                "element_modification_or_replaceable": {
                  "element_modification": {
                    "name": "Documentation",
                    "modification": {
                      "class_modification": [
                        {
                          "element_modification_or_replaceable": {
                            "element_modification": {
                              "name": "info",
                              "modification": {
                                "equal": true,
                                "expression": {
                                  "simple_expression": "\"<html>\n<p>\nPartial model for a two way valve. This is the base model for valves\nwith different opening characteristics, such as linear, equal percentage,\nquick opening or pressure-independent.\n</p>\n<p>\nTo prevent the derivative <code>d/dP (m_flow)</code> to be infinite near\nthe origin, this model linearizes the pressure drop versus flow relation\nship. The region in which it is linearized is parameterized by\n</p>\n<pre>\n  m_turbulent_flow = deltaM * m_flow_nominal\n</pre>\n<p>\nBecause the parameterization contains <code>Kv_SI</code>, the values for\n<code>deltaM</code> and <code>dp_nominal</code> need not be changed if the valve size\nchanges.\n</p>\n<p>\nIn contrast to the model in <a href=\\\"modelica://Modelica.Fluid\\\">\nModelica.Fluid</a>, this model uses the parameter <code>Kv_SI</code>,\nwhich is the flow coefficient in SI units, i.e.,\nit is the ratio between mass flow rate in <code>kg/s</code> and square root\nof pressure drop in <code>Pa</code>.\n</p>\n<h4>Options</h4>\n<p>\nThis model allows different parameterization of the flow resistance.\nThe different parameterizations are described in\n<a href=\\\"modelica://Buildings.Fluid.Actuators.BaseClasses.ValveParameters\\\">\nBuildings.Fluid.Actuators.BaseClasses.ValveParameters</a>.\n</p>\n<h4>Implementation</h4>\n<p>\nThe two way valve models are implemented using this partial model, as opposed to using\ndifferent functions for the valve opening characteristics, because\neach valve opening characteristics has different parameters.\n</p>\n</html>\""
                                }
                              }
                            }
                          }
                        },
                        {
                          "element_modification_or_replaceable": {
                            "element_modification": {
                              "name": "revisions",
                              "modification": {
                                "equal": true,
                                "expression": {
                                  "simple_expression": "\"<html>\n<ul>\n\n<li>\nApril 2, 2020, by Filip Jorissen:<br/>\nAdded model name in assert message.<br/>\nThis is for\n<a href=\\\"https://github.com/ibpsa/modelica-ibpsa/issues/1334\\\">#1334</a>.\n</li>\n<li>\nFebruary 21, 2020, by Michael Wetter:<br/>\nChanged icon to display its operating stage.<br/>\nThis is for\n<a href=\\\"https://github.com/ibpsa/modelica-ibpsa/issues/1294\\\">#1294</a>.\n</li>\n<li>\nNovember 9, 2019, by Filip Jorissen:<br/>\nRemoved assert for <code>phi>-0.2</code>\nsince the valve control input is now lower limited\nto zero.\nSee <a href=\\\"https://github.com/ibpsa/modelica-ibpsa/issues/1223\\\">\nissue 1223</a>.\n</li>\n<li>\nOctober 25, 2019, by Jianjun Hu:<br/>\nImproved icon graphics annotation. This is for\n<a href=\\\"https://github.com/ibpsa/modelica-ibpsa/issues/1225\\\">#1225</a>.\n</li>\n<li>\nMarch 24, 2017, by Michael Wetter:<br/>\nRenamed <code>filteredInput</code> to <code>use_inputFilter</code>.<br/>\nThis is for\n<a href=\\\"https://github.com/ibpsa/modelica-ibpsa/issues/665\\\">#665</a>.\n</li>\n<li>\nNovember 16, 2017, by Michael Wetter:<br/>\nRelaxed assertion on <code>phi</code>.<br/>\nThis is for\n<a href=\\\"https://github.com/ibpsa/modelica-ibpsa/issues/592\\\">#592</a>.\n</li>\n<li>\nOctober 27, 2016, by Filip Jorissen:<br/>\nAdded assert for <code>phi &gt; 0</code>.\nThis fixes a bug that caused valves to behave\nlike pumps for negative control signals.\nThis is for\n<a href=\\\"https://github.com/ibpsa/modelica-ibpsa/issues/558\\\">#558</a>.\n</li>\n<li>\nApril 23, 2016, by Michael Wetter:<br/>\nChanged test in assertion from <code>dpFixed_nominal > -Modelica.Constants.small</code>\nto\n<code>dpFixed_nominal > -Modelica.Constants.eps</code>.\nOtherwise, JModelica evaluates it as <code>true</code> in\n<a href=\\\"modelica://Buildings.Fluid.Actuators.Valves.Examples.TwoWayValves\\\">\nBuildings.Fluid.Actuators.Valves.Examples.TwoWayValves</a>.\nSee also\n<a href=\\\"https://trac.jmodelica.org/ticket/4932\\\">https://trac.jmodelica.org/ticket/4932</a>.\nThis is for\n<a href=\\\"https://github.com/lbl-srg/modelica-buildings/issues/510\\\">Buildings, issue 510</a>.\n</li>\n<li>\nJanuary 22, 2016, by Michael Wetter:<br/>\nCorrected type declaration of pressure difference.\nThis is\nfor <a href=\\\"https://github.com/ibpsa/modelica-ibpsa/issues/404\\\">#404</a>.\n</li>\n<li>\nJanuary 29, 2015, by Filip Jorissen:<br/>\nMoved the governing equations to\n<a href=\\\"modelica://Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValveKv\\\">\nPartialTwoWayValveKv</a>\nin order to be able to extend from this partial in\n<a href=\\\"modelica://Buildings.Fluid.Actuators.Valves.TwoWayPressureIndependent\\\">\nTwoWayPressureIndependent</a>\n</li>\n<li>\nAugust 8, 2014, by Michael Wetter:<br/>\nReformulated the computation of <code>k</code> to make the model\nwork in OpenModelica.\n</li>\n<li>\nApril 4, 2014, by Michael Wetter:<br/>\nAdded keyword <code>input</code> to variable <code>phi</code>\nto require models that extend this model to provide a binding equation.\nThis is done to use the same modeling concept as is used for example in\n<a href=\\\"modelica://Buildings.Fluid.Interfaces.StaticTwoPortHeatMassExchanger\\\">\nBuildings.Fluid.Interfaces.StaticTwoPortHeatMassExchanger</a>.\n</li>\n<li>\nMarch 27, 2014 by Michael Wetter:<br/>\nRevised model for implementation of new valve model that computes the flow function\nbased on a table.\n</li>\n<li>\nMarch 20, 2013, by Michael Wetter:<br/>\nSet <code>dp(nominal=6000)</code> as the previous formulation gives an error during model check\nin Dymola 2014. The reason is that the previous formulation used <code>dpValve_nominal</code>, which\nis not known at translation time.\n</li>\n<li>\nFebruary 28, 2013, by Michael Wetter:<br/>\nReformulated assignment of parameters.\nRemoved default value for <code>dpValve_nominal</code>, as this\nparameter has the attribute <code>fixed=false</code> for some values\nof <code>CvData</code>. In this case, assigning a value is not allowed.\nChanged assignment of nominal attribute of <code>dp</code> to avoid assigning\na non-literal value.\n</li>\n<li>\nFebruary 20, 2012 by Michael Wetter:<br/>\nRenamed parameter <code>dp_nominal</code> to <code>dpValve_nominal</code>,\nand added new parameter <code>dpFixed_nominal</code>.\nSee\n<a href=\\\"modelica://Buildings.Fluid.Actuators.UsersGuide\\\">\nBuildings.Fluid.Actuators.UsersGuide</a>.\n</li>\n<li>\nJanuary 16, 2012 by Michael Wetter:<br/>\nTo simplify object inheritance tree, revised base classes\n<code>Buildings.Fluid.BaseClasses.PartialResistance</code>,\n<code>Buildings.Fluid.Actuators.BaseClasses.PartialTwoWayValve</code>,\n<code>Buildings.Fluid.Actuators.BaseClasses.PartialDamperExponential</code>,\n<code>Buildings.Fluid.Actuators.BaseClasses.PartialActuator</code>\nand model\n<code>Buildings.Fluid.FixedResistances.PressureDrop</code>.\n</li>\n<li>\nAugust 12, 2011 by Michael Wetter:<br/>\nAdded <code>assert</code> statement to prevent <code>l=0</code> due to the\nimplementation of\n<a href=\\\"modelica://Buildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_m_flow\\\">\nBuildings.Fluid.BaseClasses.FlowModels.basicFlowFunction_m_flow</a>.\n</li>\n<li>\nApril 4, 2011 by Michael Wetter:<br/>\nRevised implementation to use new base class for actuators.\n</li>\n<li>\nFebruary 18, 2009 by Michael Wetter:<br/>\nImplemented parameterization of flow coefficient as in\n<code>Modelica.Fluid</code>.\n</li>\n<li>\nAugust 15, 2008 by Michael Wetter:<br/>\nSet valve leakage to nonzero value.\n</li>\n<li>\nJune 3, 2008 by Michael Wetter:<br/>\nFirst implementation.\n</li>\n</ul>\n</html>\""
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            ]
          }
        }
      }
    }
  ],
  "modelicaFile": "Buildings/Fluid/Actuators/BaseClasses/PartialTwoWayValve.mo",
  "fullMoFilePath": "/home/reituag/gitrepo/modelica-buildings/Buildings/Fluid/Actuators/BaseClasses/PartialTwoWayValve.mo",
  "checksum": "693b1d71a18b71ed6b67d9c546a14288"
}