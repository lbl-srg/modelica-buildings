<HTML>
<HEAD>
<TITLE>Buildings.Controls.SetPoints</TITLE>
<META name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META name="description" content="&quot;Package with models for control set points&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- --- header ------ -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- --- end header -- -->
</P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE SetPoints<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Controls.SetPoints"></A><A HREF="Buildings_Controls.html#Buildings.Controls"
>Buildings.Controls</A>.SetPoints</H2>
<B>Package with models for control set points</B>
<P></P>
<P></P><H3>Information</H3>

This package contains components models to compute set points of control systems.
For additional models, see also 
<A HREF="../../msl/3.2/help/Modelica_Blocks_Continuous.html#Modelica.Blocks.Continuous"
>
Modelica.Blocks.Continuous</a>.
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons_VariantsPackage.html#Modelica.Icons.VariantsPackage"
>Modelica.Icons.VariantsPackage</A> (Icon for package containing variants).
<P></P><H3>Package Content</H3>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Buildings.Controls.SetPoi004acb778f1ba78aResetS.png" ALT="Buildings.Controls.SetPoints.HotWaterTemperatureReset" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.HotWaterTemperatureReset"
>HotWaterTemperatureReset</A>
</TD><TD>Block to compute the supply and return set point of heating systems</TD></TR>
<TR><TD><IMG SRC="Buildings.Controls.SetPoia9379402f2a3200eeduleS.png" ALT="Buildings.Controls.SetPoints.OccupancySchedule" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.OccupancySchedule"
>OccupancySchedule</A>
</TD><TD>Occupancy schedule with look-ahead</TD></TR>
<TR><TD><IMG SRC="Buildings.Controls.SetPoints.TableS.png" ALT="Buildings.Controls.SetPoints.Table" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.Table"
>Table</A>
</TD><TD>Model for a set point that is interpolated based on a user-specified table</TD></TR>
<TR><TD><IMG SRC="Buildings.Controls.SetPoints.ExamplesS.png" ALT="Buildings.Controls.SetPoints.Examples" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Controls_SetPoints_Examples.html#Buildings.Controls.SetPoints.Examples"
>Examples</A>
</TD><TD>Collection of models that illustrate model use and test models</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE HotWaterTemperatureReset<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Controls.SetPoi004acb778f1ba78aResetI.png" ALT="Buildings.Controls.SetPoints.HotWaterTemperatureReset" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Controls.SetPoints.HotWaterTemperatureReset"></A><A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints"
>Buildings.Controls.SetPoints</A>.HotWaterTemperatureReset</H2>
<B>Block to compute the supply and return set point of heating systems</B><p></P>
<IMG SRC="Buildings.Controls.SetPoi004acb778f1ba78aResetD.png" ALT="Buildings.Controls.SetPoints.HotWaterTemperatureReset">
<P></P><H3>Information</H3>

<p>
This block computes the set point temperatures for the
supply and return temperature of a heating system.
The set point for the room air temperature can either be specified
by a parameter, or it can be an input to the model. The latter allows
to use this model with systems that have night set back.
</p>
<p>
The parameter <code>dTOutHeaBal</code> can be used to shift the heating curve 
to take into account that heat gains from solar, equipment and people 
make up for some of the transmission losses. 
For example, in energy efficient houses, the heating may not be switched on if
the outside air temperature is greater than
<i>12</i>&deg;C, even if a room temperature of <i>20</i>&deg;C is required.
In such a situation, set <code>dTOutHeaBal=20-12=8</code> Kelvin to 
shift the heating curve.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BlockIcon"
>Modelica.Blocks.Interfaces.BlockIcon</A> (Basic graphical layout of input/output block).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>m</TD><TD>1.3</TD><TD>Exponent for heat transfer</TD></TR>
<TR><TD>Boolean</TD><TD>use_TRoo_in</TD><TD>false</TD><TD>Get the room temperature set point from the input connector</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRoo</TD><TD>293.15</TD><TD>Fixed value of room temperature set point [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.TemperatureDifference"
>TemperatureDifference</A></TD><TD>dTOutHeaBal</TD><TD>8</TD><TD>Offset for heating curve [K]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal conditions</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TSup_nominal</TD><TD>&nbsp;</TD><TD>Supply temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRet_nominal</TD><TD>&nbsp;</TD><TD>Return temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRoo_nominal</TD><TD>293.15</TD><TD>Room temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TOut_nominal</TD><TD>&nbsp;</TD><TD>Outside temperature [K]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>TRoo_in</TD><TD>Room air temperature set point [K]</TD></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>TOut</TD><TD>Outside temperature [K]</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>TSup</TD><TD>Setpoint for supply temperature [K]</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>TRet</TD><TD>Setpoint for return temperature [K]</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> HotWaterTemperatureReset <font color="darkgreen">
  &quot;Block to compute the supply and return set point of heating systems&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BlockIcon"
>Modelica.Blocks.Interfaces.BlockIcon</A>;

  <font color="blue">parameter </font>Real m = 1.3 <font color="darkgreen">&quot;Exponent for heat transfer&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TSup_nominal <font color="darkgreen">&quot;Supply temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRet_nominal <font color="darkgreen">&quot;Return temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRoo_nominal = 293.15 <font color="darkgreen">
    &quot;Room temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TOut_nominal <font color="darkgreen">&quot;Outside temperature&quot;</font>;

  <font color="blue">parameter </font>Boolean use_TRoo_in = false <font color="darkgreen">
    &quot;Get the room temperature set point from the input connector&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRoo = 293.15 <font color="darkgreen">
    &quot;Fixed value of room temperature set point&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.TemperatureDifference"
>Modelica.SIunits.TemperatureDifference</A> dTOutHeaBal(displayUnit=&quot;K&quot;) = 8 <font color="darkgreen">
    &quot;Offset for heating curve&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> TRoo_in(<font color="blue">final </font>quantity=&quot;ThermodynamicTemperature&quot;,
                                               <font color="blue">final </font>unit = &quot;K&quot;, displayUnit = &quot;degC&quot;, min=0) <font color="blue">if </font>
          use_TRoo_in <font color="darkgreen">&quot;Room air temperature set point&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> TOut(<font color="blue">final </font>quantity=&quot;ThermodynamicTemperature&quot;,
                                            <font color="blue">final </font>unit = &quot;K&quot;, displayUnit = &quot;degC&quot;, min=0) <font color="darkgreen">
    &quot;Outside temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> TSup(<font color="blue">final </font>quantity=&quot;ThermodynamicTemperature&quot;,
                                            <font color="blue">final </font>unit = &quot;K&quot;, displayUnit = &quot;degC&quot;, min=0) <font color="darkgreen">
    &quot;Setpoint for supply temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> TRet(<font color="blue">final </font>quantity=&quot;ThermodynamicTemperature&quot;,
                                            <font color="blue">final </font>unit = &quot;K&quot;, displayUnit = &quot;degC&quot;, min=0) <font color="darkgreen">
    &quot;Setpoint for return temperature&quot;</font>;</textblock>

<font color="blue">protected </font>
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> TRoo_in_internal(<font color="blue">final </font>quantity=&quot;ThermodynamicTemperature&quot;,
                                                        <font color="blue">final </font>unit = &quot;K&quot;, displayUnit = &quot;degC&quot;, min=0) <font color="darkgreen">
    &quot;Needed to connect to conditional connector&quot;</font>;
  Real qRel <font color="darkgreen">&quot;Relative heating load = Q_flow/Q_flow_nominal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TOutOffSet <font color="darkgreen">
    &quot;Effective outside temperature for heat transfer (takes into account room heat gains)&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TOutOffSet_nominal =  TOut_nominal + dTOutHeaBal <font color="darkgreen">
    &quot;Effective outside temperature for heat transfer at nominal conditions (takes into account room heat gains)&quot;</font>;

<font color="blue">equation </font>
  <font color="red">connect</font>(TRoo_in, TRoo_in_internal);
  <font color="blue">if </font><font color="blue">not </font>use_TRoo_in<font color="blue"> then</font>
    TRoo_in_internal = TRoo;
  <font color="blue">end if</font>;
 TOutOffSet = TOut + dTOutHeaBal;
 <font color="darkgreen">// Relative heating load, compared to nominal conditions</font>
 qRel =<font color="red"> max</font>(0, (TRoo_in_internal-TOutOffSet)/(TRoo_nominal-TOutOffSet_nominal));
 TSup = TRoo_in_internal
          + ((TSup_nominal+TRet_nominal)/2-TRoo_nominal) * qRel^(1/m)
          + (TSup_nominal-TRet_nominal)/2 * qRel;
 TRet = TSup - qRel * (TSup_nominal-TRet_nominal);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>HotWaterTemperatureReset;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE OccupancySchedule<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Controls.SetPoia9379402f2a3200eeduleI.png" ALT="Buildings.Controls.SetPoints.OccupancySchedule" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Controls.SetPoints.OccupancySchedule"></A><A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints"
>Buildings.Controls.SetPoints</A>.OccupancySchedule</H2>
<B>Occupancy schedule with look-ahead</B><p></P>
<IMG SRC="Buildings.Controls.SetPoia9379402f2a3200eeduleD.png" ALT="Buildings.Controls.SetPoints.OccupancySchedule">
<P></P><H3>Information</H3>

<p>
This model outputs whether the building is currently occupied,
and how long it will take until the next time when the building 
will be occupied or non-occupied.
The latter may be used, for example, to start a ventilation system
half an hour before occupancy starts in order to ventilate the room.
</p>
<p>
The occupancy is defined by a time schedule of the form
</p>
<pre>
  occupancy = 3600*{7, 12, 14, 19}
</pre>
<p>
This indicates that the occupancy is from <i>7:00</i> until <i>12:00</i>
and from <i>14:00</i> to <i>19:00</i>. This will be repeated periodically.
The parameter <code>periodicity</code> defines the periodicity.
The period always starts at <i>t=0</i> seconds.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BlockIcon"
>Modelica.Blocks.Interfaces.BlockIcon</A> (Basic graphical layout of input/output block).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>occupancy[:]</TD><TD>3600*{7,19}</TD><TD>Occupancy table, each entry switching occupancy on or off</TD></TR>
<TR><TD>Boolean</TD><TD>firstEntryOccupied</TD><TD>true</TD><TD>Set to true if first entry in occupancy denotes a changed from unoccupied to occupied</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>period</TD><TD>86400</TD><TD>End time of periodicity [s]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>tNexNonOcc</TD><TD>Time until next non-occupancy</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>tNexOcc</TD><TD>Time until next occupancy</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BooleanOutput"
>BooleanOutput</A></TD><TD>occupied</TD><TD>Outputs true if occupied at current time</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> OccupancySchedule <font color="darkgreen">&quot;Occupancy schedule with look-ahead&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BlockIcon"
>Modelica.Blocks.Interfaces.BlockIcon</A>;

  <font color="blue">parameter </font>Real occupancy[:]=3600*{7, 19} <font color="darkgreen">
    &quot;Occupancy table, each entry switching occupancy on or off&quot;</font>;
  <font color="blue">parameter </font>Boolean firstEntryOccupied = true <font color="darkgreen">
    &quot;Set to true if first entry in occupancy denotes a changed from unoccupied to occupied&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> period =   86400 <font color="darkgreen">&quot;End time of periodicity&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> tNexNonOcc <font color="darkgreen">
    &quot;Time until next non-occupancy&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> tNexOcc <font color="darkgreen">&quot;Time until next occupancy&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BooleanOutput"
>Modelica.Blocks.Interfaces.BooleanOutput</A> occupied <font color="darkgreen">
    &quot;Outputs true if occupied at current time&quot;</font>;</textblock>

<font color="blue">protected </font>
  <font color="blue">final </font><font color="blue">parameter </font>Integer nRow =<font color="red"> size</font>(occupancy,1) <font color="darkgreen">
    &quot;Number of rows in the schedule&quot;</font>;

  <font color="blue">output </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> offSet=<font color="red">integer</font>(time/period)*period <font color="darkgreen">
    &quot;Time off-set, in multiples of period, that is used to switch the time when doing the table lookup&quot;</font>;
  <font color="blue">output </font>Integer nexStaInd <font color="darkgreen">&quot;Next index when occupancy starts&quot;</font>;
  <font color="blue">output </font>Integer nexStoInd <font color="darkgreen">&quot;Next index when occupancy stops&quot;</font>;

  <font color="blue">output </font>Integer iPerSta <font color="darkgreen">
    &quot;Counter for the period in which the next occupancy starts&quot;</font>;
  <font color="blue">output </font>Integer iPerSto <font color="darkgreen">
    &quot;Counter for the period in which the next occupancy stops&quot;</font>;

  <font color="blue">output </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> tOcc <font color="darkgreen">&quot;Time when next occupancy starts&quot;</font>;
  <font color="blue">output </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> tNonOcc <font color="darkgreen">&quot;Time when next non-occupancy starts&quot;</font>;

<textblock type="model" expanded="false" path="Buildings.Controls.SetPoints.OccupancySchedule.switchInteger"><font color="blue">encapsulated </font><font color="blue">function</font> switchInteger
  <font color="blue">input </font>Integer x1;
  <font color="blue">input </font>Integer x2;
  <font color="blue">output </font>Integer y1;
  <font color="blue">output </font>Integer y2;
<font color="blue">algorithm </font>
  y1:=x2;
  y2:=x1;
<font color="blue">end </font>switchInteger</textblock>;

<textblock type="model" expanded="false" path="Buildings.Controls.SetPoints.OccupancySchedule.switchReal"><font color="blue">encapsulated </font><font color="blue">function</font> switchReal
  <font color="blue">input </font>Real x1;
  <font color="blue">input </font>Real x2;
  <font color="blue">output </font>Real y1;
  <font color="blue">output </font>Real y2;
<font color="blue">algorithm </font>
  y1:=x2;
  y2:=x1;
<font color="blue">end </font>switchReal</textblock>;

<font color="blue">initial </font><font color="blue">algorithm </font>
  <font color="darkgreen">// Check parameters for correctness</font>
 <font color="red">assert</font>(<font color="red">mod</font>(nRow, 2) &lt; 0.1,
   &quot;The parameter \&quot;occupancy\&quot; must have an even number of elements.\n&quot;);
 <font color="red">assert</font>(0 &lt; occupancy[1],
   &quot;The first element of \&quot;occupancy\&quot; must be bigger than zero.&quot;
   + &quot;\n   Received occupancy[1] = &quot; +<font color="red"> String</font>(occupancy[1]));
 <font color="red">assert</font>(period &gt; occupancy[nRow],
   &quot;The parameter \&quot;period\&quot; must be greater than the last element of \&quot;occupancy\&quot;.&quot;
   + &quot;\n   Received period      = &quot; +<font color="red"> String</font>(period)
   + &quot;\n            occupancy[&quot; +<font color="red"> String</font>(nRow) +
     &quot;] = &quot; +<font color="red"> String</font>(occupancy[nRow]));
  <font color="blue">for </font>i<font color="blue"> in </font>1:nRow-1<font color="blue"> loop</font>
    <font color="red">assert</font>(occupancy[i] &lt; occupancy[i+1],
      &quot;The elements of the parameter \&quot;occupancy\&quot; must be strictly increasing.&quot;);
  <font color="blue">end for</font>;

 <font color="darkgreen">// Initialize variables</font>
 iPerSta   :=<font color="red"> integer</font>(time/period);
 iPerSto   := iPerSta;

 <font color="darkgreen">// First, assume that the first entry is occupied</font>
 nexStaInd := 1;
 nexStoInd := 2;
 <font color="darkgreen">// nRow is an even number</font>
 <font color="blue">for </font>i<font color="blue"> in </font>1:2:nRow-1<font color="blue"> loop</font>
   <font color="blue">if </font>time &gt;= occupancy[i] + iPerSta*period<font color="blue"> then</font>
     nexStaInd := i+2;
   <font color="blue">end if</font>;
 <font color="blue">end for</font>;
 <font color="blue">for </font>i<font color="blue"> in </font>2:2:nRow<font color="blue"> loop</font>
   <font color="blue">if </font>time &gt;= occupancy[i] + iPerSto*period<font color="blue"> then</font>
     nexStoInd := i+2;
   <font color="blue">end if</font>;
 <font color="blue">end for</font>;
 <font color="blue">if </font>nexStaInd &gt; nRow<font color="blue"> then</font>
    nexStaInd := 1;
    iPerSta :=iPerSta + 1;
 <font color="blue">end if</font>;
 <font color="blue">if </font>nexStoInd &gt; nRow<font color="blue"> then</font>
    nexStoInd := 2;
    iPerSto :=iPerSto + 1;
 <font color="blue">end if</font>;
 tOcc    := occupancy[nexStaInd]+iPerSta*period;
 tNonOcc := occupancy[nexStoInd]+iPerSto*period;
 occupied := tNonOcc &lt; tOcc;

 <font color="darkgreen">// Now, correct if the first entry is vaccant instead of occupied</font>
 <font color="blue">if </font><font color="blue">not </font>firstEntryOccupied<font color="blue"> then</font>
   (nexStaInd, nexStoInd) :=<font color="red"> switchInteger</font>(nexStaInd, nexStoInd);
   (iPerSta, iPerSto)     :=<font color="red"> switchInteger</font>(iPerSta,   iPerSto);
   (tOcc, tNonOcc)        :=<font color="red"> switchReal</font>(tOcc,      tNonOcc);
   occupied := <font color="blue">not </font>occupied;
 <font color="blue">end if</font>;

<font color="blue">algorithm </font>
  <font color="blue">when </font>time &gt;=<font color="red"> pre</font>(tOcc)<font color="blue"> then</font>
    nexStaInd :=nexStaInd + 2;
    occupied := <font color="blue">not </font>occupied;
    <font color="darkgreen">// Wrap index around</font>
    <font color="blue">if </font>nexStaInd &gt; nRow<font color="blue"> then</font>
       nexStaInd := <font color="blue">if </font>firstEntryOccupied<font color="blue"> then </font>1<font color="blue"> else </font>2;
       iPerSta :=iPerSta + 1;
    <font color="blue">end if</font>;
    tOcc := occupancy[nexStaInd] + iPerSta*period;
  <font color="blue">end when</font>;

  <font color="darkgreen">// Changed the index that computes the time until the next non-occupancy</font>
  <font color="blue">when </font>time &gt;=<font color="red"> pre</font>(tNonOcc)<font color="blue"> then</font>
    nexStoInd :=nexStoInd + 2;
    occupied := <font color="blue">not </font>occupied;
    <font color="darkgreen">// Wrap index around</font>
    <font color="blue">if </font>nexStoInd &gt; nRow<font color="blue"> then</font>
       nexStoInd := <font color="blue">if </font>firstEntryOccupied<font color="blue"> then </font>2<font color="blue"> else </font>1;
       iPerSto :=iPerSto + 1;
    <font color="blue">end if</font>;
    tNonOcc := occupancy[nexStoInd] + iPerSto*period;
  <font color="blue">end when</font>;

 tNexOcc    := tOcc-time;
 tNexNonOcc := tNonOcc-time;
 <font color="red">assert</font>(tNexOcc &gt; -1e-3<font color="blue"> and </font>tNexOcc &lt; period+1E-3, &quot;tNexOcc must be non-zero and smaller than period.
   Received tNexOcc = &quot; +<font color="red"> String</font>(tNexOcc));
 <font color="red">assert</font>(tNexNonOcc &gt; -1e-3<font color="blue"> and </font>tNexOcc &lt; period+1E-3, &quot;tNexNonOcc must be non-zero and smaller than period.
   Received tNexNonOcc = &quot; +<font color="red"> String</font>(tNexNonOcc));

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>OccupancySchedule;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Table<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Controls.SetPoints.TableI.png" ALT="Buildings.Controls.SetPoints.Table" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Controls.SetPoints.Table"></A><A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints"
>Buildings.Controls.SetPoints</A>.Table</H2>
<B>Model for a set point that is interpolated based on a user-specified table</B><p></P>
<IMG SRC="Buildings.Controls.SetPoints.TableD.png" ALT="Buildings.Controls.SetPoints.Table">
<P></P><H3>Information</H3>

<p>
This block can be used to schedule a set-point by using piecewise linear functions.
For example, the instances
</p>
<pre>
Buildings.Controls.SetPoints.Table tabLinExt(constantExtrapolation=false, 
                                             table=[20, 0.0; 
                                                    22, 0.5; 
                                                    25, 0.5; 
                                                    26, 1.0]);
Buildings.Controls.SetPoints.Table tabConExt(constantExtrapolation=true, 
                                             table=[20, 0.0; 
                                                    22, 0.5; 
                                                    25, 0.5; 
                                                    26, 1.0]);
</pre>
<p>
will cause the following output:
</p>
<p>
<img src="../Resources/Images/Controls/SetPoints/Table.png" border="1" alt="Table output."/>
</p>
<p>
For the default setting <code>constantExtrapolation=true</code>, the
block outputs 
<code>y=y1+offset</code> for <code>u &le; u1</code>, and 
<code>y=yMax+offset</code> for <code>u &ge; uMax</code>.
Otherwise, the table is linearly extrapolated with a constant derivative.
</p>
<p>
Note that the first column must be strictly increasing.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.SISO"
>Modelica.Blocks.Interfaces.SISO</A> (Single Input Single Output continuous control block).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>table[:, 2]</TD><TD>fill(0.0, 1, 2)</TD><TD>Table matrix ( e.g., table=[u1, y1; u2, y2; u3, y3])</TD></TR>
<TR><TD>Real</TD><TD>offset</TD><TD>0</TD><TD>Offset of output signal</TD></TR>
<TR><TD>Boolean</TD><TD>constantExtrapolation</TD><TD>true</TD><TD>If true, then y=y1 for u&lt;u1, and y=yMax for u&gt;uMax</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u</TD><TD>Connector of Real input signal</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>Connector of Real output signal</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> Table <font color="darkgreen">
  &quot;Model for a set point that is interpolated based on a user-specified table&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.SISO"
>Modelica.Blocks.Interfaces.SISO</A>;
  <font color="blue">parameter </font>Real table[:,2]=<font color="red">fill</font>(0.0, 1, 2) <font color="darkgreen">
    &quot;Table matrix ( e.g., table=[u1, y1; u2, y2; u3, y3])&quot;</font>;

  <font color="blue">parameter </font>Real offset=0 <font color="darkgreen">&quot;Offset of output signal&quot;</font>;

  <font color="blue">parameter </font>Boolean constantExtrapolation = true <font color="darkgreen">
    &quot;If true, then y=y1 for u&lt;u1, and y=yMax for u&gt;uMax&quot;</font>;

<font color="blue">protected </font>
  <font color="blue">final </font><font color="blue">parameter </font>Integer nCol = <font color="blue">if </font>constantExtrapolation<font color="blue"> then </font>
                        <font color="red">size</font>(table,1)+2<font color="blue"> else </font>
                        <font color="red">size</font>(table,1) <font color="darkgreen">&quot;Number of columns&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font>Real[nCol,2] offsetVector = [<font color="red">zeros</font>(nCol), offset*<font color="red">ones</font>(nCol)] <font color="darkgreen">
    &quot;Vector to take offset of output signal into account&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Tables.html#Modelica.Blocks.Tables.CombiTable1D"
>Modelica.Blocks.Tables.CombiTable1D</A> tab(
    tableOnFile=false,
    <font color="blue">final </font>table= (<font color="blue">if </font>constantExtrapolation<font color="blue"> then </font>
                    <font color="red">cat</font>(1, [table[1,1]-1, table[1,2]],
                           table,
                           [table[<font color="blue">end</font>,1]+1, table[<font color="blue">end</font>,2]])<font color="blue"> else </font>
                    table)
                  +offsetVector) <font color="darkgreen">&quot;Table used for interpolation&quot;</font>;</textblock>
<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(u, tab.u[1]);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(tab.y[1], y);</textblock>

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>Table;
</PRE>
<HR>
<address><a href="http://www.3ds.com/">Automatically generated</a> Thu Oct 24 15:08:05 2013.
</address></BODY>
</HTML>
