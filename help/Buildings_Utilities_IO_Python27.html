<HTML>
<HEAD>
<TITLE>Buildings.Utilities.IO.Python27</TITLE>
<META name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META name="description" content="&quot;Package to call Python functions&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- --- header ------ -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- --- end header -- -->
</P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Python27<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Utilities.IO.Python27"></A><A HREF="Buildings_Utilities_IO.html#Buildings.Utilities.IO"
>Buildings.Utilities.IO</A>.Python27</H2>
<B>Package to call Python functions</B>
<P></P>
<P></P><H3>Information</H3>

<p>
This package contains blocks and functions that embed Python 2.7 in Modelica.
Data can be sent to Python functions and received from Python functions.
This allows for example data analysis in Python as part of a Modelica model,
or data exchange as part of a hardware-in-the-loop simulation in which
Python is used to communicate with hardware.
</p>
<p>
See 
<A HREF="Buildings_Utilities_IO_Python27_UsersGuide.html#Buildings.Utilities.IO.Python27.UsersGuide"
>
Buildings.Utilities.IO.Python27.UsersGuide</a>
for instruction.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons_VariantsPackage.html#Modelica.Icons.VariantsPackage"
>Modelica.Icons.VariantsPackage</A> (Icon for package containing variants).
<P></P><H3>Package Content</H3>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.Py8af26f242b6fe46aGuideS.png" ALT="Buildings.Utilities.IO.Python27.UsersGuide" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_Python27_UsersGuide.html#Buildings.Utilities.IO.Python27.UsersGuide"
>UsersGuide</A>
</TD><TD>User&#39;s Guide</TD></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.Py68e929374791d999_RealS.png" ALT="Buildings.Utilities.IO.Python27.Real_Real" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_Python27.html#Buildings.Utilities.IO.Python27.Real_Real"
>Real_Real</A>
</TD><TD>Block that exchanges a vector of real values with a Python function</TD></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.Py7b98bbef9b3c64e5tionsS.png" ALT="Buildings.Utilities.IO.Python27.Functions" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_Python27_Functions.html#Buildings.Utilities.IO.Python27.Functions"
>Functions</A>
</TD><TD>Package with functions that call Python</TD></TR>
<TR><TD><IMG SRC="Buildings.Utilities.IO.Python27.ExamplesS.png" ALT="Buildings.Utilities.IO.Python27.Examples" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Utilities_IO_Python27_Examples.html#Buildings.Utilities.IO.Python27.Examples"
>Examples</A>
</TD><TD>Collection of models that illustrate model use and test models</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Real_Real<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Utilities.IO.Py68e929374791d999_RealI.png" ALT="Buildings.Utilities.IO.Python27.Real_Real" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Utilities.IO.Python27.Real_Real"></A><A HREF="Buildings_Utilities_IO_Python27.html#Buildings.Utilities.IO.Python27"
>Buildings.Utilities.IO.Python27</A>.Real_Real</H2>
<B>Block that exchanges a vector of real values with a Python function</B><p></P>
<IMG SRC="Buildings.Utilities.IO.Py68e929374791d999_RealD.png" ALT="Buildings.Utilities.IO.Python27.Real_Real">
<P></P><H3>Information</H3>

Block that exchanges data with a Python function.<br/>
<p>
For each element in the input vector <code>uR[nDblWri]</code>, 
the value of the flag <code>flaDblWri[nDblWri]</code> determines whether
the current value, the average over the sampling interval or the integral
over the sampling interval is sent to Python. The following three options are allowed:
</p>
<br/>
<table summary="summary" border="1" cellspacing=0 cellpadding=2 style="border-collapse:collapse;">
<tr>
<td>
flaDblWri[i]
</td>
<td>
Value sent to Python
</td>
</tr>
<tr>
<td>
0
</td>
<td>
Current value of uR[i]
</td>
</tr>
<tr>
<td>
1
</td>
<td>
Average value of uR[i] over the sampling interval
</td>
</tr>
<tr>
<td>
2
</td>
<td>
Integral of uR[i] over the sampling interval
</td>
</tr>
</table>
<br/>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.DiscreteBlock"
>Modelica.Blocks.Interfaces.DiscreteBlock</A> (Base class of discrete control blocks).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>samplePeriod</TD><TD>&nbsp;</TD><TD>Sample period of component [s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>startTime</TD><TD>0</TD><TD>First sample time instant [s]</TD></TR>
<TR><TD>String</TD><TD>moduleName</TD><TD>&nbsp;</TD><TD>Name of the python module that contains the function</TD></TR>
<TR><TD>String</TD><TD>functionName</TD><TD>moduleName</TD><TD>Name of the python function</TD></TR>
<TR><TD>Integer</TD><TD>nDblWri</TD><TD>&nbsp;</TD><TD>Number of double values to write to Python</TD></TR>
<TR><TD>Integer</TD><TD>nDblRea</TD><TD>&nbsp;</TD><TD>Number of double values to be read from the Python</TD></TR>
<TR><TD>Integer</TD><TD>flaDblWri[nDblWri]</TD><TD>zeros(nDblWri)</TD><TD>Flag for double values (0: use current value, 1: use average over interval, 2: use integral over interval)</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>uR[nDblWri]</TD><TD>Real inputs to be sent to Python</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>yR[nDblRea]</TD><TD>Real outputs received from Python</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> Real_Real <font color="darkgreen">
  &quot;Block that exchanges a vector of real values with a Python function&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.DiscreteBlock"
>Modelica.Blocks.Interfaces.DiscreteBlock</A>(startTime=0);

  <font color="blue">parameter </font>String moduleName <font color="darkgreen">
    &quot;Name of the python module that contains the function&quot;</font>;
  <font color="blue">parameter </font>String functionName=moduleName <font color="darkgreen">&quot;Name of the python function&quot;</font>;

  <font color="blue">parameter </font>Integer nDblWri(min=1) <font color="darkgreen">&quot;Number of double values to write to Python&quot;</font>;
  <font color="blue">parameter </font>Integer nDblRea(min=1) <font color="darkgreen">
    &quot;Number of double values to be read from the Python&quot;</font>;
  <font color="blue">parameter </font>Integer flaDblWri[nDblWri] =<font color="red"> zeros</font>(nDblWri) <font color="darkgreen">
    &quot;Flag for double values (0: use current value, 1: use average over interval, 2: use integral over interval)&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> uR[nDblWri] <font color="darkgreen">
    &quot;Real inputs to be sent to Python&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> yR[nDblRea] <font color="darkgreen">
    &quot;Real outputs received from Python&quot;</font>;</textblock>

  Real uRInt[nDblWri] <font color="darkgreen">&quot;Value of integral&quot;</font>;
  Real uRIntPre[nDblWri] <font color="darkgreen">&quot;Value of integral at previous sampling instance&quot;</font>;
<font color="blue">public </font>
  Real uRWri[nDblWri] <font color="darkgreen">&quot;Value to be sent to Python&quot;</font>;
<font color="blue">initial </font><font color="blue">algorithm </font>
   uRInt    :=<font color="red"> zeros</font>(nDblWri);
   uRIntPre :=<font color="red"> zeros</font>(nDblWri);
   <font color="blue">for </font>i<font color="blue"> in </font>1:nDblWri<font color="blue"> loop</font>
    <font color="red"> assert</font>(flaDblWri[i]&gt;=0<font color="blue"> and </font>flaDblWri[i]&lt;=2,
        &quot;Parameter flaDblWri out of range for &quot; +<font color="red"> String</font>(i) + &quot;-th component.&quot;);
   <font color="blue">end for</font>;
<font color="blue">equation </font>
   <font color="blue">for </font>i<font color="blue"> in </font>1:nDblWri<font color="blue"> loop</font>
    <font color="red">  der</font>(uRInt[i]) = <font color="blue">if </font>(flaDblWri[i] &gt; 0)<font color="blue"> then </font>uR[i]<font color="blue"> else </font>0;
   <font color="blue">end for</font>;
<font color="blue">algorithm </font>
  <font color="blue">when </font>{sampleTrigger}<font color="blue"> then</font>
    <font color="darkgreen"> // Compute value that will be sent to Python</font>
     <font color="blue">for </font>i<font color="blue"> in </font>1:nDblWri<font color="blue"> loop</font>
       <font color="blue">if </font>(flaDblWri[i] == 0)<font color="blue"> then</font>
         uRWri[i] :=<font color="red">pre</font>(uR[i]);<font color="darkgreen">                 // Send the current value.</font>
       <font color="blue">else</font>
         uRWri[i] :=uRInt[i] - uRIntPre[i];<font color="darkgreen">     // Integral over the sampling interval</font>
         <font color="blue">if </font>(flaDblWri[i] == 1)<font color="blue"> then</font>
            uRWri[i] := uRWri[i]/samplePeriod;<font color="darkgreen">  // Average value over the sampling interval</font>
         <font color="blue">end if</font>;
       <font color="blue">end if</font>;
      <font color="blue">end for</font>;

    <font color="darkgreen">// Exchange data</font>
    yR :=<font color="red">Buildings.Utilities.IO.Python27.Functions.exchange</font>(
      moduleName=moduleName,
      functionName=functionName,
      dblWri=uRWri,
      intWri={0},
      nDblWri=nDblWri,
      nDblRea=nDblRea,
      nIntWri=0,
      nIntRea=0,
      nStrWri=0,
      strWri={&quot;&quot;});

    <font color="darkgreen">// Store current value of integral</font>
  uRIntPre:=uRInt;
  <font color="blue">end when</font>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>Real_Real;
</PRE>
<HR>
<address><a href="http://www.3ds.com/">Automatically generated</a> Thu Oct 24 15:13:43 2013.
</address></BODY>
</HTML>
