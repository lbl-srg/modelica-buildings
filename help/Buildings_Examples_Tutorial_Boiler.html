<HTML>
<HEAD>
<TITLE>Buildings.Examples.Tutorial.Boiler</TITLE>
<META name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META name="description" content="&quot;Package with example for how to build a model for boiler with a heating load&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- --- header ------ -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- --- end header -- -->
</P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Boiler<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Examples.Tutorial.Boiler"></A><A HREF="Buildings_Examples_Tutorial.html#Buildings.Examples.Tutorial"
>Buildings.Examples.Tutorial</A>.Boiler</H2>
<B>Package with example for how to build a model for boiler with a heating load</B>
<P></P>
<P></P><H3>Information</H3>

<p>
This package contains examples with step-by-step instructions for how to build 
a system model for a boiler with a heat load as shown in the figure below. 
The pressure drops of the individual flow branches and the temperatures correspond to design conditions.
The heating system shall be designed to provide <i>20</i> kW, which is the load
needed at <i>-10</i>&deg;C outdoor temperature.
This load already takes into account the heat required for air infiltration and
ventilation.
Using this load and the temperatures shown in the schematic drawing, 
the nominal mass flow rates of the individual flow branches should be computed.
From <i>8:00</i> to <i>18:00</i>, there is an internal heat gain of <i>4</i>kW,
which should not be accounted for when sizing the system.
</p>
<p>
The room volume is <i>180</i>m<sup>3</sup>.
To approximate the thermal storage effect of furniture and building constructions,
the heat capacity of the room should be increased by a factor of three.
(Modeling a detailed room heat transfer as implemented in 
<A HREF="Buildings_Rooms.html#Buildings.Rooms"
>
Buildings.Rooms</a> is out of scope for this tutorial.)
</p>
<p>
The space heating shall be switched on if the outdoor temperature is below
<i>16</i>&deg;C and the room temperature is below
<i>20</i>&deg;C.
It shall be switched off if either the outdoor temperature is above
<i>17</i>&deg;C or the room temperature is above
<i>21</i>&deg;C.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/schematics.png"/>
</p>
<p>
The model consists of
</p>
<ol>
<li>
a room with a heating load, approximated as steady-state heat transfer with the environment,
</li>
<li>
a heating loop with a constant bypass and a three-way valve, which is modulated to track the room temperature set point, and
</li>
<li>
a boiler loop with constant mass flow rate, boiler on/off control and control valve
to ensure a minimum return water temperature.
</li>
</ol>
<p>
To explain the implementation of this model, the model has been created in the following stages:
</p>
<ol>
<li>
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System1"
>
Buildings.Examples.Tutorial.Boiler.System1</a> 
implements the room model without any heating. 
</li>
<li>
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System2"
>
Buildings.Examples.Tutorial.Boiler.System2</a> 
adds a radiator that is fed with water at a constant temperature and flow rate.
The pump is switched on and off depending on the room temperature.
</li>
<li>
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System3"
>
Buildings.Examples.Tutorial.Boiler.System3</a>
adds the boiler circuit with open loop control for the boiler and the mixing valves.
</li>
<li>
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>
Buildings.Examples.Tutorial.Boiler.System4</a>
adds closed loop control for the boiler and the pumps.
</li>
<li>
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>
Buildings.Examples.Tutorial.Boiler.System5</a>
adds closed loop control for the two valves.
</li>
<li>
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System6"
>
Buildings.Examples.Tutorial.Boiler.System6</a>
replaces the constant outdoor temperature with weather data from a file,
and changes the valve control from P-control to PI-control.
</li>
<li>
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System7"
>
Buildings.Examples.Tutorial.Boiler.System7</a>
replaces the boiler and pump control using a state machine.
</li>
</ol>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons_ExamplesPackage.html#Modelica.Icons.ExamplesPackage"
>Modelica.Icons.ExamplesPackage</A> (Icon for packages containing runnable examples).
<P></P><H3>Package Content</H3>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" ALT="Buildings.Examples.Tutorial.Boiler.System1" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System1"
>System1</A>
</TD><TD>1st part of the system model, consisting of the room with heat transfer</TD></TR>
<TR><TD><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" ALT="Buildings.Examples.Tutorial.Boiler.System2" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System2"
>System2</A>
</TD><TD>2nd part of the system model, consisting of the room with heat transfer and a radiator</TD></TR>
<TR><TD><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" ALT="Buildings.Examples.Tutorial.Boiler.System3" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System3"
>System3</A>
</TD><TD>3rd part of the system model, which adds the boiler loop with open loop control</TD></TR>
<TR><TD><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" ALT="Buildings.Examples.Tutorial.Boiler.System4" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>System4</A>
</TD><TD>4th part of the system model, which adds closed-loop control for the pumps and the boiler</TD></TR>
<TR><TD><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" ALT="Buildings.Examples.Tutorial.Boiler.System5" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>System5</A>
</TD><TD>5th part of the system model, which adds closed-loop control for the valves</TD></TR>
<TR><TD><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" ALT="Buildings.Examples.Tutorial.Boiler.System6" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System6"
>System6</A>
</TD><TD>6th part of the system model, which adds weather data and changes to PI control</TD></TR>
<TR><TD><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" ALT="Buildings.Examples.Tutorial.Boiler.System7" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System7"
>System7</A>
</TD><TD>7th part of the system model, which implements the on/off control using a state machine</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE System1<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" ALT="Buildings.Examples.Tutorial.Boiler.System1" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Examples.Tutorial.Boiler.System1"></A><A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</A>.System1</H2>
<B>1st part of the system model, consisting of the room with heat transfer</B><p></P>
<IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1D.png" ALT="Buildings.Examples.Tutorial.Boiler.System1">
<P></P><H3>Information</H3>

<p>
This part of the system model implements the room with a heat gain.
The room is simplified as a volume of air, a prescribed heat source for
the internal convective heat gain, and a heat conductor for steady-state
heat conduction to the outside.
To increase the heat capacity of the room, such as due to heat stored
in furniture and in building constructions, the heat capacity
of the room air was increased by a factor of three.
The convective heat transfer coefficient is lumped into the heat conductor
model.
</p>
<h4>Implementation</h4>
<p>
This section describes step by step how we implemented the model.
</p>
<ol>
<li>
<p>
First, we dragged 
<A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid.System"
>
Modelica.Fluid.System</a> into the model and keep its name at
its default setting, which is <code>system</code>.
This model is required for all fluid flow models to set
global properties.
</p>
</li>
<li>
<p>
Next, to define the medium properties, we added the declaration
</p>
<pre>
  replaceable package MediumA =
      Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated;
</pre>
<p>
This will allow the propagation of the medium model to all models that contain air.
In this example, there is only one model with air.
</p>
<p>
We called the medium <code>MediumA</code> to distinguish it from
<code>MediumW</code> that we will use in later versions of the model for components that
have water as a medium. Because we do not anticipate saturated air, we used
the medium model
<A HREF="Buildings_Media_GasesPTDecoupled_MoistAirUnsaturated.html#Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated"
>
Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated</a>
instead of 
<A HREF="Buildings_Media_GasesPTDecoupled_MoistAir.html#Buildings.Media.GasesPTDecoupled.MoistAir"
>
Buildings.Media.GasesPTDecoupled.MoistAir</a>
as the latter is computationally more expensive.
Because in this model, we are not interested in air humidification or
dehumidification, we could have as well used the medium model
<A HREF="Buildings_Media_GasesPTDecoupled_SimpleAir.html#Buildings.Media.GasesPTDecoupled.SimpleAir"
>
Buildings.Media.GasesPTDecoupled.SimpleAir</a>.
</p>
<p>
We also defined the system-level parameters
</p>
<pre>
  parameter Modelica.SIunits.Volume V=6*10*3 "Room volume";
  parameter Modelica.SIunits.MassFlowRate mA_flow_nominal = V*6/3600
    "Nominal mass flow rate";
  parameter Modelica.SIunits.HeatFlowRate QRooInt_flow = 4000 
    "Internal heat gains of the room";
</pre>
<p>
to declare that the room volume is <i>180</i> m<sup>3</sup>, that the room
has a nominal mass flow rate of <i>6</i> air changes per hour and that 
the internal heat gains of the room are <i>4000</i> Watts.
These parameters have been declared at the top-level of the model
as they will be used in several other models.
Declaring them at the top-level allows to propagate them to other
models, and to easily change them at one location should this be required
when revising the model.
</p>
</li>
<li>
<p>
To model the room air, approximated as a completely mixed volume of air, 
an instance of
<A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>
Buildings.Fluid.MixingVolumes.MixingVolume</a>
has been used, as this model can be used with dry air or moist air.
The medium model has been set to <code>MediumA</code>, and the nominal mass
flow rate is set to <code>mA_flow_nominal</code>.
The nominal mass flow rate is used for numerical reasons and should be set 
to the approximate order of magnitude. It only has an effect if the mass flow
rate is near zero and what "near zero" means depends on the magnitude of
<code>m_flow_nominal</code>, as it is used for the default value of the parameter
<code>m_flow_small</code> on the <code>Assumptions</code> tag of the model.
See also 
<A HREF="Buildings_Fluid_UsersGuide.html#Buildings.Fluid.UsersGuide"
>
Buildings.Fluid.UsersGuide</a>
for an explanation of the purpose of <code>m_flow_small</code>.
</p>
</li>
<li>
<p>
Since we need to increase the heat capacity of the room air to approximate
energy storage in furniture and building constructions, we connected the instance <code>heaCap</code> of 
<A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>
Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a>
to the heat port of the room air.
The model <code>heaCap</code> models energy storage. We set its capacity to
<i>C=2*V*1.2*1006</i> J/K. This will increase the total heat capacity 
of the room air by a factor of three.
</p>
</li>
<li>
<p>
We used the instance <code>theCon</code> of
<A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>
Modelica.Thermal.HeatTransfer.Components.ThermalConductor</a> 
 to model the thermal conductance to the ambient.
Since our room should have a heat loss of <i>20</i> kW at a temperature difference
of <i>30</i> Kelvin, we set the conductance to 
<i>G=20000 &frasl; 30</i> W/K.
</p>
</li>
<li>
<p>
We used the instance <code>preHea</code> of 
<A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>
Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</a>
to model a prescribed heat gain, 
such as due to internal heat source.
This model outputs the heat gain which is equal to the value of its 
input signal, which is obtained from a time table.
</p>
</li>
<li>
<p>
To define a time-dependent heat gain, we instantiated the block
<A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>
Modelica.Blocks.Sources.CombiTimeTable</a>
and set its name to <code>timTab</code>.
We set the table parameters to
</p>
<pre>
Modelica.Blocks.Sources.CombiTimeTable timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic, 
      table=[      0, 0; 
              8*3600, 0; 
              8*3600, QRooInt_flow; 
             18*3600, QRooInt_flow; 
             18*3600, 0; 
             24*3600, 0]) "Time table for internal heat gain";
</pre>
<p>
Note that we set that the output is a periodic signal by configuring 
<code>
extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic.
</code>
The documentation of <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>
Modelica.Blocks.Sources.CombiTimeTable</a>
explains why we added two values for 8am and 6pm.
</p>
</li>
<li>
<p>
Next, we connected its output to the input of the instance <code>preHea</code>.
</p>
</li>
</ol>
<p>
This completes the initial version of the model. When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System1Temperatures.png" border="1"/>
</p>
<p>
To verify the correctness of the model, we can compare the simulated results to the
following analytical solutions:
</p>
<ol>
<li>
<p>
When the internal heat gain is zero, the room temperature should be equal 
to the outside temperature.
</p>
</li>
<li>
<p>
At steady-state when the internal heat gain is <i>4000</i> Watts,
the temperature difference to the outside should be
<i>&Delta; T = Q&#775; &frasl; UA = 4000/(20000/30) = 6</i> Kelvin, which 
corresponds to a room temperature of <i>-4</i>&deg;C.
</p>
</li>
</ol>
<p>
Both analytical values agree with the simulation results shown in the above figure.
</p>
<p>
An alternative validation can be done by fixing the temperature of the volume to
<i>20</i>&deg;C and plotting the heat flow rate that is needed to maintain
this temperature.
This can be implemented by connecting an instance of
<A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>
Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</a>
as shown below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System1PrescribedTemperature.png" border="1"/>
</p>
<p>
When plotting the heat flow rate <code>fixTemp.port.Q_flow</code>, one can see
that the required heat flow rate to keep the temperature at 
<i>20</i>&deg;C is 
<i>20</i> kW during night, and 
<i>16</i> kW during day when the heat gain is active.
</p>
<!-- Notes -->
<h4>Notes</h4>
<p>
For a more realistic model of a room, the model 
<A HREF="Buildings_Rooms.html#Buildings.Rooms.MixedAir"
>
Buildings.Rooms.MixedAir</a>
could have been used.
For transient heat conduction, models from the
package
<A HREF="Buildings_HeatTransfer_Conduction.html#Buildings.HeatTransfer.Conduction"
>
Buildings.HeatTransfer.Conduction</a>
could have been used.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A> (Icon for runnable examples).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>Buildings.Media.GasesPTDecou...</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V</TD><TD>6*10*3</TD><TD>Room volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mA_flow_nominal</TD><TD>V*6/3600</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>QRooInt_flow</TD><TD>4000</TD><TD>Internal heat gains of the room [W]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> System1 <font color="darkgreen">
  &quot;1st part of the system model, consisting of the room with heat transfer&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumA =
      <A HREF="Buildings_Media_GasesPTDecoupled_MoistAirUnsaturated.html#Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated"
>Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated</A>;

<textblock type="annotcomp" expanded="false">  <font color="blue">inner </font><A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid.System"
>Modelica.Fluid.System</A> system;
  <A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Fluid.MixingVolumes.MixingVolume</A> vol(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System1.MediumA"
>MediumA</A>,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A> theCon(G=20000/30) <font color="darkgreen">
    &quot;Thermal conductance with the ambient&quot;</font>;</textblock>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> V=6*10*3 <font color="darkgreen">&quot;Room volume&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mA_flow_nominal = V*6/3600 <font color="darkgreen">
    &quot;Nominal mass flow rate&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> QRooInt_flow = 4000 <font color="darkgreen">
    &quot;Internal heat gains of the room&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</A> TOut(T=263.15) <font color="darkgreen">
    &quot;Outside temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</A> preHea <font color="darkgreen">
    &quot;Prescribed heat flow&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</A> heaCap(C=2*V*1.2*1006) <font color="darkgreen">
    &quot;Heat capacity for furniture and walls&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</A> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      table=[      0, 0;
              8*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, QRooInt_flow;
             18*3600, 0;
             24*3600, 0]) <font color="darkgreen">&quot;Time table for internal heat gain&quot;</font>;</textblock>
<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(TOut.port, theCon.port_a);
  <font color="red">connect</font>(theCon.port_b, vol.heatPort);
  <font color="red">connect</font>(preHea.port, vol.heatPort);
  <font color="red">connect</font>(heaCap.port, vol.heatPort);
  <font color="red">connect</font>(timTab.y[1], preHea.Q_flow);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>System1;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE System2<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" ALT="Buildings.Examples.Tutorial.Boiler.System2" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Examples.Tutorial.Boiler.System2"></A><A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</A>.System2</H2>
<B>2nd part of the system model, consisting of the room with heat transfer and a radiator</B><p></P>
<IMG SRC="Buildings.Examples.Tutori183681cc9fd28121stem2D.png" ALT="Buildings.Examples.Tutorial.Boiler.System2">
<P></P><H3>Information</H3>

<p>
This part of the system model adds a radiator with a prescribed mass flow
rate to the system that is implemented in
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System1"
>
Buildings.Examples.Tutorial.Boiler.System1</a>.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System1"
>
Buildings.Examples.Tutorial.Boiler.System1</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System2</code>.
</p>
</li>
<li>
<p>
Since this model uses water as the medium, we declared the water medium model
at the top-level of the model by adding the lines
</p>
<pre>
  replaceable package MediumW = 
      Buildings.Media.ConstantPropertyLiquidWater "Medium model";
</pre>
</li>
<li>
<p>
To model the pump, a temperature sensor which we will need later
for the control, and a flow sink, we made instances of the models
<A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>
Buildings.Fluid.Movers.FlowMachine_m_flow</a>
(instance <code>pumRad</code> for the pump that serves the radiators),
<A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>
Buildings.Fluid.Sensors.TemperatureTwoPort</a>
(instance <code>temSup</code>), 
<A HREF="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>
Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</a>
(instance <code>rad</code>), and
<A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>
Buildings.Fluid.Sources.FixedBoundary</a>
(instance <code>sou</code> and <code>sin</code> for the sink and source 
reservoirs, which will later be replace by the boiler loop).
</p>
<p>
In all of these instances, we set the medium model to <code>MediumW</code>.
We also made an instance of the model
Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor
(instance <code>temRoo</code>) to measure the room temperature.
We connected the model as shown in the figure below. 
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System2Connections.png" border="1"/>
</p>
<p>
Note that there are two connections from the
radiator to the room volume: 
One connection is for the convective heat flow rate, and the other is for the 
radiative heat flow rate. For simplicity, we assumed that the air and radiative
temperature of the room are equal.
Furthermore, we simplified the model by using only one radiator instead of multiple
radiators, although this radiator will be quite large as it needs to provide a 
heat flow rate of <i>20</i> kW.
</p>
</li>
<li>
<p>
Next, we computed the design mass flow rate for the radiator.
According to the schematic drawing, the radiator should have at
the design conditions a supply water temperature of 
<i>50</i>&deg;C and a return water temperature of
<i>40</i>&deg;C.
Thus, we define the radiator mass flow rate as
</p>
<pre>
  parameter Modelica.SIunits.HeatFlowRate Q_flow_nominal = 20000
    "Nominal heat flow rate of radiator";
  parameter Modelica.SIunits.Temperature TRadSup_nominal = 273.15+50 
    "Radiator nominal supply water temperature";
  parameter Modelica.SIunits.Temperature TRadRet_nominal = 273.15+40 
    "Radiator nominal return water temperature";
  parameter Modelica.SIunits.MassFlowRate mRad_flow_nominal = 
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal)
    "Radiator nominal mass flow rate";
</pre>
</li>
<li>
<p>
Now, we set the mass flow rate of <code>pumRad</code> and <code>temSup</code> to
<code>mRad_flow_nominal</code>.
We also set the temperature of the fluid that flows out of <code>sou</code>
to <code>TRadSup_nominal</code>.
We configured the parameters of the radiator model as
</p>
<pre>
  Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2 rad(
    redeclare package Medium = MediumW,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) "Radiator";
</pre>
<p>
We configured the parameters of the pump model as
</p>
<pre>
  Buildings.Fluid.Movers.FlowMachine_m_flow pumRad(
    m_flow_nominal=mRad_flow_nominal) 
    "Pump for radiator";
</pre>
</li>
<li>
<p>
To enable the pump when the room temperature is below 
<i>19</i>&deg;C and to switch it off when the room temperature
is below 
<i>21</i>&deg;C, 
we implemented the control blocks as shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System2PumpControl.png" border="1"/>
</p>
<p>
In this control sequence, the first block is a hysteresis element,
which is modeled by
<A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>
Modelica.Blocks.Logical.Hysteresis</a>. 
It is configured as
</p>
<pre>
  Modelica.Blocks.Logical.Hysteresis hysPum(
    uLow=273.15 + 19, 
    uHigh=273.15 + 21)
    "Pump hysteresis";
</pre>
<p>
to output <code>false</code> when the input signal falls below <i>19</i>&deg;C, and
<code>true</code> when the input signal raises above <i>21</i>&deg;C.
Next, we send the output to the instance <code>not1</code>, which outputs
</p>
<pre>
  y= not u
</pre>
<p>
to negate the signal.
The output of this signal is a boolean value, but the pump
input signal is the required mass flow rate.
Thus, we used the block
<A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>
Modelica.Blocks.Math.BooleanToReal</a> to convert the signal.
We set the parameters of the boolean to real converter as
</p>
<pre>
  Modelica.Blocks.Math.BooleanToReal booToReaRad(
        realTrue=mRad_flow_nominal, 
        realFalse=0) "Radiator pump signal";
</pre>
<p>
For numerical reasons, in particular in large system models, it is recommended to
continuously change the mass flow rate, as opposed to having a step change.
Therefore, 
in the instance <code>pumRad</code>, we leave the parameter
<code>filteredSpeed</code> at its default value <code>true</code>.
This will approximate a continuous change in mass flow rate when the
pump is switched on or off.
Finally, we closed the control loop between the room temperature sensor and the
pump input signal.
</p>
</li>
</ol>
<!-- ============================== -->
<p>
This completes the initial version of the model. When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System2Temperatures.png" border="1"/>
</p>
<p>
The figure shows that the room temperature is maintained at
<i>20</i>&deg;C when the internal heat gain is zero, and controlled around
<i>19</i>&deg;C to <i>21</i>&deg;C when there is an internal heat gain.
The temperature is slightly outside this temperature range because of the
time lag that is caused by the thermal capacity of the radiator.
</p>
<!-- Notes -->
<h4>Notes</h4>
<p>
For a more realistic model of a room, the model 
<A HREF="Buildings_Rooms.html#Buildings.Rooms.MixedAir"
>
Buildings.Rooms.MixedAir</a>
could have been used.
For transient heat conduction, models from the
package
<A HREF="Buildings_HeatTransfer_Conduction.html#Buildings.HeatTransfer.Conduction"
>
Buildings.HeatTransfer.Conduction</a>
could have been used.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A> (Icon for runnable examples).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>Buildings.Media.GasesPTDecou...</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Buildings.Media.ConstantProp...</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>Q_flow_nominal</TD><TD>20000</TD><TD>Nominal heat flow rate of radiator [W]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadSup_nominal</TD><TD>273.15 + 50</TD><TD>Radiator nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadRet_nominal</TD><TD>273.15 + 40</TD><TD>Radiator nominal return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRad_flow_nominal</TD><TD>Q_flow_nominal/4200/(TRadSup...</TD><TD>Radiator nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V</TD><TD>6*10*3</TD><TD>Room volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mA_flow_nominal</TD><TD>V*6/3600</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>QRooInt_flow</TD><TD>4000</TD><TD>Internal heat gains of the room [W]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Medium model</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> System2 <font color="darkgreen">
  &quot;2nd part of the system model, consisting of the room with heat transfer and a radiator&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumA =
      <A HREF="Buildings_Media_GasesPTDecoupled_MoistAirUnsaturated.html#Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated"
>Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated</A>;

<font color="darkgreen">//-------------------------Step 2: Water as medium-------------------------//</font>
  <font color="blue">replaceable </font><font color="blue">package</font> MediumW =
      <A HREF="Buildings_Media_ConstantPropertyLiquidWater.html#Buildings.Media.ConstantPropertyLiquidWater"
>Buildings.Media.ConstantPropertyLiquidWater</A> <font color="darkgreen">&quot;Medium model&quot;</font>;
<font color="darkgreen">//-------------------------------------------------------------------------//</font>

<font color="darkgreen">//------------------------Step 4: Design conditions------------------------//</font>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> Q_flow_nominal = 20000 <font color="darkgreen">
    &quot;Nominal heat flow rate of radiator&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadSup_nominal = 273.15+50 <font color="darkgreen">
    &quot;Radiator nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadRet_nominal = 273.15+40 <font color="darkgreen">
    &quot;Radiator nominal return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Radiator nominal mass flow rate&quot;</font>;
<font color="darkgreen">//------------------------------------------------------------------------//</font>

<textblock type="annotcomp" expanded="false">  <font color="blue">inner </font><A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid.System"
>Modelica.Fluid.System</A> system;
  <A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Fluid.MixingVolumes.MixingVolume</A> vol(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System2.MediumA"
>MediumA</A>,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A> theCon(G=20000/30) <font color="darkgreen">
    &quot;Thermal conductance with the ambient&quot;</font>;</textblock>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> V=6*10*3 <font color="darkgreen">&quot;Room volume&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mA_flow_nominal = V*6/3600 <font color="darkgreen">
    &quot;Nominal mass flow rate&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> QRooInt_flow = 4000 <font color="darkgreen">
    &quot;Internal heat gains of the room&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</A> TOut(T=263.15) <font color="darkgreen">
    &quot;Outside temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</A> preHea <font color="darkgreen">
    &quot;Prescribed heat flow&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</A> heaCap(C=2*V*1.2*1006) <font color="darkgreen">
    &quot;Heat capacity for furniture and walls&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</A> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      table=[      0, 0;
              8*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, QRooInt_flow;
             18*3600, 0;
             24*3600, 0]) <font color="darkgreen">&quot;Time table for internal heat gain&quot;</font>;</textblock>

<font color="darkgreen">//-------------------------Step 5: Radiator Model-------------------------//</font>
<textblock type="annotcomp" expanded="false"> <A HREF="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</A> rad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</A>,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <font color="darkgreen">&quot;Radiator&quot;</font>;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------//</font>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Fluid.Sources.FixedBoundary</A> sin(nPorts=1, <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</A>) <font color="darkgreen">
    &quot;Sink for mass flow rate&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Fluid.Sensors.TemperatureTwoPort</A> temSup(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</A>,
      m_flow_nominal=mRad_flow_nominal) <font color="darkgreen">&quot;Supply water temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> temRoo <font color="darkgreen">
    &quot;Room temperature&quot;</font>;</textblock>

<font color="darkgreen">//------------------------Step 5: Pump for radiator-----------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumRad(m_flow_nominal=mRad_flow_nominal,
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</A>) <font color="darkgreen">&quot;Pump for radiator&quot;</font>;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------//</font>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Fluid.Sources.FixedBoundary</A> sou(
    nPorts=1,
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</A>,
    T=TRadSup_nominal) <font color="darkgreen">&quot;Sink for mass flow rate&quot;</font>;</textblock>

<font color="darkgreen">//--------------------------Step 6: Pump control--------------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <font color="darkgreen">
    &quot;Pump hysteresis&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad(realTrue=mRad_flow_nominal) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not1 <font color="darkgreen">&quot;Negate output of hysteresis&quot;</font>;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------//</font>

<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(TOut.port, theCon.port_a);
  <font color="red">connect</font>(theCon.port_b, vol.heatPort);
  <font color="red">connect</font>(preHea.port, vol.heatPort);
  <font color="red">connect</font>(heaCap.port, vol.heatPort);
  <font color="red">connect</font>(timTab.y[1], preHea.Q_flow);
  <font color="red">connect</font>(temSup.port_b, rad.port_a);
  <font color="red">connect</font>(rad.port_b, sin.ports[1]);
  <font color="red">connect</font>(temRoo.port, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortCon, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortRad, vol.heatPort);
  <font color="red">connect</font>(sou.ports[1], pumRad.port_a);
  <font color="red">connect</font>(pumRad.port_b, temSup.port_a);
  <font color="red">connect</font>(temRoo.T, hysPum.u);
  <font color="red">connect</font>(hysPum.y, not1.u);
  <font color="red">connect</font>(not1.y, booToReaRad.u);
  <font color="red">connect</font>(booToReaRad.y, pumRad.m_flow_in);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>System2;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE System3<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" ALT="Buildings.Examples.Tutorial.Boiler.System3" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Examples.Tutorial.Boiler.System3"></A><A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</A>.System3</H2>
<B>3rd part of the system model, which adds the boiler loop with open loop control</B><p></P>
<IMG SRC="Buildings.Examples.Tutori183681cd9fd28120stem3D.png" ALT="Buildings.Examples.Tutorial.Boiler.System3">
<P></P><H3>Information</H3>

<p>
This part of the system model adds the boiler loop with
open loop control to the model that is implemented in
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System2"
>
Buildings.Examples.Tutorial.Boiler.System2</a>.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System2"
>
Buildings.Examples.Tutorial.Boiler.System2</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System3</code>.
</p>
</li>
<li>
<p>
Next, we deleted the sink and source models <code>sin</code> and <code>sou</code>,
as these will be replaced by the boiler loop.
</p>
</li>
<li>
<p>
We made various instances of 
<A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>
Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a>
to model flow splitter and mixers.
We also made an instance of 
<A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>
Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a>
to model the three-way valves, and
an instance of 
<A HREF="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>
Buildings.Fluid.Boilers.BoilerPolynomial</a>
to model the boiler.
</p>
<p>
Note that we also made an instance of 
<A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>
Buildings.Fluid.Sources.FixedBoundary</a>,
which we called <code>preSou</code>.
This is required to set a pressure reference in the water loop, which is a closed system.
For medium models that expand with increasing temperature,
this is also required to accumulate, and to feed back into the system,
the difference in mass due to the thermal expansion of water.
</p>
</li>
<li>
<p>
Next, we parameterized the medium of all these components by
setting it to <code>MediumW</code>.
</p>
<p>
Since the nominal mass flow rate for the 
boiler loop is required by several models, we introduced
the following system-level parameters, where
<code>TBoiRet_min</code> will be used to avoid 
condensation in the boiler:
</p>
<pre>
  parameter Modelica.SIunits.Temperature TBoiSup_nominal = 273.15+80 
    "Boiler nominal supply water temperature";
  parameter Modelica.SIunits.Temperature TBoiRet_min = 273.15+50 
    "Boiler minimum return water temperature";
  parameter Modelica.SIunits.MassFlowRate mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) 
    "Boiler nominal mass flow rate";
</pre>
</li>
</ol>
<p>
Next, we set the parameters of the individual component models.
</p>
<ol>
<li>
<p>
We lumped the pressure drop of the boiler loop into the boiler model
and hence set
</p>
<pre>
  Buildings.Fluid.Boilers.BoilerPolynomial boi(
    redeclare package Medium = MediumW,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue()) "Boiler";
</pre>
</li>
<li>
<p>
For the three-way valve in the radiator loop, we used the default pressure drop of
<i>6000</i> Pa.
For its mass flow rate, we introduced the parameter
</p>
<pre>
  parameter Modelica.SIunits.MassFlowRate mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) 
    "Radiator nominal mass flow rate";
</pre>
<p>
This allowed us to configure the valve as
</p>
<pre>
  Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear valRad(
    redeclare package Medium = MediumW,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) "Three-way valve for radiator loop"
</pre>
<p>
where <code>l={0.01,0.01}</code> is a valve leakage of 1%
and <code>dpValve_nominal=6000</code> is the pressure drop of the valve 
if it is fully open
and if the mass flow rate is equal to <code>m_flow_nominal</code>.
It is recommended to set the valve leakage to a non-zero value to avoid numerical problems.
A non-zero value also represent a more realistic situation, as most valves have some leakage.
</p>
</li>
<li>
<p>
For the bypass between the valve and the radiator, we note that the 
mass flow rate is equal to <code>mRad_flow_nomial - mRadVal_flow_nominal</code>.
This is a fixed bypass that is used to allow the valve to work across
its full range.
We decided to lump the pressure drop of this bypass, and the pressure drop of the
radiator loop, into the instance <code>mix</code>.
Hence, its parameters are
</p>
<pre>
  Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM mix(
    redeclare package Medium =MediumW,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) "Mixer between valve and radiators";
</pre>
<p>
Note the negative values, which are used for the ports where the medium is
outflowing at nominal conditions. 
See also the documentation of the model
<A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>
Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a>.
</p>
<p>
We also set the pressure drop of 
port 3 of <code>mix</code>
to the same value as the pressure drop of the valve in order
to balance the flows. In practice, this can be done by using a
balance valve, whose pressure drop we lumped into the component
<code>mix</code>.
</p>
</li>
<li>
<p>
Next, we set the pressure drops and flow rates of all flow splitters and mixers. 
For the flow splitters and mixers that are connected to another flow splitter or mixer which
already computes the pressure drop of the connecting flow leg, we set the nominal pressure drop
to zero. This will remove the equation for the pressure drop calculation.
However, we chose to still use the mixer and splitters to make sure that
we properly defined the mixing points in the system.
</p>
</li>
<li>
<p>
Next, we connected all fluid ports, and we set open-loop control signals
for the valves, pumps and boilers.
This is implemented using the block
<A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>
Modelica.Blocks.Sources.Constant</a>.
Using open-loop signals allows testing the model prior to 
adding the complexity of closed loop control.
To avoid that the boiler overheats, we set its control input to
<code>0.5</code>. Otherwise, the boiler temperature would raise quickly 
when the radiator pump is off, and the simulation would stop 
with an error message that says that its medium temperature is
outside the allowed range.
</p>
</li>
</ol>
<!-- ============================== -->
<p>
This completes the initial version of the model. When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System3Temperatures.png" border="1"/>
</p>
<p>
The figure shows that the room temperature is around
<i>5</i>&deg;C when the internal heat gain is zero,
i.e., it is at the average of the outside temperature
and the room design temperature.
Since the boiler control signal is <i>0.5</i>, 
this indicates that the model is correct.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A> (Icon for runnable examples).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>Buildings.Media.GasesPTDecou...</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Buildings.Media.ConstantProp...</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>Q_flow_nominal</TD><TD>20000</TD><TD>Nominal heat flow rate of radiator [W]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadSup_nominal</TD><TD>273.15 + 50</TD><TD>Radiator nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadRet_nominal</TD><TD>273.15 + 40</TD><TD>Radiator nominal return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRad_flow_nominal</TD><TD>Q_flow_nominal/4200/(TRadSup...</TD><TD>Radiator nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiSup_nominal</TD><TD>273.15 + 70</TD><TD>Boiler nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiRet_min</TD><TD>273.15 + 60</TD><TD>Boiler minimum return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mBoi_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Boiler nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRadVal_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Radiator nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V</TD><TD>6*10*3</TD><TD>Room volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mA_flow_nominal</TD><TD>V*6/3600</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>QRooInt_flow</TD><TD>4000</TD><TD>Internal heat gains of the room [W]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Medium model</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> System3 <font color="darkgreen">
  &quot;3rd part of the system model, which adds the boiler loop with open loop control&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumA =
      <A HREF="Buildings_Media_GasesPTDecoupled_MoistAirUnsaturated.html#Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated"
>Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumW =
      <A HREF="Buildings_Media_ConstantPropertyLiquidWater.html#Buildings.Media.ConstantPropertyLiquidWater"
>Buildings.Media.ConstantPropertyLiquidWater</A> <font color="darkgreen">&quot;Medium model&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> Q_flow_nominal = 20000 <font color="darkgreen">
    &quot;Nominal heat flow rate of radiator&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadSup_nominal = 273.15+50 <font color="darkgreen">
    &quot;Radiator nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadRet_nominal = 273.15+40 <font color="darkgreen">
    &quot;Radiator nominal return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Radiator nominal mass flow rate&quot;</font>;

<font color="darkgreen">//-------------------------Step 4: Boiler design values-------------------------//</font>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiSup_nominal = 273.15+70 <font color="darkgreen">
    &quot;Boiler nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiRet_min = 273.15+60 <font color="darkgreen">
    &quot;Boiler minimum return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <font color="darkgreen">
    &quot;Boiler nominal mass flow rate&quot;</font>;
<font color="darkgreen">//------------------------------------------------------------------------------//</font>

<font color="darkgreen">//----------------Radiator loop: Three-way valve: mass flow rate----------------//</font>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Radiator nominal mass flow rate&quot;</font>;
<font color="darkgreen">//------------------------------------------------------------------------------//</font>

<textblock type="annotcomp" expanded="false">  <font color="blue">inner </font><A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid.System"
>Modelica.Fluid.System</A> system;
  <A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</A> vol(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System3.MediumA"
>MediumA</A>,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A> theCon(G=20000/30) <font color="darkgreen">
    &quot;Thermal conductance with the ambient&quot;</font>;</textblock>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> V=6*10*3 <font color="darkgreen">&quot;Room volume&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mA_flow_nominal = V*6/3600 <font color="darkgreen">
    &quot;Nominal mass flow rate&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> QRooInt_flow = 4000 <font color="darkgreen">
    &quot;Internal heat gains of the room&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</A> TOut(T=263.15) <font color="darkgreen">
    &quot;Outside temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</A> preHea <font color="darkgreen">
    &quot;Prescribed heat flow&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</A> heaCap(C=2*V*1.2*1006) <font color="darkgreen">
    &quot;Heat capacity for furniture and walls&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</A> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      table=[      0, 0;
              8*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, QRooInt_flow;
             18*3600, 0;
             24*3600, 0]) <font color="darkgreen">&quot;Time table for internal heat gain&quot;</font>;
  <A HREF="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</A> rad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <font color="darkgreen">&quot;Radiator&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temSup(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
      m_flow_nominal=mRad_flow_nominal) <font color="darkgreen">&quot;Supply water temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> temRoo <font color="darkgreen">
    &quot;Room temperature&quot;</font>;
  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumRad(m_flow_nominal=mRad_flow_nominal,
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>) <font color="darkgreen">&quot;Pump for radiator&quot;</font>;</textblock>

<font color="darkgreen">//-------------------------Step 3: Splitter and mixers------------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium =<A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <font color="darkgreen">&quot;Mixer between valve and radiators&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <font color="darkgreen">&quot;Splitter of boiler loop bypass&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    dp_nominal={0,-200,0},
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal}) <font color="darkgreen">&quot;Mixer&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl4(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <font color="darkgreen">&quot;Splitter for radiator loop valve bypass&quot;</font>;</textblock>
<font color="darkgreen">//----------------------------------------------------------------------------//</font>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumBoi(
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
      m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Pump for boiler&quot;</font>;</textblock>

<font color="darkgreen">//-------------------------------Step 3: Boiler-------------------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</A> boi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<font color="red">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</font>()) <font color="darkgreen">&quot;Boiler&quot;</font>;</textblock>
<font color="darkgreen">//----------------------------------------------------------------------------//</font>

<font color="darkgreen">//--------------------------Step 3: Three-way Valve---------------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valRad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve for radiator loop&quot;</font>;</textblock>
<font color="darkgreen">//----------------------------------------------------------------------------//</font>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</A> preSou(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
      nPorts=1) <font color="darkgreen">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</font>;
  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valBoi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve for boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temRet(<font color="blue">redeclare </font><font color="blue">package</font> Medium =
        <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>, m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Return water temperature&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl1(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <font color="darkgreen">&quot;Splitter&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> const(k=1) <font color="darkgreen">
    &quot;Constant control signal for valves&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> conBoi(k=mBoi_flow_nominal) <font color="darkgreen">
    &quot;Constant mass flow rate for boiler pump&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> const1(k=0.5) <font color="darkgreen">
    &quot;Constant control signal for valves&quot;</font>;
 <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <font color="darkgreen">
    &quot;Pump hysteresis&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad(realTrue=mRad_flow_nominal) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not1 <font color="darkgreen">&quot;Negate output of hysteresis&quot;</font>;</textblock>
<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(TOut.port, theCon.port_a);
  <font color="red">connect</font>(theCon.port_b, vol.heatPort);
  <font color="red">connect</font>(preHea.port, vol.heatPort);
  <font color="red">connect</font>(heaCap.port, vol.heatPort);
  <font color="red">connect</font>(timTab.y[1], preHea.Q_flow);
  <font color="red">connect</font>(temSup.port_b, rad.port_a);
  <font color="red">connect</font>(temRoo.port, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortCon, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortRad, vol.heatPort);
  <font color="red">connect</font>(pumRad.port_b, temSup.port_a);
  <font color="red">connect</font>(boi.port_b, pumBoi.port_a);
  <font color="red">connect</font>(pumBoi.port_b, spl1.port_1);
  <font color="red">connect</font>(spl1.port_2, spl.port_1);
  <font color="red">connect</font>(spl.port_2, valRad.port_1);
  <font color="red">connect</font>(valRad.port_2, mix.port_1);
  <font color="red">connect</font>(spl1.port_3, valBoi.port_3);
  <font color="red">connect</font>(valBoi.port_2, temRet.port_a);
  <font color="red">connect</font>(temRet.port_b, boi.port_a);
  <font color="red">connect</font>(boi.port_a, preSou.ports[1]);
  <font color="red">connect</font>(mix2.port_2, valBoi.port_1);
  <font color="red">connect</font>(spl4.port_2, mix2.port_1);
  <font color="red">connect</font>(spl2.port_2, spl4.port_1);
  <font color="red">connect</font>(valRad.port_3, spl4.port_3);
  <font color="red">connect</font>(spl.port_3, mix2.port_3);
  <font color="red">connect</font>(mix.port_3, spl2.port_3);
  <font color="red">connect</font>(mix.port_2, pumRad.port_a);
  <font color="red">connect</font>(rad.port_b, spl2.port_1);
  <font color="red">connect</font>(const.y, valRad.y);
  <font color="red">connect</font>(conBoi.y, pumBoi.m_flow_in);
  <font color="red">connect</font>(const.y, valBoi.y);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(const1.y, boi.y);
  <font color="red">connect</font>(temRoo.T,hysPum. u);
  <font color="red">connect</font>(hysPum.y,not1. u);
  <font color="red">connect</font>(not1.y,booToReaRad. u);
  <font color="red">connect</font>(booToReaRad.y, pumRad.m_flow_in);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>System3;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE System4<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" ALT="Buildings.Examples.Tutorial.Boiler.System4" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Examples.Tutorial.Boiler.System4"></A><A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</A>.System4</H2>
<B>4th part of the system model, which adds closed-loop control for the pumps and the boiler</B><p></P>
<IMG SRC="Buildings.Examples.Tutori183681ce9fd28127stem4D.png" ALT="Buildings.Examples.Tutorial.Boiler.System4">
<P></P><H3>Information</H3>

<p>
This part of the system model adds to the model that is implemented in
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System3"
>
Buildings.Examples.Tutorial.Boiler.System3</a>
closed loop control for the pumps and the boiler.
The control valves are still open loop control.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System3"
>
Buildings.Examples.Tutorial.Boiler.System3</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System4</code>.
</p>
</li>
<li>
<p>
Next, we added the outdoor temperature sensor <code>senTOut</code>,
which we will use to disable the plant when the outdoor temperature
is warmer than <i>17</i>&deg;C.
This is implemented by the instances <code>hysTOut</code> and
<code>not2</code>, whose output signal is connected
to the block <code>and1</code> as shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System4PlantOnOff.png" border="1"/>
</p>
</li>
<li>
<p>
Similar to the control of the radiator pump, we used a boolean to real
converter, followed by a first order filter, to set the mass flow
rate of the boiler pump.
</p>
</li>
<li>
<p>
Next, for the boiler on/off control, we use again a hysteresis block
(instance <code>hysTBoi</code>), which we configured as
</p>
<pre>
  Modelica.Blocks.Logical.Hysteresis hysTBoi(uLow=273.15 + 70,
                                             uHigh=273.15 + 90) 
    "Hysteresis for on/off of boiler";
</pre>
<p>
The output of the hysteresis block is sent to the instance
<code>not3</code>, which negates its input signal.
The output signal of the <code>not3</code> instance is then sent to the
<code>and2</code> block, which ensures that the boiler is only 
on when the pumps are on and the temperature is below
<i>70</i>&deg;C, and that the boiler is off if its temperature reaches <i>90</i>&deg;C.
Therefore, the boiler control sequence is as shown below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System4BoilerOnOff.png" border="1"/>
</p>
</li>
</ol>
<!-- ============================================== -->
<p>
This completes the closed loop control of the boiler and the pumps. 
When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System4Temperatures.png" border="1"/>
</p>
<p>
The figure shows that the return water temperature
<code>temRet.T</code> is below 
<i>50</i>&deg;C for quite some time when the system heats up.
Furthermore, the supply water temperature
<code>temSup.T</code> is oscillating with the boiler temperature.
We will fix these issues by adding closed loop control for the valves in model
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>
Buildings.Examples.Tutorial.Boiler.System5</a>.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A> (Icon for runnable examples).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>Buildings.Media.GasesPTDecou...</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Buildings.Media.ConstantProp...</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>Q_flow_nominal</TD><TD>20000</TD><TD>Nominal heat flow rate of radiator [W]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadSup_nominal</TD><TD>273.15 + 50</TD><TD>Radiator nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadRet_nominal</TD><TD>273.15 + 40</TD><TD>Radiator nominal return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRad_flow_nominal</TD><TD>Q_flow_nominal/4200/(TRadSup...</TD><TD>Radiator nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiSup_nominal</TD><TD>273.15 + 70</TD><TD>Boiler nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiRet_min</TD><TD>273.15 + 60</TD><TD>Boiler minimum return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mBoi_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Boiler nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRadVal_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Boiler nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V</TD><TD>6*10*3</TD><TD>Room volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mA_flow_nominal</TD><TD>V*6/3600</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>QRooInt_flow</TD><TD>4000</TD><TD>Internal heat gains of the room [W]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Medium model</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> System4 <font color="darkgreen">
  &quot;4th part of the system model, which adds closed-loop control for the pumps and the boiler&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumA =
      <A HREF="Buildings_Media_GasesPTDecoupled_MoistAirUnsaturated.html#Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated"
>Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumW =
      <A HREF="Buildings_Media_ConstantPropertyLiquidWater.html#Buildings.Media.ConstantPropertyLiquidWater"
>Buildings.Media.ConstantPropertyLiquidWater</A> <font color="darkgreen">&quot;Medium model&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> Q_flow_nominal = 20000 <font color="darkgreen">
    &quot;Nominal heat flow rate of radiator&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadSup_nominal = 273.15+50 <font color="darkgreen">
    &quot;Radiator nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadRet_nominal = 273.15+40 <font color="darkgreen">
    &quot;Radiator nominal return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Radiator nominal mass flow rate&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiSup_nominal = 273.15+70 <font color="darkgreen">
    &quot;Boiler nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiRet_min = 273.15+60 <font color="darkgreen">
    &quot;Boiler minimum return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <font color="darkgreen">
    &quot;Boiler nominal mass flow rate&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Boiler nominal mass flow rate&quot;</font>;

<textblock type="annotcomp" expanded="false">  <font color="blue">inner </font><A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid.System"
>Modelica.Fluid.System</A> system;
  <A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</A> vol(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System4.MediumA"
>MediumA</A>,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A> theCon(G=20000/30) <font color="darkgreen">
    &quot;Thermal conductance with the ambient&quot;</font>;</textblock>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> V=6*10*3 <font color="darkgreen">&quot;Room volume&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mA_flow_nominal = V*6/3600 <font color="darkgreen">
    &quot;Nominal mass flow rate&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> QRooInt_flow = 4000 <font color="darkgreen">
    &quot;Internal heat gains of the room&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</A> TOut(T=263.15) <font color="darkgreen">
    &quot;Outside temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</A> preHea <font color="darkgreen">
    &quot;Prescribed heat flow&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</A> heaCap(C=2*V*1.2*1006) <font color="darkgreen">
    &quot;Heat capacity for furniture and walls&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</A> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      table=[      0, 0;
              8*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, QRooInt_flow;
             18*3600, 0;
             24*3600, 0]) <font color="darkgreen">&quot;Time table for internal heat gain&quot;</font>;
  <A HREF="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</A> rad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <font color="darkgreen">&quot;Radiator&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temSup(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
      m_flow_nominal=mRad_flow_nominal) <font color="darkgreen">&quot;Supply water temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> temRoo <font color="darkgreen">
    &quot;Room temperature&quot;</font>;
  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumRad(m_flow_nominal=mRad_flow_nominal,
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>) <font color="darkgreen">&quot;Pump for radiator&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium =<A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <font color="darkgreen">&quot;Mixer between valve and radiators&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <font color="darkgreen">&quot;Splitter of boiler loop bypass&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    dp_nominal={0,-200,0},
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal}) <font color="darkgreen">&quot;Mixer&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl4(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <font color="darkgreen">&quot;Splitter for radiator loop valve bypass&quot;</font>;
  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumBoi(
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
      m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Pump for boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</A> boi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<font color="red">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</font>()) <font color="darkgreen">&quot;Boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valRad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve&quot;</font>;
  <A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</A> preSou(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
      nPorts=1) <font color="darkgreen">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</font>;
  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valBoi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve for boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temRet(<font color="blue">redeclare </font><font color="blue">package</font> Medium =
        <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>, m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Return water temperature&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl1(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <font color="darkgreen">&quot;Splitter&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> const(k=1) <font color="darkgreen">
    &quot;Constant control signal for valves&quot;</font>;</textblock>

<font color="darkgreen">//---------------------Step 2: Outdoor temperature sensor and control------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysTOut(uLow=273.15 + 16, uHigh=273.15 + 17) <font color="darkgreen">
    &quot;Hysteresis for on/off based on outside temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not2;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> senTOut <font color="darkgreen">
    &quot;Outdoor temperature sensor&quot;</font>;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------------------//</font>

<font color="darkgreen">//-------------------------------Step 4: Boiler hysteresis----------------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysTBoi(uHigh=273.15 + 90,
                                             uLow=273.15 + 70) <font color="darkgreen">
    &quot;Hysteresis for on/off of boiler&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not3;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</A> and1;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------------------//</font>

<font color="darkgreen">//-------------------------Step 3: Boolean to real: Boiler Pump-----------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad1(realTrue=mBoi_flow_nominal) <font color="darkgreen">
    &quot;Boiler pump signal&quot;</font>;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------------------//</font>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</A> and2;</textblock>

<font color="darkgreen">//---------------------------------Step 4: Boiler signal------------------------------//</font>
<textblock type="annotcomp" expanded="false"> <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad2(realTrue=1) <font color="darkgreen">&quot;Boiler signal&quot;</font>;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------------------//</font>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <font color="darkgreen">
    &quot;Pump hysteresis&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad(realTrue=mRad_flow_nominal) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not1 <font color="darkgreen">&quot;Negate output of hysteresis&quot;</font>;</textblock>
<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(TOut.port, theCon.port_a);
  <font color="red">connect</font>(theCon.port_b, vol.heatPort);
  <font color="red">connect</font>(preHea.port, vol.heatPort);
  <font color="red">connect</font>(heaCap.port, vol.heatPort);
  <font color="red">connect</font>(timTab.y[1], preHea.Q_flow);
  <font color="red">connect</font>(temSup.port_b, rad.port_a);
  <font color="red">connect</font>(temRoo.port, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortCon, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortRad, vol.heatPort);
  <font color="red">connect</font>(pumRad.port_b, temSup.port_a);
  <font color="red">connect</font>(boi.port_b, pumBoi.port_a);
  <font color="red">connect</font>(pumBoi.port_b, spl1.port_1);
  <font color="red">connect</font>(spl1.port_2, spl.port_1);
  <font color="red">connect</font>(spl.port_2, valRad.port_1);
  <font color="red">connect</font>(valRad.port_2, mix.port_1);
  <font color="red">connect</font>(spl1.port_3, valBoi.port_3);
  <font color="red">connect</font>(valBoi.port_2, temRet.port_a);
  <font color="red">connect</font>(temRet.port_b, boi.port_a);
  <font color="red">connect</font>(boi.port_a, preSou.ports[1]);
  <font color="red">connect</font>(mix2.port_2, valBoi.port_1);
  <font color="red">connect</font>(spl4.port_2, mix2.port_1);
  <font color="red">connect</font>(spl2.port_2, spl4.port_1);
  <font color="red">connect</font>(valRad.port_3, spl4.port_3);
  <font color="red">connect</font>(spl.port_3, mix2.port_3);
  <font color="red">connect</font>(mix.port_3, spl2.port_3);
  <font color="red">connect</font>(mix.port_2, pumRad.port_a);
  <font color="red">connect</font>(rad.port_b, spl2.port_1);
  <font color="red">connect</font>(const.y, valRad.y);
  <font color="red">connect</font>(const.y, valBoi.y);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(hysTOut.y, not2.u);
  <font color="red">connect</font>(senTOut.port, TOut.port);
  <font color="red">connect</font>(hysTBoi.y, not3.u);
  <font color="red">connect</font>(not2.y, and1.u2);
  <font color="red">connect</font>(boi.T, hysTBoi.u);
  <font color="red">connect</font>(senTOut.T, hysTOut.u);
  <font color="red">connect</font>(and1.y, booToReaRad1.u);
  <font color="red">connect</font>(and1.y, and2.u1);
  <font color="red">connect</font>(not3.y, and2.u2);
  <font color="red">connect</font>(and2.y, booToReaRad2.u);
  <font color="red">connect</font>(booToReaRad2.y, boi.y);
  <font color="red">connect</font>(temRoo.T,hysPum. u);
  <font color="red">connect</font>(hysPum.y,not1. u);
  <font color="red">connect</font>(not1.y, and1.u1);
  <font color="red">connect</font>(and1.y, booToReaRad.u);
  <font color="red">connect</font>(booToReaRad.y, pumRad.m_flow_in);
  <font color="red">connect</font>(booToReaRad1.y, pumBoi.m_flow_in);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>System4;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE System5<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" ALT="Buildings.Examples.Tutorial.Boiler.System5" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Examples.Tutorial.Boiler.System5"></A><A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</A>.System5</H2>
<B>5th part of the system model, which adds closed-loop control for the valves</B><p></P>
<IMG SRC="Buildings.Examples.Tutori183681cf9fd28126stem5D.png" ALT="Buildings.Examples.Tutorial.Boiler.System5">
<P></P><H3>Information</H3>

<p>
This part of the system model adds to the model that is implemented in
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>
Buildings.Examples.Tutorial.Boiler.System4</a>
closed loop control for the valves.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>
Buildings.Examples.Tutorial.Boiler.System4</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System5</code>.
</p>
</li>
<li>
<p>
Next, we added closed loop control for the boiler valve as
shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System5BoilerValveControl.png" border="1"/>
</p>
<p>
This is implemented using the constant block
<A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>
Modelica.Blocks.Sources.Constant</a> for the set point,
the PID controller with output limitation
<A HREF="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>
Buildings.Controls.Continuous.LimPID</a>.
We configured the controller as
</p>
<pre>
  Buildings.Controls.Continuous.LimPID conPIDBoi(
    controllerType=Modelica.Blocks.Types.SimpleController.P,
    k=0.1,
    Ti=120,    
    Td=1) "Controller for valve in boiler loop";
</pre>
<p>
We set the proportional band to <i>10</i> Kelvin, hence <code>k=0.1</code>.
We set the integral time constant to <i>120</i> seconds, which is 
the same time as is required to open or close the valve.
These settings turn out to give satisfactory closed loop control performance.
Otherwise, we would need to retune the controller, which is 
usually easiest by configuring the controller as a P-controller, then tuning the
proportional gain, and finally changing it to a PI-controller and tuning the 
integral time constant.
</p>
</li>
<li>
<p>
The valve control for the radiator loop is implemented similar to
the boiler loop, with the exception that the setpoint is computed
using the model
<A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.Table"
>
Buildings.Controls.SetPoints.Table</a> to implement
a set point that shifts as a function of the room temperature.
This instance is called <code>TSetSup</code> in the 
control sequence shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System5RadiatorValve.png" border="1"/>
</p>
<p>
Its configuration is
</p>
<pre>
  Controls.SetPoints.Table TSetSup(table=[273.15 + 19, 273.15 + 50; 
                                          273.15 + 21, 273.15 + 21]) 
                                          "Setpoint for supply water temperature";
</pre>
</li>
</ol>
<!-- ============================================== -->
<p>
This completes the closed loop control.
When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System5Temperatures.png" border="1"/>
</p>
<p>
The figure shows that the return water temperature
<code>temRet.T</code>
quickly raises to <i>50</i>&deg;C and the supply water temperature
<code>temSup.T</code>
has smaller oscillations compared to 
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>
Buildings.Examples.Tutorial.Boiler.System4</a>.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A> (Icon for runnable examples).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>Buildings.Media.GasesPTDecou...</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Buildings.Media.ConstantProp...</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>Q_flow_nominal</TD><TD>20000</TD><TD>Nominal heat flow rate of radiator [W]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadSup_nominal</TD><TD>273.15 + 50</TD><TD>Radiator nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadRet_nominal</TD><TD>273.15 + 40</TD><TD>Radiator nominal return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRad_flow_nominal</TD><TD>Q_flow_nominal/4200/(TRadSup...</TD><TD>Radiator nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiSup_nominal</TD><TD>273.15 + 70</TD><TD>Boiler nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiRet_min</TD><TD>273.15 + 60</TD><TD>Boiler minimum return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mBoi_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Boiler nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRadVal_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Boiler nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V</TD><TD>6*10*3</TD><TD>Room volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mA_flow_nominal</TD><TD>V*6/3600</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>QRooInt_flow</TD><TD>4000</TD><TD>Internal heat gains of the room [W]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Medium model</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> System5 <font color="darkgreen">
  &quot;5th part of the system model, which adds closed-loop control for the valves&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumA =
      <A HREF="Buildings_Media_GasesPTDecoupled_MoistAirUnsaturated.html#Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated"
>Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumW =
      <A HREF="Buildings_Media_ConstantPropertyLiquidWater.html#Buildings.Media.ConstantPropertyLiquidWater"
>Buildings.Media.ConstantPropertyLiquidWater</A> <font color="darkgreen">&quot;Medium model&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> Q_flow_nominal = 20000 <font color="darkgreen">
    &quot;Nominal heat flow rate of radiator&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadSup_nominal = 273.15+50 <font color="darkgreen">
    &quot;Radiator nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadRet_nominal = 273.15+40 <font color="darkgreen">
    &quot;Radiator nominal return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Radiator nominal mass flow rate&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiSup_nominal = 273.15+70 <font color="darkgreen">
    &quot;Boiler nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiRet_min = 273.15+60 <font color="darkgreen">
    &quot;Boiler minimum return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <font color="darkgreen">
    &quot;Boiler nominal mass flow rate&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Boiler nominal mass flow rate&quot;</font>;

<textblock type="annotcomp" expanded="false">  <font color="blue">inner </font><A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid.System"
>Modelica.Fluid.System</A> system;
  <A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</A> vol(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System5.MediumA"
>MediumA</A>,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A> theCon(G=20000/30) <font color="darkgreen">
    &quot;Thermal conductance with the ambient&quot;</font>;</textblock>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> V=6*10*3 <font color="darkgreen">&quot;Room volume&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mA_flow_nominal = V*6/3600 <font color="darkgreen">
    &quot;Nominal mass flow rate&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> QRooInt_flow = 4000 <font color="darkgreen">
    &quot;Internal heat gains of the room&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</A> TOut(T=263.15) <font color="darkgreen">
    &quot;Outside temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</A> preHea <font color="darkgreen">
    &quot;Prescribed heat flow&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</A> heaCap(C=2*V*1.2*1006) <font color="darkgreen">
    &quot;Heat capacity for furniture and walls&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</A> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      table=[      0, 0;
              8*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, QRooInt_flow;
             18*3600, 0;
             24*3600, 0]) <font color="darkgreen">&quot;Time table for internal heat gain&quot;</font>;
  <A HREF="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</A> rad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <font color="darkgreen">&quot;Radiator&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temSup(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
      m_flow_nominal=mRad_flow_nominal) <font color="darkgreen">&quot;Supply water temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> temRoo <font color="darkgreen">
    &quot;Room temperature&quot;</font>;
  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumRad(m_flow_nominal=mRad_flow_nominal,
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>) <font color="darkgreen">&quot;Pump for radiator&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium =<A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <font color="darkgreen">&quot;Mixer between valve and radiators&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <font color="darkgreen">&quot;Splitter of boiler loop bypass&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    dp_nominal={0,-200,0},
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal}) <font color="darkgreen">&quot;Mixer&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl4(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <font color="darkgreen">&quot;Splitter for radiator loop valve bypass&quot;</font>;
  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumBoi(
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
      m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Pump for boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</A> boi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<font color="red">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</font>()) <font color="darkgreen">&quot;Boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valRad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve&quot;</font>;
  <A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</A> preSou(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
      nPorts=1) <font color="darkgreen">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</font>;
  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valBoi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve for boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temRet(<font color="blue">redeclare </font><font color="blue">package</font> Medium =
        <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>, m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Return water temperature&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl1(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <font color="darkgreen">&quot;Splitter&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysTOut(uLow=273.15 + 16, uHigh=273.15 + 17) <font color="darkgreen">
    &quot;Hysteresis for on/off based on outside temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not2;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> senTOut <font color="darkgreen">
    &quot;Outdoor temperature sensor&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysTBoi(uLow=273.15 + 70, uHigh=273.15 +
        90) <font color="darkgreen">&quot;Hysteresis for on/off of boiler&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not3;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</A> and1;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad1(realTrue=mBoi_flow_nominal) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</A> and2;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad2(realTrue=1) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <font color="darkgreen">
    &quot;Pump hysteresis&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad(realTrue=mRad_flow_nominal) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not1 <font color="darkgreen">&quot;Negate output of hysteresis&quot;</font>;</textblock>

<font color="darkgreen">//------------------------Step 2: Boiler loop valve control-----------------------//</font>
<textblock type="annotcomp" expanded="false"> <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> TSetBoiRet(k=TBoiRet_min) <font color="darkgreen">
    &quot;Temperature setpoint for boiler return&quot;</font>;
  <A HREF="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</A> conPIDBoi(
    Td=1,
    Ti=120,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1) <font color="darkgreen">&quot;Controller for valve in boiler loop&quot;</font>;</textblock>
<font color="darkgreen">//--------------------------------------------------------------------------------//</font>

<font color="darkgreen">//----------------------Step 3: Radiator loop valve control-----------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.Table"
>Controls.SetPoints.Table</A> TSetSup(table=[273.15 + 19, 273.15 + 50;
                                          273.15 + 21, 273.15 + 21]) <font color="darkgreen">
    &quot;Setpoint for supply water temperature&quot;</font>;
  <A HREF="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</A> conPIDRad(
    Td=1,
    Ti=120,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1) <font color="darkgreen">&quot;Controller for valve in radiator loop&quot;</font>;</textblock>
<font color="darkgreen">//--------------------------------------------------------------------------------//</font>

<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(TOut.port, theCon.port_a);
  <font color="red">connect</font>(theCon.port_b, vol.heatPort);
  <font color="red">connect</font>(preHea.port, vol.heatPort);
  <font color="red">connect</font>(heaCap.port, vol.heatPort);
  <font color="red">connect</font>(timTab.y[1], preHea.Q_flow);
  <font color="red">connect</font>(temSup.port_b, rad.port_a);
  <font color="red">connect</font>(temRoo.port, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortCon, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortRad, vol.heatPort);
  <font color="red">connect</font>(pumRad.port_b, temSup.port_a);
  <font color="red">connect</font>(boi.port_b, pumBoi.port_a);
  <font color="red">connect</font>(pumBoi.port_b, spl1.port_1);
  <font color="red">connect</font>(spl1.port_2, spl.port_1);
  <font color="red">connect</font>(spl.port_2, valRad.port_1);
  <font color="red">connect</font>(valRad.port_2, mix.port_1);
  <font color="red">connect</font>(spl1.port_3, valBoi.port_3);
  <font color="red">connect</font>(valBoi.port_2, temRet.port_a);
  <font color="red">connect</font>(temRet.port_b, boi.port_a);
  <font color="red">connect</font>(boi.port_a, preSou.ports[1]);
  <font color="red">connect</font>(mix2.port_2, valBoi.port_1);
  <font color="red">connect</font>(spl4.port_2, mix2.port_1);
  <font color="red">connect</font>(spl2.port_2, spl4.port_1);
  <font color="red">connect</font>(valRad.port_3, spl4.port_3);
  <font color="red">connect</font>(spl.port_3, mix2.port_3);
  <font color="red">connect</font>(mix.port_3, spl2.port_3);
  <font color="red">connect</font>(mix.port_2, pumRad.port_a);
  <font color="red">connect</font>(rad.port_b, spl2.port_1);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(hysTOut.y, not2.u);
  <font color="red">connect</font>(senTOut.port, TOut.port);
  <font color="red">connect</font>(hysTBoi.y, not3.u);
  <font color="red">connect</font>(not2.y, and1.u2);
  <font color="red">connect</font>(boi.T, hysTBoi.u);
  <font color="red">connect</font>(senTOut.T, hysTOut.u);
  <font color="red">connect</font>(and1.y, booToReaRad1.u);
  <font color="red">connect</font>(and1.y, and2.u1);
  <font color="red">connect</font>(not3.y, and2.u2);
  <font color="red">connect</font>(and2.y, booToReaRad2.u);
  <font color="red">connect</font>(booToReaRad2.y, boi.y);
  <font color="red">connect</font>(temRoo.T,hysPum. u);
  <font color="red">connect</font>(hysPum.y,not1. u);
  <font color="red">connect</font>(not1.y, and1.u1);
  <font color="red">connect</font>(and1.y, booToReaRad.u);
  <font color="red">connect</font>(temRet.T,conPIDBoi. u_s);
  <font color="red">connect</font>(TSetBoiRet.y,conPIDBoi. u_m);
  <font color="red">connect</font>(temRoo.T, TSetSup.u);
  <font color="red">connect</font>(TSetSup.y, conPIDRad.u_s);
  <font color="red">connect</font>(temSup.T, conPIDRad.u_m);
  <font color="red">connect</font>(conPIDRad.y, valRad.y);
  <font color="red">connect</font>(booToReaRad.y, pumRad.m_flow_in);
  <font color="red">connect</font>(booToReaRad1.y, pumBoi.m_flow_in);
  <font color="red">connect</font>(conPIDBoi.y, valBoi.y);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>System5;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE System6<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" ALT="Buildings.Examples.Tutorial.Boiler.System6" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Examples.Tutorial.Boiler.System6"></A><A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</A>.System6</H2>
<B>6th part of the system model, which adds weather data and changes to PI control</B><p></P>
<IMG SRC="Buildings.Examples.Tutori183681d09fd28125stem6D.png" ALT="Buildings.Examples.Tutorial.Boiler.System6">
<P></P><H3>Information</H3>

<p>
This part of the system model adds to the model that is implemented in
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>
Buildings.Examples.Tutorial.Boiler.System5</a>
weather data, and it changes the control to PI control.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>
Buildings.Examples.Tutorial.Boiler.System5</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System6</code>.
</p>
</li>
<li>
<p>
Next, we added the weather data as shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System6Weather.png" border="1"/>
</p>
<p>
The weather data reader is implemented using
</p>
<pre>
  BoundaryConditions.WeatherData.ReaderTMY3 weaDat(
    filNam="modelica://Buildings/Resources/weatherdata/USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.mos") 
    "Weather data reader";
</pre>
<p>
The yellow icon in the middle of the figure is an instance of
<A HREF="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>
Buildings.BoundaryConditions.WeatherData.Bus</a>.
This is required to extract the dry bulb temperature from the weather data bus.
</p>
<p>
Note that we changed the instance <code>TOut</code> from
<A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>
Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</a>
to
<A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature"
>
Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature</a>
in order to use the dry-bulb temperature as an input signal.
</p>
</li>
</ol>
<!-- ============================================== -->
<p>
This completes the closed loop control.
When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System6Temperatures1.png" border="1"/>
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System6Temperatures2.png" border="1"/>
</p>
<p>
The figure shows that the boiler temperature is regulated between
<i>70</i>&deg;C and 
<i>90</i>&deg;C,
that 
the boiler inlet temperature is above 
<i>60</i>&deg;C,
and that the room temperature and the supply water temperature are
maintained at their set point.
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A> (Icon for runnable examples).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>Buildings.Media.GasesPTDecou...</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Buildings.Media.ConstantProp...</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>Q_flow_nominal</TD><TD>20000</TD><TD>Nominal heat flow rate of radiator [W]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadSup_nominal</TD><TD>273.15 + 50</TD><TD>Radiator nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadRet_nominal</TD><TD>273.15 + 40</TD><TD>Radiator nominal return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRad_flow_nominal</TD><TD>Q_flow_nominal/4200/(TRadSup...</TD><TD>Radiator nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiSup_nominal</TD><TD>273.15 + 70</TD><TD>Boiler nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiRet_min</TD><TD>273.15 + 60</TD><TD>Boiler minimum return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mBoi_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Boiler nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRadVal_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Boiler nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V</TD><TD>6*10*3</TD><TD>Room volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mA_flow_nominal</TD><TD>V*6/3600</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>QRooInt_flow</TD><TD>4000</TD><TD>Internal heat gains of the room [W]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>Bus</A></TD><TD>weaBus</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> System6 <font color="darkgreen">
  &quot;6th part of the system model, which adds weather data and changes to PI control&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumA =
      <A HREF="Buildings_Media_GasesPTDecoupled_MoistAirUnsaturated.html#Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated"
>Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumW =
      <A HREF="Buildings_Media_ConstantPropertyLiquidWater.html#Buildings.Media.ConstantPropertyLiquidWater"
>Buildings.Media.ConstantPropertyLiquidWater</A> <font color="darkgreen">&quot;Medium model&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> Q_flow_nominal = 20000 <font color="darkgreen">
    &quot;Nominal heat flow rate of radiator&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadSup_nominal = 273.15+50 <font color="darkgreen">
    &quot;Radiator nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadRet_nominal = 273.15+40 <font color="darkgreen">
    &quot;Radiator nominal return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Radiator nominal mass flow rate&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiSup_nominal = 273.15+70 <font color="darkgreen">
    &quot;Boiler nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiRet_min = 273.15+60 <font color="darkgreen">
    &quot;Boiler minimum return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <font color="darkgreen">
    &quot;Boiler nominal mass flow rate&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Boiler nominal mass flow rate&quot;</font>;

<textblock type="annotcomp" expanded="false">  <font color="blue">inner </font><A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid.System"
>Modelica.Fluid.System</A> system;
  <A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</A> vol(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System6.MediumA"
>MediumA</A>,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A> theCon(G=20000/30) <font color="darkgreen">
    &quot;Thermal conductance with the ambient&quot;</font>;</textblock>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> V=6*10*3 <font color="darkgreen">&quot;Room volume&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mA_flow_nominal = V*6/3600 <font color="darkgreen">
    &quot;Nominal mass flow rate&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> QRooInt_flow = 4000 <font color="darkgreen">
    &quot;Internal heat gains of the room&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</A> preHea <font color="darkgreen">
    &quot;Prescribed heat flow&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</A> heaCap(C=2*V*1.2*1006) <font color="darkgreen">
    &quot;Heat capacity for furniture and walls&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</A> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      table=[      0, 0;
              8*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, QRooInt_flow;
             18*3600, 0;
             24*3600, 0]) <font color="darkgreen">&quot;Time table for internal heat gain&quot;</font>;
  <A HREF="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</A> rad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <font color="darkgreen">&quot;Radiator&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temSup(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
      m_flow_nominal=mRad_flow_nominal) <font color="darkgreen">&quot;Supply water temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> temRoo <font color="darkgreen">
    &quot;Room temperature&quot;</font>;
  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumRad(m_flow_nominal=mRad_flow_nominal,
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>) <font color="darkgreen">&quot;Pump for radiator&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium =<A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <font color="darkgreen">&quot;Mixer between valve and radiators&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <font color="darkgreen">&quot;Splitter of boiler loop bypass&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal},
    dp_nominal={0,-200,0}) <font color="darkgreen">&quot;Mixer&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl4(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <font color="darkgreen">&quot;Splitter for radiator loop valve bypass&quot;</font>;
  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumBoi(
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
      m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Pump for boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</A> boi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<font color="red">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</font>()) <font color="darkgreen">&quot;Boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valRad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve&quot;</font>;
  <A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</A> preSou(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
      nPorts=1) <font color="darkgreen">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</font>;
  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valBoi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve for boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temRet(<font color="blue">redeclare </font><font color="blue">package</font> Medium =
        <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>, m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Return water temperature&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl1(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <font color="darkgreen">&quot;Splitter&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysTOut(uLow=273.15 + 16, uHigh=273.15 + 17) <font color="darkgreen">
    &quot;Hysteresis for on/off based on outside temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not2;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> senTOut <font color="darkgreen">
    &quot;Outdoor temperature sensor&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysTBoi(uLow=273.15 + 70, uHigh=273.15 + 90) <font color="darkgreen">
    &quot;Hysteresis for on/off of boiler&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not3;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</A> and1;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad1(realTrue=mBoi_flow_nominal) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</A> and2;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad2(realTrue=1) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</A> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <font color="darkgreen">
    &quot;Pump hysteresis&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad(realTrue=mRad_flow_nominal) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not1 <font color="darkgreen">&quot;Negate output of hysteresis&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> TSetBoiRet(k=TBoiRet_min) <font color="darkgreen">
    &quot;Temperature setpoint for boiler return&quot;</font>;</textblock>

<font color="darkgreen">//-----------------------Step 3: Change in controller type-----------------------//</font>
<textblock type="annotcomp" expanded="false"> <A HREF="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</A> conPIDBoi(
    Td=1,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1,
    Ti=120) <font color="darkgreen">&quot;Controller for valve in boiler loop&quot;</font>;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------------//</font>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.Table"
>Controls.SetPoints.Table</A> TSetSup(table=[273.15 + 19, 273.15 + 50;
                                          273.15 + 21, 273.15 + 21]) <font color="darkgreen">
    &quot;Setpoint for supply water temperature&quot;</font>;</textblock>

<font color="darkgreen">//-----------------------Step 3: Change in controller type-----------------------//</font>
<textblock type="annotcomp" expanded="false"> <A HREF="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</A> conPIDRad(
    Td=1,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1,
    Ti=120) <font color="darkgreen">&quot;Controller for valve in radiator loop&quot;</font>;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------------//</font>

<font color="darkgreen">//-----------------------------Step 2: Weather data------------------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.ReaderTMY3"
>BoundaryConditions.WeatherData.ReaderTMY3</A> weaDat(
    filNam=&quot;modelica://Buildings/Resources/weatherdata/USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.mos&quot;) <font color="darkgreen">
    &quot;Weather data reader&quot;</font>;
  <A HREF="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>BoundaryConditions.WeatherData.Bus</A> weaBus;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature</A> TOut <font color="darkgreen">
    &quot;Outside temperature&quot;</font>;</textblock>
<font color="darkgreen">//------------------------------------------------------------------------------//</font>

<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(theCon.port_b, vol.heatPort);
  <font color="red">connect</font>(preHea.port, vol.heatPort);
  <font color="red">connect</font>(heaCap.port, vol.heatPort);
  <font color="red">connect</font>(timTab.y[1], preHea.Q_flow);
  <font color="red">connect</font>(temSup.port_b, rad.port_a);
  <font color="red">connect</font>(temRoo.port, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortCon, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortRad, vol.heatPort);
  <font color="red">connect</font>(pumRad.port_b, temSup.port_a);
  <font color="red">connect</font>(boi.port_b, pumBoi.port_a);
  <font color="red">connect</font>(pumBoi.port_b, spl1.port_1);
  <font color="red">connect</font>(spl1.port_2, spl.port_1);
  <font color="red">connect</font>(spl.port_2, valRad.port_1);
  <font color="red">connect</font>(valRad.port_2, mix.port_1);
  <font color="red">connect</font>(spl1.port_3, valBoi.port_3);
  <font color="red">connect</font>(valBoi.port_2, temRet.port_a);
  <font color="red">connect</font>(temRet.port_b, boi.port_a);
  <font color="red">connect</font>(boi.port_a, preSou.ports[1]);
  <font color="red">connect</font>(mix2.port_2, valBoi.port_1);
  <font color="red">connect</font>(spl4.port_2, mix2.port_1);
  <font color="red">connect</font>(spl2.port_2, spl4.port_1);
  <font color="red">connect</font>(valRad.port_3, spl4.port_3);
  <font color="red">connect</font>(spl.port_3, mix2.port_3);
  <font color="red">connect</font>(mix.port_3, spl2.port_3);
  <font color="red">connect</font>(mix.port_2, pumRad.port_a);
  <font color="red">connect</font>(rad.port_b, spl2.port_1);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(hysTOut.y, not2.u);
  <font color="red">connect</font>(hysTBoi.y, not3.u);
  <font color="red">connect</font>(not2.y, and1.u2);
  <font color="red">connect</font>(boi.T, hysTBoi.u);
  <font color="red">connect</font>(senTOut.T, hysTOut.u);
  <font color="red">connect</font>(and1.y, booToReaRad1.u);
  <font color="red">connect</font>(and1.y, and2.u1);
  <font color="red">connect</font>(not3.y, and2.u2);
  <font color="red">connect</font>(and2.y, booToReaRad2.u);
  <font color="red">connect</font>(booToReaRad2.y, boi.y);
  <font color="red">connect</font>(temRoo.T,hysPum. u);
  <font color="red">connect</font>(hysPum.y,not1. u);
  <font color="red">connect</font>(not1.y, and1.u1);
  <font color="red">connect</font>(and1.y, booToReaRad.u);
  <font color="red">connect</font>(temRet.T,conPIDBoi. u_s);
  <font color="red">connect</font>(TSetBoiRet.y,conPIDBoi. u_m);
  <font color="red">connect</font>(temRoo.T, TSetSup.u);
  <font color="red">connect</font>(TSetSup.y, conPIDRad.u_s);
  <font color="red">connect</font>(temSup.T, conPIDRad.u_m);
  <font color="red">connect</font>(weaDat.weaBus, weaBus);
  <font color="red">connect</font>(weaBus.TDryBul, TOut.T);
  <font color="red">connect</font>(TOut.port, theCon.port_a);
  <font color="red">connect</font>(TOut.port, senTOut.port);
  <font color="red">connect</font>(booToReaRad.y, pumRad.m_flow_in);
  <font color="red">connect</font>(conPIDRad.y, valRad.y);
  <font color="red">connect</font>(booToReaRad1.y, pumBoi.m_flow_in);
  <font color="red">connect</font>(conPIDBoi.y, valBoi.y);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>System6;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE System7<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" ALT="Buildings.Examples.Tutorial.Boiler.System7" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Examples.Tutorial.Boiler.System7"></A><A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</A>.System7</H2>
<B>7th part of the system model, which implements the on/off control using a state machine</B><p></P>
<IMG SRC="Buildings.Examples.Tutori183681d19fd28124stem7D.png" ALT="Buildings.Examples.Tutorial.Boiler.System7">
<P></P><H3>Information</H3>

<p>
This part of the system model changes the implementation of the control in
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System6"
>
Buildings.Examples.Tutorial.Boiler.System6</a>
to use a state machine to switch the pumps and the boiler on and off.
State machines provide an alternate way to implement discrete event, 
reactive and hybrid systems.
The state machine that is implemented in this model is shown in
the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/stateMachine.png" border="1"/>
</p>
<p>
In the figure above, the ovals depict states, and the arrows are transitions between the states.
The transitions fire when the conditions are true.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<A HREF="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System6"
>
Buildings.Examples.Tutorial.Boiler.System6</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System7</code>.
</p>
</li>
<li>
<p>
We implemented the state machine using blocks from the library
<A HREF="../../msl/Modelica_StateGraph2 2.0.1/help/Modelica_StateGraph2.html#Modelica_StateGraph2"
>
Modelica_StateGraph2</a>.
How to use these blocks is explained in the 
user's guide of the 
<A HREF="../../msl/Modelica_StateGraph2 2.0.1/help/Modelica_StateGraph2.html#Modelica_StateGraph2"
>
Modelica_StateGraph2</a>
library.
</p>
<p>
The figure below shows the state machine. 
The oval icons are states, and the black bars
are transitions. The transitions are enabled when their input signal is true.
The red numbers to the right of the transition indicate the delay in seconds.
If a delay is present, the input needs to be true during the entire duration of the delay
for a transition to fire.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System7StateMachine.png" border="1"/>
</p>
<p>
In our implementation, the state <code>allOff</code> is the initial state,
indicated by its black arrow.
The transition <code>T1</code> is used to switch the pumps on.
Once the pumps are on, transition <code>T2</code> may fire, which 
would switch the boiler on.
Hence, the boiler can only be on when the pumps are on.
From the state <code>boilerOn</code>, the only next step can be to 
transition to the state <code>pumpsOn</code>.
Once this state has been reached (and hence the boiler is off),
the pumps can be switched off when transition <code>T4</code> fires.
Note that the transitions <code>T3</code> and <code>T4</code>
only fire when their input is true for the entire duration of <i>10</i> seconds.
Hence, the pumps and the boiler must run for at least <i>10</i> seconds
before they can be switched off.
</p>
</li>
</ol>
<!-- ============================================== -->
<p>
When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System7Temperatures1.png" border="1"/>
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System7Temperatures2.png" border="1"/>
</p>
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A> (Icon for runnable examples).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>Buildings.Media.GasesPTDecou...</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Buildings.Media.ConstantProp...</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>Q_flow_nominal</TD><TD>20000</TD><TD>Nominal heat flow rate of radiator [W]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadSup_nominal</TD><TD>273.15 + 50</TD><TD>Radiator nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TRadRet_nominal</TD><TD>273.15 + 40</TD><TD>Radiator nominal return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRad_flow_nominal</TD><TD>Q_flow_nominal/4200/(TRadSup...</TD><TD>Radiator nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiSup_nominal</TD><TD>273.15 + 70</TD><TD>Boiler nominal supply water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TBoiRet_min</TD><TD>273.15 + 60</TD><TD>Boiler minimum return water temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mBoi_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Boiler nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mRadVal_flow_nominal</TD><TD>Q_flow_nominal/4200/(TBoiSup...</TD><TD>Boiler nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V</TD><TD>6*10*3</TD><TD>Room volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mA_flow_nominal</TD><TD>V*6/3600</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>QRooInt_flow</TD><TD>4000</TD><TD>Internal heat gains of the room [W]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package MediumA</TD><TD>&nbsp;</TD></TR>
<TR><TD colspan="2">replaceable package MediumW</TD><TD>Medium model</TD></TR>
<TR><TD><A HREF="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>Bus</A></TD><TD>weaBus</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> System7 <font color="darkgreen">
  &quot;7th part of the system model, which implements the on/off control using a state machine&quot;</font>
  <font color="blue">extends </font><A HREF="../../msl/3.2/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumA =
      <A HREF="Buildings_Media_GasesPTDecoupled_MoistAirUnsaturated.html#Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated"
>Buildings.Media.GasesPTDecoupled.MoistAirUnsaturated</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> MediumW =
      <A HREF="Buildings_Media_ConstantPropertyLiquidWater.html#Buildings.Media.ConstantPropertyLiquidWater"
>Buildings.Media.ConstantPropertyLiquidWater</A> <font color="darkgreen">&quot;Medium model&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> Q_flow_nominal = 20000 <font color="darkgreen">
    &quot;Nominal heat flow rate of radiator&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadSup_nominal = 273.15+50 <font color="darkgreen">
    &quot;Radiator nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TRadRet_nominal = 273.15+40 <font color="darkgreen">
    &quot;Radiator nominal return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Radiator nominal mass flow rate&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiSup_nominal = 273.15+70 <font color="darkgreen">
    &quot;Boiler nominal supply water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TBoiRet_min = 273.15+60 <font color="darkgreen">
    &quot;Boiler minimum return water temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <font color="darkgreen">
    &quot;Boiler nominal mass flow rate&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <font color="darkgreen">
    &quot;Boiler nominal mass flow rate&quot;</font>;

<textblock type="annotcomp" expanded="false">  <font color="blue">inner </font><A HREF="../../msl/3.2/help/Modelica_Fluid.html#Modelica.Fluid.System"
>Modelica.Fluid.System</A> system;
  <A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</A> vol(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System7.MediumA"
>MediumA</A>,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A> theCon(G=20000/30) <font color="darkgreen">
    &quot;Thermal conductance with the ambient&quot;</font>;</textblock>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> V=6*10*3 <font color="darkgreen">&quot;Room volume&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mA_flow_nominal = V*6/3600 <font color="darkgreen">
    &quot;Nominal mass flow rate&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> QRooInt_flow = 4000 <font color="darkgreen">
    &quot;Internal heat gains of the room&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</A> preHea <font color="darkgreen">
    &quot;Prescribed heat flow&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</A> heaCap(C=2*V*1.2*1006) <font color="darkgreen">
    &quot;Heat capacity for furniture and walls&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</A> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      table=[      0, 0;
              8*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, QRooInt_flow;
             18*3600, 0;
             24*3600, 0]) <font color="darkgreen">&quot;Time table for internal heat gain&quot;</font>;
  <A HREF="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</A> rad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <font color="darkgreen">&quot;Radiator&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temSup(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
      m_flow_nominal=mRad_flow_nominal) <font color="darkgreen">&quot;Supply water temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> temRoo <font color="darkgreen">
    &quot;Room temperature&quot;</font>;
  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumRad(m_flow_nominal=mRad_flow_nominal,
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>) <font color="darkgreen">&quot;Pump for radiator&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium =<A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <font color="darkgreen">&quot;Mixer between valve and radiators&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <font color="darkgreen">&quot;Splitter of boiler loop bypass&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> mix2(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal},
    dp_nominal={0,-200,0}) <font color="darkgreen">&quot;Mixer&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl4(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <font color="darkgreen">&quot;Splitter for radiator loop valve bypass&quot;</font>;
  <A HREF="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowMachine_m_flow"
>Buildings.Fluid.Movers.FlowMachine_m_flow</A> pumBoi(
      <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
      m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Pump for boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</A> boi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<font color="red">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</font>()) <font color="darkgreen">&quot;Boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valRad(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve&quot;</font>;
  <A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</A> preSou(<font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
      nPorts=1) <font color="darkgreen">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</font>;
  <A HREF="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</A> valBoi(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <font color="darkgreen">&quot;Three-way valve for boiler&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</A> temRet(<font color="blue">redeclare </font><font color="blue">package</font> Medium =
        <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>, m_flow_nominal=mBoi_flow_nominal) <font color="darkgreen">&quot;Return water temperature&quot;</font>;
  <A HREF="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</A> spl1(<font color="blue">redeclare </font><font color="blue">
      package</font> Medium =
               <A HREF="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</A>,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <font color="darkgreen">&quot;Splitter&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</A> senTOut <font color="darkgreen">
    &quot;Outdoor temperature sensor&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad1(realTrue=mBoi_flow_nominal) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad2(realTrue=1) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</A> booToReaRad(realTrue=mRad_flow_nominal) <font color="darkgreen">
    &quot;Radiator pump signal&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> TSetBoiRet(k=TBoiRet_min) <font color="darkgreen">
    &quot;Temperature setpoint for boiler return&quot;</font>;
  <A HREF="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</A> conPIDBoi(
    Td=1,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1,
    Ti=120) <font color="darkgreen">&quot;Controller for valve in boiler loop&quot;</font>;
  <A HREF="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.Table"
>Controls.SetPoints.Table</A> TSetSup(table=[273.15 + 19, 273.15 + 50;
                                          273.15 + 21, 273.15 + 21]) <font color="darkgreen">
    &quot;Setpoint for supply water temperature&quot;</font>;
  <A HREF="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</A> conPIDRad(
    Td=1,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1,
    Ti=120) <font color="darkgreen">&quot;Controller for valve in radiator loop&quot;</font>;
  <A HREF="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.ReaderTMY3"
>BoundaryConditions.WeatherData.ReaderTMY3</A> weaDat(
    filNam=&quot;modelica://Buildings/Resources/weatherdata/USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.mos&quot;) <font color="darkgreen">
    &quot;Weather data reader&quot;</font>;
  <A HREF="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>BoundaryConditions.WeatherData.Bus</A> weaBus;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature</A> TOut <font color="darkgreen">
    &quot;Outside temperature&quot;</font>;</textblock>

<font color="darkgreen">//-------------------------Step 2: State machine implementation-------------------------//</font>
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/Modelica_StateGraph2 2.0.1/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Step"
>Modelica_StateGraph2.Step</A> allOff(
    nOut=1,
    initialStep=true,
    use_activePort=true,
    nIn=1) <font color="darkgreen">&quot;System off&quot;</font>;
  <A HREF="../../msl/Modelica_StateGraph2 2.0.1/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Transition"
>Modelica_StateGraph2.Transition</A> T1(use_conditionPort=true, delayedTransition=
        false);
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.LessThreshold"
>Modelica.Blocks.Logical.LessThreshold</A> lessThreshold(threshold=273.15 + 19);
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.LessThreshold"
>Modelica.Blocks.Logical.LessThreshold</A> lessThreshold1(threshold=273.15 + 16);
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</A> and3;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.LessThreshold"
>Modelica.Blocks.Logical.LessThreshold</A> lessThreshold2(threshold=273.15 + 70) <font color="darkgreen">
    &quot;Threshold for boiler control&quot;</font>;
  <A HREF="../../msl/Modelica_StateGraph2 2.0.1/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Step"
>Modelica_StateGraph2.Step</A> boilerOn(
    nIn=1,
    use_activePort=true,
    nOut=1) <font color="darkgreen">&quot;Boiler is on&quot;</font>;
  <A HREF="../../msl/Modelica_StateGraph2 2.0.1/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Transition"
>Modelica_StateGraph2.Transition</A> T2(
    use_conditionPort=true, delayedTransition=false);
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.GreaterThreshold"
>Modelica.Blocks.Logical.GreaterThreshold</A> greThrBoi(threshold=273.15 + 90) <font color="darkgreen">
    &quot;Threshold for boiler control&quot;</font>;
  <A HREF="../../msl/Modelica_StateGraph2 2.0.1/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Transition"
>Modelica_StateGraph2.Transition</A> T3(use_conditionPort=true,
    delayedTransition=true,
    waitTime=10);
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.GreaterThreshold"
>Modelica.Blocks.Logical.GreaterThreshold</A> greThrTRoo(threshold=273.15 + 21) <font color="darkgreen">
    &quot;Threshold for room temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.GreaterThreshold"
>Modelica.Blocks.Logical.GreaterThreshold</A> greThrTROut(threshold=273.15 + 17) <font color="darkgreen">
    &quot;Threshold for room temperature&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</A> and1;
  <A HREF="../../msl/Modelica_StateGraph2 2.0.1/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Transition"
>Modelica_StateGraph2.Transition</A> T4(use_conditionPort=true,
    delayedTransition=true,
    waitTime=10);
  <A HREF="../../msl/Modelica_StateGraph2 2.0.1/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Step"
>Modelica_StateGraph2.Step</A> pumpsOn(
    nIn=2,
    use_activePort=false,
    nOut=2) <font color="darkgreen">&quot;Pumps are on&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</A> not1 <font color="darkgreen">&quot;Negate output of hysteresis&quot;</font>;</textblock>
<font color="darkgreen">//--------------------------------------------------------------------------------------//</font>

<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(theCon.port_b, vol.heatPort);
  <font color="red">connect</font>(preHea.port, vol.heatPort);
  <font color="red">connect</font>(heaCap.port, vol.heatPort);
  <font color="red">connect</font>(timTab.y[1], preHea.Q_flow);
  <font color="red">connect</font>(temSup.port_b, rad.port_a);
  <font color="red">connect</font>(temRoo.port, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortCon, vol.heatPort);
  <font color="red">connect</font>(rad.heatPortRad, vol.heatPort);
  <font color="red">connect</font>(pumRad.port_b, temSup.port_a);
  <font color="red">connect</font>(boi.port_b, pumBoi.port_a);
  <font color="red">connect</font>(pumBoi.port_b, spl1.port_1);
  <font color="red">connect</font>(spl1.port_2, spl.port_1);
  <font color="red">connect</font>(spl.port_2, valRad.port_1);
  <font color="red">connect</font>(valRad.port_2, mix.port_1);
  <font color="red">connect</font>(spl1.port_3, valBoi.port_3);
  <font color="red">connect</font>(valBoi.port_2, temRet.port_a);
  <font color="red">connect</font>(temRet.port_b, boi.port_a);
  <font color="red">connect</font>(boi.port_a, preSou.ports[1]);
  <font color="red">connect</font>(mix2.port_2, valBoi.port_1);
  <font color="red">connect</font>(spl4.port_2, mix2.port_1);
  <font color="red">connect</font>(spl2.port_2, spl4.port_1);
  <font color="red">connect</font>(valRad.port_3, spl4.port_3);
  <font color="red">connect</font>(spl.port_3, mix2.port_3);
  <font color="red">connect</font>(mix.port_3, spl2.port_3);
  <font color="red">connect</font>(mix.port_2, pumRad.port_a);
  <font color="red">connect</font>(rad.port_b, spl2.port_1);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(booToReaRad2.y, boi.y);
  <font color="red">connect</font>(temRet.T,conPIDBoi. u_s);
  <font color="red">connect</font>(TSetBoiRet.y,conPIDBoi. u_m);
  <font color="red">connect</font>(temRoo.T, TSetSup.u);
  <font color="red">connect</font>(TSetSup.y, conPIDRad.u_s);
  <font color="red">connect</font>(temSup.T, conPIDRad.u_m);
  <font color="red">connect</font>(weaDat.weaBus, weaBus);
  <font color="red">connect</font>(weaBus.TDryBul, TOut.T);
  <font color="red">connect</font>(TOut.port, theCon.port_a);
  <font color="red">connect</font>(TOut.port, senTOut.port);
  <font color="red">connect</font>(allOff.outPort[1], T1.inPort);
  <font color="red">connect</font>(temRoo.T, lessThreshold.u);
  <font color="red">connect</font>(lessThreshold1.u, senTOut.T);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(lessThreshold.y, and3.u1);
  <font color="red">connect</font>(lessThreshold1.y, and3.u2);
  <font color="red">connect</font>(T1.conditionPort, and3.y);
  <font color="red">connect</font>(boi.T, lessThreshold2.u);
  <font color="red">connect</font>(lessThreshold2.y, T2.conditionPort);
  <font color="red">connect</font>(T2.outPort, boilerOn.inPort[1]);
  <font color="red">connect</font>(boi.T, greThrBoi.u);
  <font color="red">connect</font>(boilerOn.outPort[1], T3.inPort);
  <font color="red">connect</font>(greThrBoi.y, T3.conditionPort);
  <font color="red">connect</font>(boilerOn.activePort, booToReaRad2.u);
  <font color="red">connect</font>(temRoo.T, greThrTRoo.u);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(senTOut.T, greThrTROut.u);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(greThrTRoo.y, and1.u1);
  <font color="red">connect</font>(greThrTROut.y, and1.u2);
  <font color="red">connect</font>(and1.y, T4.conditionPort);</textblock>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(T1.outPort, pumpsOn.inPort[1]);
  <font color="red">connect</font>(allOff.activePort, not1.u);
  <font color="red">connect</font>(not1.y, booToReaRad.u);
  <font color="red">connect</font>(not1.y, booToReaRad1.u);
  <font color="red">connect</font>(T3.outPort, pumpsOn.inPort[2]);
  <font color="red">connect</font>(T4.outPort, allOff.inPort[1]);
  <font color="red">connect</font>(pumpsOn.outPort[1], T4.inPort);
  <font color="red">connect</font>(pumpsOn.outPort[2], T2.inPort);
  <font color="red">connect</font>(conPIDRad.y, valRad.y);
  <font color="red">connect</font>(booToReaRad.y, pumRad.m_flow_in);
  <font color="red">connect</font>(conPIDBoi.y, valBoi.y);
  <font color="red">connect</font>(booToReaRad1.y, pumBoi.m_flow_in);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>System7;
</PRE>
<HR>
<address><a href="http://www.3ds.com/">Automatically generated</a> Thu Oct 24 15:14:17 2013.
</address></BODY>
</HTML>
