<HTML>
<HEAD>
<TITLE>Buildings.Fluid.Storage</TITLE>
<META name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META name="description" content="&quot;Package with thermal energy storage models&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- --- header ------ -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- --- end header -- -->
</P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Storage<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Buildings.Fluid.Storage"></A><A HREF="Buildings_Fluid.html#Buildings.Fluid"
>Buildings.Fluid</A>.Storage</H2>
<B>Package with thermal energy storage models</B>
<P></P>
<P></P><H3>Information</H3>

This package contains thermal energy storage models.
<P></P>
Extends from <A HREF="../../msl/3.2/help/Modelica_Icons_VariantsPackage.html#Modelica.Icons.VariantsPackage"
>Modelica.Icons.VariantsPackage</A> (Icon for package containing variants).
<P></P><H3>Package Content</H3>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.ExpansionVesselS.png" ALT="Buildings.Fluid.Storage.ExpansionVessel" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.ExpansionVessel"
>ExpansionVessel</A>
</TD><TD>Pressure expansion vessel with fixed gas cushion</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.StratifiedS.png" ALT="Buildings.Fluid.Storage.Stratified" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.Stratified"
>Stratified</A>
</TD><TD>Model of a stratified tank for thermal energy storage</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.S0445f3df34178cb6ancedS.png" ALT="Buildings.Fluid.Storage.StratifiedEnhanced" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.StratifiedEnhanced"
>StratifiedEnhanced</A>
</TD><TD>Stratified tank model with enhanced discretization</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.Sfc3500fb0014ae2aalHexS.png" ALT="Buildings.Fluid.Storage.StratifiedEnhancedInternalHex" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.StratifiedEnhancedInternalHex"
>StratifiedEnhancedInternalHex</A>
</TD><TD>A model of a water storage tank with a secondary loop and intenral heat exchanger</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.ExamplesS.png" ALT="Buildings.Fluid.Storage.Examples" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage_Examples.html#Buildings.Fluid.Storage.Examples"
>Examples</A>
</TD><TD>Collection of models that illustrate model use and test models</TD></TR>
<TR><TD><IMG SRC="Buildings.Fluid.Storage.BaseClassesS.png" ALT="Buildings.Fluid.Storage.BaseClasses" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses"
>BaseClasses</A>
</TD><TD>Package with base classes for Buildings.Fluid.Storage</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE ExpansionVessel<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Storage.ExpansionVesselI.png" ALT="Buildings.Fluid.Storage.ExpansionVessel" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Storage.ExpansionVessel"></A><A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage"
>Buildings.Fluid.Storage</A>.ExpansionVessel</H2>
<B>Pressure expansion vessel with fixed gas cushion</B><p></P>
<IMG SRC="Buildings.Fluid.Storage.ExpansionVesselD.png" ALT="Buildings.Fluid.Storage.ExpansionVessel">
<P></P><H3>Information</H3>

<p>
This is a model of a pressure expansion vessel. The vessel has a fixed total volume. 
A fraction of the volume is occupied by a fixed mass of gas, and the other fraction is occupied 
by the liquid that flows through the port.
The pressure <code>p</code> in the vessel is
</p>
<pre>
 VGas0 * p_start = (VTot-VLiquid) * p
</pre>
<p>
where <code>VGas0</code> is the initial volume occupied by the gas, 
<code>p_start</code> is the initial pressure,
<code>VTot</code> is the total volume of the vessel and
<code>VLiquid</code> is the amount of liquid in the vessel.
</p>
<p>
Optionally, a heat port can be activated by setting <code>use_HeatTransfer=true</code>.
This heat port connects directly to the liquid. The gas does not participate in the energy 
balance.
</p>
<p>
The expansion vessel needs to be used in closed loops that contain
water to set a reference pressure and, for liquids where the
density is modeled as a function of temperature, to allow for
the thermal expansion of the liquid.
</p>
<p>
Note that alternatively, the model
<A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>
Buildings.Fluid.Sources.FixedBoundary</a> may be used to set 
a reference pressure. The main difference between these two models
is that in this model, there is an energy and mass balance for the volume.
In contrast, for
<A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>
Buildings.Fluid.Sources.FixedBoundary</a>, 
any mass flow rate that flows out of the model will be at a user-specified temperature.
Therefore, <A HREF="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>
Buildings.Fluid.Sources.FixedBoundary</a> leads to smaller systems
of equations, which may result in faster simulation.
</p>
<P></P>
Extends from <A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.LumpedVolumeDeclarations"
>Buildings.Fluid.Interfaces.LumpedVolumeDeclarations</A> (Declarations for lumped volumes).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>VTot</TD><TD>&nbsp;</TD><TD>Total volume of vessel (water and gas side) [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>VGas0</TD><TD>VTot/2</TD><TD>Initial volume of gas [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>pMax</TD><TD>5E5</TD><TD>Maximum pressure before simulation stops with an error [Pa]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Equations</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>energyDynamics</TD><TD>Modelica.Fluid.Types.Dynamic...</TD><TD>Formulation of energy balance</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>massDynamics</TD><TD>energyDynamics</TD><TD>Formulation of mass balance</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Initialization</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>AbsolutePressure</A></TD><TD>p_start</TD><TD>Medium.p_default</TD><TD>Start value of pressure [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_start</TD><TD>Medium.T_default</TD><TD>Start value of temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>MassFraction</A></TD><TD>X_start[Medium.nX]</TD><TD>Medium.X_default</TD><TD>Start value of mass fractions m_i/m [kg/kg]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_start[Medium.nC]</TD><TD>fill(0, Medium.nC)</TD><TD>Start value of trace substances</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_nominal[Medium.nC]</TD><TD>fill(1E-2, Medium.nC)</TD><TD>Nominal value of trace substances. (Set to typical order of magnitude.)</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_a</TD><TD>Fluid port</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> ExpansionVessel <font color="darkgreen">
  &quot;Pressure expansion vessel with fixed gas cushion&quot;</font>
 <font color="blue">extends </font><A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.LumpedVolumeDeclarations"
>Buildings.Fluid.Interfaces.LumpedVolumeDeclarations</A>;
 <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> VTot <font color="darkgreen">
    &quot;Total volume of vessel (water and gas side)&quot;</font>;
 <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> VGas0 = VTot/2 <font color="darkgreen">&quot;Initial volume of gas&quot;</font>;

<font color="darkgreen">//////////////////////////////////////////////////////////////</font>
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>Modelica.Fluid.Interfaces.FluidPort_a</A> port_a(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium) <font color="darkgreen">&quot;Fluid port&quot;</font>;</textblock>

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Modelica.SIunits.Pressure</A> pMax = 5E5 <font color="darkgreen">
    &quot;Maximum pressure before simulation stops with an error&quot;</font>;

 <A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> VLiq <font color="darkgreen">&quot;Volume of liquid in the vessel&quot;</font>;
  <font color="darkgreen">// We set m(start=(VTot-VGas0)*1000, stateSelect=StateSelect.always)</font>
  <font color="darkgreen">// since the mass accumulated in the volume should be a state.</font>
  <font color="darkgreen">// This often leads to smaller systems of equations.</font>
<textblock type="annotcomp" expanded="false"><font color="blue">protected </font>
  <A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.ConservationEquation"
>Buildings.Fluid.Interfaces.ConservationEquation</A> vol(
    <font color="blue">redeclare </font><font color="blue">final </font><font color="blue">package</font> Medium = Medium,
    m(start=(VTot-VGas0)*1000, stateSelect=StateSelect.always),
    <font color="blue">final </font>nPorts=1,
    <font color="blue">final </font>energyDynamics=energyDynamics,
    <font color="blue">final </font>massDynamics=massDynamics,
    <font color="blue">final </font>p_start=p_start,
    <font color="blue">final </font>T_start=T_start,
    <font color="blue">final </font>X_start=X_start,
    <font color="blue">final </font>C_start=C_start,
    <font color="blue">final </font>C_nominal=C_nominal,
    <font color="blue">final </font>fluidVolume = VLiq) <font color="darkgreen">
    &quot;Model for mass and energy balance of water in expansion vessel&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> heaInp(<font color="blue">final </font>k=0) <font color="darkgreen">
    &quot;Block to set heat input into volume&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</A> masExc(<font color="blue">final </font>k=0) <font color="darkgreen">
    &quot;Block to set mass exchange in volume&quot;</font>;</textblock>
<font color="blue">equation </font>
  <font color="red">assert</font>(port_a.p &lt; pMax, &quot;Pressure exceeds maximum pressure.\n&quot; +
       &quot;You may need to increase VTot of the ExpansionVessel.&quot;);

  <font color="darkgreen">// Water content and pressure</font>
  port_a.p * (VTot-VLiq) = p_start * VGas0;

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(heaInp.y, vol.Q_flow);
  <font color="red">connect</font>(port_a, vol.ports[1]);
  <font color="red">connect</font>(masExc.y, vol.mWat_flow);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>ExpansionVessel;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Stratified<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Storage.StratifiedI.png" ALT="Buildings.Fluid.Storage.Stratified" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Storage.Stratified"></A><A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage"
>Buildings.Fluid.Storage</A>.Stratified</H2>
<B>Model of a stratified tank for thermal energy storage</B><p></P>
<IMG SRC="Buildings.Fluid.Storage.StratifiedD.png" ALT="Buildings.Fluid.Storage.Stratified">
<P></P><H3>Information</H3>

<p>
This is a model of a stratified storage tank.
The tank uses several volumes to model the stratification.
Heat conduction is modeled between the volumes through the fluid,
and between the volumes and the ambient.
The port <code>heaPorVol</code> may be used to connect a temperature sensor
that measures the fluid temperature of an individual volume. It may also
be used to add heat to individual volumes.
</p>
<p>
The tank has <code>nSeg</code> fluid volumes. The top volume has the index <code>1</code>.
Thus, to add a heating element to the bottom element, connect a heat input to
<code>heaPorVol[nSeg]</code>.
</p>
<p>
The heat ports outside the tank insulation can be 
used to specify an ambient temperature.
Leave these ports unconnected to force adiabatic boundary conditions.
Note, however, that all heat conduction elements through the tank wall (but not the top and bottom) are connected to the 
heat port <code>heaPorSid</code>. Thus, not connecting
<code>heaPorSid</code> means an adiabatic boundary condition in the sense 
that <code>heaPorSid.Q_flow = 0</code>. This, however, still allows heat to flow
through the tank walls, modelled by <code>conWal</code>, from one fluid volume
to another one.
</p>
<p>
For a model with enhanced stratification, use
<A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.StratifiedEnhanced"
>
Buildings.Fluid.Storage.StratifiedEnhanced</a>.
</p>
<P></P>
Extends from <A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.PartialTwoPortInterface"
>Buildings.Fluid.Interfaces.PartialTwoPortInterface</A> (Partial model transporting fluid between two ports without storing mass or energy).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>VTan</TD><TD>&nbsp;</TD><TD>Tank volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</A></TD><TD>hTan</TD><TD>&nbsp;</TD><TD>Height of tank (without insulation) [m]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</A></TD><TD>dIns</TD><TD>&nbsp;</TD><TD>Thickness of insulation [m]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.ThermalConductivity"
>ThermalConductivity</A></TD><TD>kIns</TD><TD>0.04</TD><TD>Specific heat conductivity of insulation [W/(m.K)]</TD></TR>
<TR><TD>Integer</TD><TD>nSeg</TD><TD>2</TD><TD>Number of volume segments</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>tau</TD><TD>1</TD><TD>Time constant for mixing due to temperature inversion [s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Initialization</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow.start</TD><TD>0</TD><TD>Mass flow rate from port_a to port_b (m_flow &gt; 0 is design flow direction) [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dp.start</TD><TD>0</TD><TD>Pressure difference between port_a and port_b [Pa]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Assumptions</B></TD></TR>
<TR><TD>Boolean</TD><TD>allowFlowReversal</TD><TD>system.allowFlowReversal</TD><TD>= true to allow flow reversal, false restricts to design direction (port_a -&gt; port_b)</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Advanced</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_small</TD><TD>1E-4*abs(m_flow_nominal)</TD><TD>Small mass flow rate for regularization of zero flow [kg/s]</TD></TR>
<TR><TD>Boolean</TD><TD>homotopyInitialization</TD><TD>true</TD><TD>= true, use homotopy method</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Diagnostics</TD></TR>
<TR><TD>Boolean</TD><TD>show_T</TD><TD>false</TD><TD>= true, if actual temperature at port is computed</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Equations</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>energyDynamics</TD><TD>system.energyDynamics</TD><TD>Formulation of energy balance</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>massDynamics</TD><TD>energyDynamics</TD><TD>Formulation of mass balance</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Initialization</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>AbsolutePressure</A></TD><TD>p_start</TD><TD>Medium.p_default</TD><TD>Start value of pressure [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_start</TD><TD>Medium.T_default</TD><TD>Start value of temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>MassFraction</A></TD><TD>X_start[Medium.nX]</TD><TD>Medium.X_default</TD><TD>Start value of mass fractions m_i/m [kg/kg]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_start[Medium.nC]</TD><TD>fill(0, Medium.nC)</TD><TD>Start value of trace substances</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_a</TD><TD>Fluid connector a (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>port_b</TD><TD>Fluid connector b (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorVol[nSeg]</TD><TD>Heat port of fluid volumes</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorSid</TD><TD>Heat port tank side (outside insulation)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorTop</TD><TD>Heat port tank top (outside insulation)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorBot</TD><TD>Heat port tank bottom (outside insulation). Leave unconnected for adiabatic condition</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>Ql_flow</TD><TD>Heat loss of tank (positive if heat flows from tank to ambient)</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> Stratified <font color="darkgreen">
  &quot;Model of a stratified tank for thermal energy storage&quot;</font>
  <font color="blue">extends </font><A HREF="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.PartialTwoPortInterface"
>Buildings.Fluid.Interfaces.PartialTwoPortInterface</A>(
      showDesignFlowDirection=false);

  <font color="blue">replaceable </font><font color="blue">package</font> Medium =
      <A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialSimpleMedium.html#Modelica.Media.Interfaces.PartialSimpleMedium"
>Modelica.Media.Interfaces.PartialSimpleMedium</A>;
  <font color="blue">import </font><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types"
>Modelica.Fluid.Types</A>;
  <font color="blue">import </font><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Modelica.Fluid.Types.Dynamics</A>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> VTan <font color="darkgreen">&quot;Tank volume&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</A> hTan <font color="darkgreen">&quot;Height of tank (without insulation)&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</A> dIns <font color="darkgreen">&quot;Thickness of insulation&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.ThermalConductivity"
>Modelica.SIunits.ThermalConductivity</A> kIns = 0.04 <font color="darkgreen">
    &quot;Specific heat conductivity of insulation&quot;</font>;
  <font color="blue">parameter </font>Integer nSeg(min=2) = 2 <font color="darkgreen">&quot;Number of volume segments&quot;</font>;

  <font color="darkgreen">////////////////////////////////////////////////////////////////////</font>
  <font color="darkgreen">// Assumptions</font>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Types.Dynamics</A> energyDynamics=system.energyDynamics <font color="darkgreen">
    &quot;Formulation of energy balance&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Types.Dynamics</A> massDynamics=energyDynamics <font color="darkgreen">
    &quot;Formulation of mass balance&quot;</font>;

  <font color="darkgreen">// Initialization</font>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>Medium.AbsolutePressure</A> p_start = Medium.p_default <font color="darkgreen">
    &quot;Start value of pressure&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Medium.Temperature</A> T_start=Medium.T_default <font color="darkgreen">
    &quot;Start value of temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>Medium.MassFraction</A> X_start[Medium.nX] = Medium.X_default <font color="darkgreen">
    &quot;Start value of mass fractions m_i/m&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>Medium.ExtraProperty</A> C_start[Medium.nC](
       quantity=Medium.extraPropertiesNames)=<font color="red">fill</font>(0, Medium.nC) <font color="darkgreen">
    &quot;Start value of trace substances&quot;</font>;

  <font color="darkgreen">////////////////////////////////////////////////////////////////////</font>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>MixingVolumes.MixingVolume</A>[nSeg] vol(
    <font color="blue">redeclare </font><font color="blue">each </font><font color="blue">package</font> Medium = Medium,
    <font color="blue">each </font>energyDynamics=energyDynamics,
    <font color="blue">each </font>massDynamics=massDynamics,
    <font color="blue">each </font>p_start=p_start,
    <font color="blue">each </font>T_start=T_start,
    <font color="blue">each </font>X_start=X_start,
    <font color="blue">each </font>C_start=C_start,
    <font color="blue">each </font>V=VTan/nSeg,
    <font color="blue">each </font>nPorts=nPorts,
    <font color="blue">each </font>m_flow_nominal = m_flow_nominal) <font color="darkgreen">&quot;Tank segment&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.EnthalpyFlowRate"
>Sensors.EnthalpyFlowRate</A> hA_flow(<font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium,
      m_flow_nominal=m_flow_nominal) <font color="darkgreen">&quot;Enthalpy flow rate at port a&quot;</font>;
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.EnthalpyFlowRate"
>Sensors.EnthalpyFlowRate</A>[nSeg-1] hVol_flow(<font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium,
      <font color="blue">each </font>m_flow_nominal=m_flow_nominal);
  <A HREF="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.EnthalpyFlowRate"
>Sensors.EnthalpyFlowRate</A> hB_flow(<font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium,
      m_flow_nominal=m_flow_nominal) <font color="darkgreen">&quot;Enthalpy flow rate at port b&quot;</font>;
  <A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.Buoyancy"
>BaseClasses.Buoyancy</A> buo(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium,
    V=VTan,
    nSeg=nSeg,
    tau=tau) <font color="darkgreen">&quot;Model to prevent unstable tank stratification&quot;</font>;</textblock>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> tau=1 <font color="darkgreen">
    &quot;Time constant for mixing due to temperature inversion&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A>[
                                                 nSeg - 1] conFlu(<font color="blue">each </font>G=
        conFluSeg) <font color="darkgreen">&quot;Thermal conductance in fluid between the segments&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A>[
                                                 nSeg] conWal(
     <font color="blue">each </font>G=2*Modelica.Constants.pi*kIns*hSeg/<font color="red">Modelica.Math.log</font>((rTan+dIns)/rTan)) <font color="darkgreen">
    &quot;Thermal conductance through tank wall&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A> conTop(
     G=conTopSeg) <font color="darkgreen">&quot;Thermal conductance through tank top&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</A> conBot(
     G=conTopSeg) <font color="darkgreen">&quot;Thermal conductance through tank bottom&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</A>[nSeg] heaPorVol <font color="darkgreen">
    &quot;Heat port of fluid volumes&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</A> heaPorSid <font color="darkgreen">
    &quot;Heat port tank side (outside insulation)&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.HeatFlowSensor"
>Modelica.Thermal.HeatTransfer.Sensors.HeatFlowSensor</A> heaFloSid[
                                                         nSeg] <font color="darkgreen">
    &quot;Heat flow at wall of tank (outside insulation)&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</A> heaPorTop <font color="darkgreen">
    &quot;Heat port tank top (outside insulation)&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.HeatFlowSensor"
>Modelica.Thermal.HeatTransfer.Sensors.HeatFlowSensor</A> heaFloTop <font color="darkgreen">
    &quot;Heat flow at top of tank (outside insulation)&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</A> heaPorBot <font color="darkgreen">
    &quot;Heat port tank bottom (outside insulation). Leave unconnected for adiabatic condition&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.HeatFlowSensor"
>Modelica.Thermal.HeatTransfer.Sensors.HeatFlowSensor</A> heaFloBot <font color="darkgreen">
    &quot;Heat flow at bottom of tank (outside insulation)&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> Ql_flow <font color="darkgreen">
    &quot;Heat loss of tank (positive if heat flows from tank to ambient)&quot;</font>;</textblock>

<font color="blue">protected </font>
  <font color="blue">constant </font>Integer nPorts = 2 <font color="darkgreen">&quot;Number of ports of volume&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</A> hSeg = hTan / nSeg <font color="darkgreen">
    &quot;Height of a tank segment&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Modelica.SIunits.Area</A> ATan = VTan/hTan <font color="darkgreen">
    &quot;Tank cross-sectional area (without insulation)&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</A> rTan =<font color="red"> sqrt</font>(ATan/Modelica.Constants.pi) <font color="darkgreen">
    &quot;Tank diameter (without insulation)&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.ThermalConductance"
>Modelica.SIunits.ThermalConductance</A> conFluSeg = ATan*Medium.lambda_const/hSeg <font color="darkgreen">
    &quot;Thermal conductance between fluid volumes&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.ThermalConductance"
>Modelica.SIunits.ThermalConductance</A> conTopSeg = ATan*kIns/dIns <font color="darkgreen">
    &quot;Thermal conductance from center of top (or bottom) volume through tank insulation at top (or bottom)&quot;</font>;

<textblock type="annotcomp" expanded="false"><font color="blue">protected </font>
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Routing.html#Modelica.Blocks.Routing.Multiplex3"
>Modelica.Blocks.Routing.Multiplex3</A> mul(
    n1=1,
    n2=nSeg,
    n3=1);
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Sum"
>Modelica.Blocks.Math.Sum</A> sum1(nin=nSeg + 2);
<font color="blue">public </font>
  <A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalCollector"
>Modelica.Thermal.HeatTransfer.Components.ThermalCollector</A> theCol(m=nSeg) <font color="darkgreen">
    &quot;Connector to assign multiple heat ports to one heat port&quot;</font>;</textblock>
<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(hA_flow.port_b, vol[1].ports[1]);
  <font color="red">connect</font>(vol[nSeg].ports[2], hB_flow.port_a);
  <font color="red">connect</font>(hB_flow.port_b, port_b);</textblock>
  <font color="blue">for </font>i<font color="blue"> in </font>1:(nSeg-1)<font color="blue"> loop</font>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(vol[i].ports[2], hVol_flow[i].port_a);
  <font color="red">connect</font>(hVol_flow[i].port_b, vol[i+1].ports[1]);</textblock>
  <font color="blue">end for</font>;
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(port_a, hA_flow.port_a);
  <font color="red">connect</font>(buo.heatPort, vol.heatPort);</textblock>
  <font color="blue">for </font>i<font color="blue"> in </font>1:nSeg-1<font color="blue"> loop</font>
  <font color="darkgreen">// heat conduction between fluid nodes</font>
<textblock type="annotconnect" expanded="false">    <font color="red"> connect</font>(vol[i].heatPort, conFlu[i].port_a);
    <font color="red">connect</font>(vol[i+1].heatPort, conFlu[i].port_b);</textblock>
  <font color="blue">end for</font>;
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(vol[1].heatPort, conTop.port_a);
  <font color="red">connect</font>(vol.heatPort, conWal.port_a);
  <font color="red">connect</font>(conBot.port_a, vol[nSeg].heatPort);
  <font color="red">connect</font>(vol.heatPort, heaPorVol);
  <font color="red">connect</font>(conWal.port_b, heaFloSid.port_a);</textblock>
  <font color="blue">for </font>i<font color="blue"> in </font>1:nSeg<font color="blue"> loop</font>

  <font color="blue">end for</font>;

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(conTop.port_b, heaFloTop.port_a);
  <font color="red">connect</font>(conBot.port_b, heaFloBot.port_a);
  <font color="red">connect</font>(heaFloTop.port_b, heaPorTop);
  <font color="red">connect</font>(heaFloBot.port_b, heaPorBot);
  <font color="red">connect</font>(heaFloTop.Q_flow, mul.u1[1]);
  <font color="red">connect</font>(heaFloSid.Q_flow, mul.u2);
  <font color="red">connect</font>(heaFloBot.Q_flow, mul.u3[1]);
  <font color="red">connect</font>(mul.y, sum1.u);
  <font color="red">connect</font>(sum1.y, Ql_flow);
  <font color="red">connect</font>(heaFloSid.port_b, theCol.port_a);
  <font color="red">connect</font>(theCol.port_b, heaPorSid);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>Stratified;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE StratifiedEnhanced<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Storage.S0445f3df34178cb6ancedI.png" ALT="Buildings.Fluid.Storage.StratifiedEnhanced" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Storage.StratifiedEnhanced"></A><A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage"
>Buildings.Fluid.Storage</A>.StratifiedEnhanced</H2>
<B>Stratified tank model with enhanced discretization</B><p></P>
<IMG SRC="Buildings.Fluid.Storage.S0445f3df34178cb6ancedD.png" ALT="Buildings.Fluid.Storage.StratifiedEnhanced">
<P></P><H3>Information</H3>

<p>
This is a model of a stratified storage tank for thermal energy storage.
The model is identical to
<A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.Stratified"
>
Buildings.Fluid.Storage.Stratified</a>, 
except that it adds a correction that reduces the numerical
dissipation.
The correction uses a third order upwind scheme to compute the 
outlet temperatures of the segments in the tank. This model
is implemented in
<A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier"
>
Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier</a>.
</p>
<h4>Limitations</h4>
<p>
The model requires at least 4 fluid segments. Hence, set <code>nSeg</code> to 4 or higher.
</p>
<P></P>
Extends from <A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.Stratified"
>Stratified</A> (Model of a stratified tank for thermal energy storage).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>VTan</TD><TD>&nbsp;</TD><TD>Tank volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</A></TD><TD>hTan</TD><TD>&nbsp;</TD><TD>Height of tank (without insulation) [m]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</A></TD><TD>dIns</TD><TD>&nbsp;</TD><TD>Thickness of insulation [m]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.ThermalConductivity"
>ThermalConductivity</A></TD><TD>kIns</TD><TD>0.04</TD><TD>Specific heat conductivity of insulation [W/(m.K)]</TD></TR>
<TR><TD>Integer</TD><TD>nSeg</TD><TD>4</TD><TD>Number of volume segments</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>tau</TD><TD>1</TD><TD>Time constant for mixing due to temperature inversion [s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Initialization</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow.start</TD><TD>0</TD><TD>Mass flow rate from port_a to port_b (m_flow &gt; 0 is design flow direction) [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dp.start</TD><TD>0</TD><TD>Pressure difference between port_a and port_b [Pa]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Assumptions</B></TD></TR>
<TR><TD>Boolean</TD><TD>allowFlowReversal</TD><TD>system.allowFlowReversal</TD><TD>= true to allow flow reversal, false restricts to design direction (port_a -&gt; port_b)</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Advanced</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_small</TD><TD>1E-4*abs(m_flow_nominal)</TD><TD>Small mass flow rate for regularization of zero flow [kg/s]</TD></TR>
<TR><TD>Boolean</TD><TD>homotopyInitialization</TD><TD>true</TD><TD>= true, use homotopy method</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Diagnostics</TD></TR>
<TR><TD>Boolean</TD><TD>show_T</TD><TD>false</TD><TD>= true, if actual temperature at port is computed</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Equations</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>energyDynamics</TD><TD>system.energyDynamics</TD><TD>Formulation of energy balance</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>massDynamics</TD><TD>energyDynamics</TD><TD>Formulation of mass balance</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Initialization</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>AbsolutePressure</A></TD><TD>p_start</TD><TD>Medium.p_default</TD><TD>Start value of pressure [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_start</TD><TD>Medium.T_default</TD><TD>Start value of temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>MassFraction</A></TD><TD>X_start[Medium.nX]</TD><TD>Medium.X_default</TD><TD>Start value of mass fractions m_i/m [kg/kg]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_start[Medium.nC]</TD><TD>fill(0, Medium.nC)</TD><TD>Start value of trace substances</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_a</TD><TD>Fluid connector a (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>port_b</TD><TD>Fluid connector b (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorVol[nSeg]</TD><TD>Heat port of fluid volumes</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorSid</TD><TD>Heat port tank side (outside insulation)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorTop</TD><TD>Heat port tank top (outside insulation)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorBot</TD><TD>Heat port tank bottom (outside insulation). Leave unconnected for adiabatic condition</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>Ql_flow</TD><TD>Heat loss of tank (positive if heat flows from tank to ambient)</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> StratifiedEnhanced <font color="darkgreen">
  &quot;Stratified tank model with enhanced discretization&quot;</font>
  <font color="blue">extends </font><A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.Stratified"
>Stratified</A>(nSeg=4, nPorts=3, vol(<font color="blue">each </font>prescribedHeatFlowRate=true));
<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier"
>BaseClasses.ThirdOrderStratifier</A> str(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium,
    nSeg=nSeg,
    m_flow_small=m_flow_small) <font color="darkgreen">&quot;Model to reduce numerical dissipation&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.RealExpression"
>Modelica.Blocks.Sources.RealExpression</A> mTan_flow(y=port_a.m_flow) <font color="darkgreen">
    &quot;Mass flow rate at port a&quot;</font>;</textblock>
<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(vol[1:nSeg].ports[3], str.fluidPort[2:nSeg+1]);
  <font color="red">connect</font>(hA_flow.H_flow, str.H_flow[1]);
  <font color="red">connect</font>(hVol_flow[1:nSeg-1].H_flow, str.H_flow[2:nSeg]);
  <font color="red">connect</font>(hB_flow.H_flow, str.H_flow[nSeg + 1]);
  <font color="red">connect</font>(str.heatPort, vol.heatPort);
  <font color="red">connect</font>(port_a, str.fluidPort[1]);
  <font color="red">connect</font>(port_b, str.fluidPort[nSeg + 2]);
  <font color="red">connect</font>(mTan_flow.y, str.m_flow);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>StratifiedEnhanced;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE StratifiedEnhancedInternalHex<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Buildings.Fluid.Storage.Sfc3500fb0014ae2aalHexI.png" ALT="Buildings.Fluid.Storage.StratifiedEnhancedInternalHex" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Buildings.Fluid.Storage.StratifiedEnhancedInternalHex"></A><A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage"
>Buildings.Fluid.Storage</A>.StratifiedEnhancedInternalHex</H2>
<B>A model of a water storage tank with a secondary loop and intenral heat exchanger</B><p></P>
<IMG SRC="Buildings.Fluid.Storage.Sfc3500fb0014ae2aalHexD.png" ALT="Buildings.Fluid.Storage.StratifiedEnhancedInternalHex">
<P></P><H3>Information</H3>

            This model is an extension of 
            <A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.StratifiedEnhanced"
>Buildings.Fluid.Storage.StratifiedEnhanced</a>.<br/>
            <p>
            The modifications consist of adding a heat exchanger 
            (<A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger"
>
            Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger</a>) and fluid ports to connect to the heat exchanger.
            The modifications allow to run a fluid through the tank causing heat transfer to the stored fluid. 
            A typical example is a storage tank in a solar hot water system.
            </p>
            <p>
            The heat exchanger model assumes flow through the inside of a helical coil heat exchanger, 
            and stagnant fluid on the outside. Parameters are used to describe the 
            heat transfer on the inside of the heat exchanger at nominal conditions, and 
            geometry of the outside of the heat exchanger. This information is used to compute 
            an <i>hA</i>-value for each side of the coil. Convection calculations are then performed to identify heat transfer 
            between the heat transfer fluid and the fluid in the tank.
            </p>
            <p>
            Default values describing the heat exchanger are taken from the documentation for a Vitocell 100-B, 300 L tank.
            </p>
            <P></P>
Extends from <A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.StratifiedEnhanced"
>StratifiedEnhanced</A> (Stratified tank model with enhanced discretization).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>VTan</TD><TD>&nbsp;</TD><TD>Tank volume [m3]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</A></TD><TD>hTan</TD><TD>&nbsp;</TD><TD>Height of tank (without insulation) [m]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</A></TD><TD>dIns</TD><TD>&nbsp;</TD><TD>Thickness of insulation [m]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.ThermalConductivity"
>ThermalConductivity</A></TD><TD>kIns</TD><TD>0.04</TD><TD>Specific heat conductivity of insulation [W/(m.K)]</TD></TR>
<TR><TD>Integer</TD><TD>nSeg</TD><TD>4</TD><TD>Number of volume segments</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>tau</TD><TD>1</TD><TD>Time constant for mixing due to temperature inversion [s]</TD></TR>
<TR><TD>Integer</TD><TD>topHexSeg</TD><TD>integer(ceil(hexTopHeight/se...</TD><TD>Segment the top of the heat exchanger is located in</TD></TR>
<TR><TD>Integer</TD><TD>botHexSeg</TD><TD>integer(hexBotHeight/segHeig...</TD><TD>Segment the bottom of the heat exchanger is located in</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Nominal condition</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate [kg/s]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Initialization</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow.start</TD><TD>0</TD><TD>Mass flow rate from port_a to port_b (m_flow &gt; 0 is design flow direction) [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dp.start</TD><TD>0</TD><TD>Pressure difference between port_a and port_b [Pa]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Heat exchanger</TD></TR>
<TR><TD colspan="2">replaceable package MediumHex</TD><TD>Modelica.Media.Interfaces.Pa...</TD><TD>Medium in the heat exchanger loop</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Height"
>Height</A></TD><TD>hexTopHeight</TD><TD>&nbsp;</TD><TD>Height of the top of the heat exchanger [m]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Height"
>Height</A></TD><TD>hexBotHeight</TD><TD>&nbsp;</TD><TD>Height of the bottom of the heat exchanger [m]</TD></TR>
<TR><TD>Integer</TD><TD>hexSegMult</TD><TD>2</TD><TD>Number of heat exchanger segments in each tank segment</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatCapacity"
>HeatCapacity</A></TD><TD>CHex</TD><TD>25.163</TD><TD>Capacitance of the heat exchanger [J/K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</A></TD><TD>Q_flow_nominal</TD><TD>&nbsp;</TD><TD>Heat transfer at nominal conditions [W]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>TTan_nominal</TD><TD>&nbsp;</TD><TD>Temperature of fluid inside the tank at nominal heat transfer conditions [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>THex_nominal</TD><TD>&nbsp;</TD><TD>Temperature of fluid inside the heat exchanger at nominal heat transfer conditions [K]</TD></TR>
<TR><TD>Real</TD><TD>r_nominal</TD><TD>0.5</TD><TD>Ratio between coil inside and outside convective heat transfer at nominal heat transfer conditions</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>mHex_flow_nominal</TD><TD>&nbsp;</TD><TD>Nominal mass flow rate through the heat exchanger [kg/s]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Diameter"
>Diameter</A></TD><TD>dExtHex</TD><TD>0.025</TD><TD>Exterior diameter of the heat exchanger pipe [m]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</A></TD><TD>dpHex_nominal</TD><TD>2500</TD><TD>Pressure drop across the heat exchanger at nominal conditions [Pa]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Assumptions</B></TD></TR>
<TR><TD>Boolean</TD><TD>allowFlowReversal</TD><TD>system.allowFlowReversal</TD><TD>= true to allow flow reversal, false restricts to design direction (port_a -&gt; port_b)</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Advanced</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_small</TD><TD>1E-4*abs(m_flow_nominal)</TD><TD>Small mass flow rate for regularization of zero flow [kg/s]</TD></TR>
<TR><TD>Boolean</TD><TD>homotopyInitialization</TD><TD>true</TD><TD>= true, use homotopy method</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Diagnostics</TD></TR>
<TR><TD>Boolean</TD><TD>show_T</TD><TD>false</TD><TD>= true, if actual temperature at port is computed</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Equations</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>energyDynamics</TD><TD>system.energyDynamics</TD><TD>Formulation of energy balance</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>massDynamics</TD><TD>energyDynamics</TD><TD>Formulation of mass balance</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Initialization</B></TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>AbsolutePressure</A></TD><TD>p_start</TD><TD>Medium.p_default</TD><TD>Start value of pressure [Pa]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_start</TD><TD>Medium.T_default</TD><TD>Start value of temperature [K]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>MassFraction</A></TD><TD>X_start[Medium.nX]</TD><TD>Medium.X_default</TD><TD>Start value of mass fractions m_i/m [kg/kg]</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_start[Medium.nC]</TD><TD>fill(0, Medium.nC)</TD><TD>Start value of trace substances</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Dynamics heat exchanger</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Equations</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>energyDynamicsHex</TD><TD>Modelica.Fluid.Types.Dynamic...</TD><TD>Formulation of energy balance</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>massDynamicsHex</TD><TD>energyDynamicsHex</TD><TD>Formulation of mass balance</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Flow resistance heat exchanger</B></TD></TR>
<TR><TD>Boolean</TD><TD>computeFlowResistance</TD><TD>true</TD><TD>=true, compute flow resistance. Set to false to assume no friction</TD></TR>
<TR><TD>Boolean</TD><TD>from_dp</TD><TD>false</TD><TD>= true, use m_flow = f(dp) else dp = f(m_flow)</TD></TR>
<TR><TD>Boolean</TD><TD>linearizeFlowResistance</TD><TD>false</TD><TD>= true, use linear relation between m_flow and dp for any flow rate</TD></TR>
<TR><TD>Real</TD><TD>deltaM</TD><TD>0.1</TD><TD>Fraction of nominal flow rate where flow transitions to laminar</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_a</TD><TD>Fluid connector a (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>port_b</TD><TD>Fluid connector b (positive design flow direction is from port_a to port_b)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorVol[nSeg]</TD><TD>Heat port of fluid volumes</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorSid</TD><TD>Heat port tank side (outside insulation)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorTop</TD><TD>Heat port tank top (outside insulation)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heaPorBot</TD><TD>Heat port tank bottom (outside insulation). Leave unconnected for adiabatic condition</TD></TR>
<TR><TD>output <A HREF="../../msl/3.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>Ql_flow</TD><TD>Heat loss of tank (positive if heat flows from tank to ambient)</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port_a1</TD><TD>Heat exchanger inlet</TD></TR>
<TR><TD><A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>port_b1</TD><TD>Heat exchanger outlet</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=3>Heat exchanger</TD></TR>
<TR><TD colspan="2">replaceable package MediumHex</TD><TD>Medium in the heat exchanger loop</TD></TR>
</TABLE>
<P></P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> StratifiedEnhancedInternalHex <font color="darkgreen">
  &quot;A model of a water storage tank with a secondary loop and intenral heat exchanger&quot;</font>
  <font color="blue">extends </font><A HREF="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.StratifiedEnhanced"
>StratifiedEnhanced</A>;

  <font color="blue">replaceable </font><font color="blue">package</font> MediumHex =
      <A HREF="../../msl/3.2/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>Modelica.Media.Interfaces.PartialMedium</A> <font color="darkgreen">
    &quot;Medium in the heat exchanger loop&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Height"
>Modelica.SIunits.Height</A> hexTopHeight <font color="darkgreen">
    &quot;Height of the top of the heat exchanger&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Height"
>Modelica.SIunits.Height</A> hexBotHeight <font color="darkgreen">
    &quot;Height of the bottom of the heat exchanger&quot;</font>;

  <font color="blue">parameter </font>Integer hexSegMult = 2 <font color="darkgreen">
    &quot;Number of heat exchanger segments in each tank segment&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatCapacity"
>Modelica.SIunits.HeatCapacity</A> CHex = 25.163 <font color="darkgreen">
    &quot;Capacitance of the heat exchanger&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</A> Q_flow_nominal <font color="darkgreen">
    &quot;Heat transfer at nominal conditions&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> TTan_nominal <font color="darkgreen">
    &quot;Temperature of fluid inside the tank at nominal heat transfer conditions&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</A> THex_nominal <font color="darkgreen">
    &quot;Temperature of fluid inside the heat exchanger at nominal heat transfer conditions&quot;</font>;
  <font color="blue">parameter </font>Real r_nominal(min=0, max=1)=0.5 <font color="darkgreen">
    &quot;Ratio between coil inside and outside convective heat transfer at nominal heat transfer conditions&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</A> mHex_flow_nominal <font color="darkgreen">
    &quot;Nominal mass flow rate through the heat exchanger&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Diameter"
>Modelica.SIunits.Diameter</A> dExtHex = 0.025 <font color="darkgreen">
    &quot;Exterior diameter of the heat exchanger pipe&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Modelica.SIunits.Pressure</A> dpHex_nominal(displayUnit=&quot;Pa&quot;) = 2500 <font color="darkgreen">
    &quot;Pressure drop across the heat exchanger at nominal conditions&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Modelica.Fluid.Types.Dynamics</A> energyDynamicsHex=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial <font color="darkgreen">
    &quot;Formulation of energy balance&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Modelica.Fluid.Types.Dynamics</A> massDynamicsHex=energyDynamicsHex <font color="darkgreen">
    &quot;Formulation of mass balance&quot;</font>;

  <font color="blue">parameter </font>Integer topHexSeg =<font color="red"> integer</font>(<font color="red">ceil</font>(hexTopHeight/segHeight)) <font color="darkgreen">
    &quot;Segment the top of the heat exchanger is located in&quot;</font>;

  <font color="blue">parameter </font>Integer botHexSeg =<font color="red"> integer</font>(hexBotHeight/segHeight) <font color="darkgreen">
    &quot;Segment the bottom of the heat exchanger is located in&quot;</font>;

  <font color="blue">parameter </font>Boolean computeFlowResistance=true <font color="darkgreen">
    &quot;=true, compute flow resistance. Set to false to assume no friction&quot;</font>;
  <font color="blue">parameter </font>Boolean from_dp=false <font color="darkgreen">
    &quot;= true, use m_flow = f(dp) else dp = f(m_flow)&quot;</font>;
  <font color="blue">parameter </font>Boolean linearizeFlowResistance=false <font color="darkgreen">
    &quot;= true, use linear relation between m_flow and dp for any flow rate&quot;</font>;

  <font color="blue">parameter </font>Real deltaM=0.1 <font color="darkgreen">
    &quot;Fraction of nominal flow rate where flow transitions to laminar&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>Modelica.Fluid.Interfaces.FluidPort_a</A> port_a1(
    <font color="blue">redeclare </font><font color="blue">package</font> Medium =<A HREF="Buildings_Fluid_Storage_MediumHex.html#Buildings.Fluid.Storage.StratifiedEnhancedInternalHex.MediumHex"
>MediumHex</A>) <font color="darkgreen">&quot;Heat exchanger inlet&quot;</font>;
  <A HREF="../../msl/3.2/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>Modelica.Fluid.Interfaces.FluidPort_b</A> port_b1(
     <font color="blue">redeclare </font><font color="blue">package</font> Medium = <A HREF="Buildings_Fluid_Storage_MediumHex.html#Buildings.Fluid.Storage.StratifiedEnhancedInternalHex.MediumHex"
>MediumHex</A>) <font color="darkgreen">&quot;Heat exchanger outlet&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">  <A HREF="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger"
>BaseClasses.IndirectTankHeatExchanger</A> indTanHex(
    <font color="blue">final </font>nSeg=nSegHex,
    <font color="blue">final </font>CHex=CHex,
    <font color="blue">final </font>volHexFlu=volHexFlu,
    <font color="blue">final </font>Q_flow_nominal=Q_flow_nominal,
    <font color="blue">final </font>TTan_nominal=TTan_nominal,
    <font color="blue">final </font>THex_nominal=THex_nominal,
    <font color="blue">final </font>r_nominal=r_nominal,
    <font color="blue">final </font>dExtHex=dExtHex,
    <font color="blue">redeclare </font><font color="blue">final </font><font color="blue">package</font> Medium = Medium,
    <font color="blue">redeclare </font><font color="blue">final </font><font color="blue">package</font> MediumHex = MediumHex,
    <font color="blue">final </font>dp_nominal=dpHex_nominal,
    <font color="blue">final </font>m_flow_nominal=mHex_flow_nominal,
    <font color="blue">final </font>energyDynamics=energyDynamicsHex,
    <font color="blue">final </font>massDynamics=massDynamicsHex,
    m_flow_small=1e-4*<font color="red">abs</font>(mHex_flow_nominal),
    <font color="blue">final </font>computeFlowResistance=computeFlowResistance,
    from_dp=from_dp,
    linearizeFlowResistance=linearizeFlowResistance,
    deltaM=deltaM) <font color="darkgreen">&quot;Heat exchanger inside the tank&quot;</font>;</textblock>

<font color="blue">protected </font>
  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Height"
>Modelica.SIunits.Height</A> segHeight = hTan/nSeg <font color="darkgreen">
    &quot;Height of each tank segment (relative to bottom of same segment)&quot;</font>;

  <font color="blue">parameter </font><A HREF="../../msl/3.2/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</A> volHexFlu = 0.25 * Modelica.Constants.pi * dExtHex <font color="darkgreen">
    &quot;Volume of the heat exchanger&quot;</font>;

  <font color="blue">parameter </font>Integer nSegHex = (topHexSeg - botHexSeg + 1)*hexSegMult <font color="darkgreen">
    &quot;Number of segments in the heat exchanger&quot;</font>;

  <font color="blue">parameter </font>Integer nSegHexTan = topHexSeg - botHexSeg + 1 <font color="darkgreen">
    &quot;Number of tank segments the heat exchanger resides in&quot;</font>;

<font color="blue">equation </font>
   <font color="blue">for </font>j<font color="blue"> in </font>1:nSegHexTan<font color="blue"> loop</font>
     <font color="blue">for </font>i<font color="blue"> in </font>1:hexSegMult<font color="blue"> loop</font>
<textblock type="annotconnect" expanded="false">     <font color="red">connect</font>(indTanHex.port[(j-1)*hexSegMult+i], heaPorVol[nSeg-j+1]);</textblock>
     <font color="blue">end for</font>;
   <font color="blue">end for</font>;
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(port_a1, indTanHex.port_a);
  <font color="red">connect</font>(indTanHex.port_b, port_b1);</textblock>

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>StratifiedEnhancedInternalHex;
</PRE>
<HR>
<address><a href="http://www.3ds.com/">Automatically generated</a> Thu Oct 24 15:10:01 2013.
</address></BODY>
</HTML>
